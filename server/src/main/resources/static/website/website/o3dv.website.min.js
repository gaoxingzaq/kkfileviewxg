var OV=(()=>{var Ki=Object.defineProperty;var Ks=Object.getOwnPropertyDescriptor;var Js=Object.getOwnPropertyNames;var Zs=Object.prototype.hasOwnProperty;var Qs=l=>Ki(l,"__esModule",{value:!0});var $s=(l,e)=>{for(var t in e)Ki(l,t,{get:e[t],enumerable:!0})},eo=(l,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Js(e))!Zs.call(l,r)&&(t||r!=="default")&&Ki(l,r,{get:()=>e[r],enumerable:!(i=Ks(e,r))||i.enumerable});return l};var to=(l=>(e,t)=>l&&l.get(e)||(t=eo(Qs({}),e,1),l&&l.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var fo={};$s(fo,{CreateHeaderButton:()=>mo,SetWebsiteEventHandler:()=>ao,StartEmbed:()=>uo,StartWebsite:()=>ho});var Ji=null,xn=new Set;function Zi(l){Ji=l}function he(l){return new Promise((e,t)=>{if(Ji===null){t();return}if(xn.has(l)){e();return}let i=document.createElement("script");i.type="text/javascript",i.src=Ji+"/"+l,i.onload=()=>{xn.add(l),e()},i.onerror=()=>{t()},document.head.appendChild(i)})}var Ze=1e-8,Qi=1e-4,Cn=57.29577951308232,Gt=.017453292519943;function mi(l){return Math.abs(l)<Ze}function fi(l,e){return e-l>Ze}function vn(l,e){return l-e>Ze}function ci(l,e){return e-l>-Ze}function pi(l,e){return l-e>-Ze}function W(l,e){return Math.abs(e-l)<Ze}function $i(l,e,t){return Math.abs(e-l)<t}function er(l){return l>Ze}function gi(l){return l<-Ze}var _={X:1,Y:2,Z:3};var R=class{constructor(e,t){this.x=e,this.y=t}Clone(){return new R(this.x,this.y)}};function ut(l,e){return W(l.x,e.x)&&W(l.y,e.y)}function tr(l,e){return new R(l.x-e.x,l.y-e.y)}function ir(l,e){return Math.sqrt((l.x-e.x)*(l.x-e.x)+(l.y-e.y)*(l.y-e.y))}function se(l){return Math.round(parseFloat(l))}function Tn(l){let e=se(l.paddingLeft)+se(l.paddingRight),t=se(l.borderLeftWidth)+se(l.borderRightWidth),i=se(l.marginLeft)+se(l.marginRight);return e+t+i}function In(l){let e=se(l.paddingTop)+se(l.paddingBottom),t=se(l.borderTopWidth)+se(l.borderBottomWidth),i=se(l.marginTop)+se(l.marginBottom);return e+t+i}function Sn(l,e,t){let i=getComputedStyle(l),r=e-Tn(i),n=t-In(i);return{width:r,height:n}}function dt(l,e,t){if(l.getBoundingClientRect){let i=l.getBoundingClientRect();e-=i.left,t-=i.top}return window.pageXOffset&&window.pageYOffset&&(e+=window.pageXOffset,t+=window.pageYOffset),new R(e,t)}function _t(l,e,t){let i=document.createElement(l);return e&&(i.className=e),t&&(i.innerHTML=t),i}function Q(l,e,t,i){let r=_t(e,t,i);return l.appendChild(r),r}function v(l,e,t){return Q(l,"div",e,t)}function ue(l){for(;l.firstChild;)l.removeChild(l.firstChild)}function mt(l,e){e.parentNode.insertBefore(l,e)}function Mn(l,e){e.parentNode.insertBefore(l,e.nextSibling)}function V(l,e){e?l.style.display="block":l.style.display="none"}function bn(l){return l.offsetParent!==null}function Rt(l,e){l.style.width=e.toString()+"px"}function de(l,e){l.style.height=e.toString()+"px"}function Ft(l){let e=getComputedStyle(l);return l.offsetWidth+se(e.marginLeft)+se(e.marginRight)}function Ae(l){let e=getComputedStyle(l);return l.offsetHeight+se(e.marginTop)+se(e.marginBottom)}function yn(l,e){let t=getComputedStyle(l);Rt(l,e-Tn(t))}function Qe(l,e){let t=getComputedStyle(l);de(l,e-In(t))}function wn(l,e,t,i,r){let n=Q(l,"label");n.setAttribute("for",e);let s=Q(n,"input","ov_checkbox");return s.setAttribute("type","checkbox"),s.setAttribute("id",e),s.checked=i,Q(n,"span",null,t),r&&s.addEventListener("change",r),s}function En(l,e,t){let i=Q(l,"input","ov_slider");return i.setAttribute("type","range"),i.setAttribute("min",e.toString()),i.setAttribute("max",t.toString()),i}function rr(l,e,t,i){let r=v(l,"ov_select_container"),n=Q(r,"select","ov_select");for(let s of e)Q(n,"option",null,s);return n.selectedIndex=t,i&&n.addEventListener("change",()=>{i(n.selectedIndex)}),n}function xi(l,e){function t(o,a){a?o.classList.add("on"):o.classList.remove("on")}let i=!1,r=null,n="ov_toggle";e&&(n+=" "+e);let s=v(l,n);return v(s,"ov_toggle_slider"),s.addEventListener("click",()=>{i=!i,t(s,i),r&&r()}),{element:s,GetStatus:()=>i,SetStatus:o=>{i=o,t(s,i)},OnChange:o=>{r=o}}}function me(l,e){return _t("div",l,e)}var E=class{constructor(e,t,i){this.r=e,this.g=t,this.b=i}Set(e,t,i){this.r=e,this.g=t,this.b=i}Clone(){return new E(this.r,this.g,this.b)}};function be(l){return parseInt(Math.round(l*255),10)}function $e(l,e,t){return new E(be(l),be(e),be(t))}function et(l){return l<.04045?l*.0773993808:Math.pow(l*.9478672986+.0521327014,2.4)}function Wt(l){return l<.0031308?l*12.92:1.055*Math.pow(l,.41666)-.055}function ge(l){let e=parseInt(l,10).toString(16);for(;e.length<2;)e="0"+e;return e}function Ge(l){let e=ge(l.r),t=ge(l.g),i=ge(l.b);return e+t+i}function Dn(l){return new E(l[0],l[1],l[2])}function ft(l,e){return l.r===e.r&&l.g===e.g&&l.b===e.b}function oe(l){return new TextDecoder("utf-8").decode(l)}function Ci(l){return new TextEncoder().encode(l).buffer}function jt(l){let e="data:";if(!l.startsWith(e))return null;let t=l.indexOf(";");if(t===-1)return null;let i=l.indexOf(",");if(i===-1)return null;let r=l.substring(e.length,e.length+t-5),n=atob(l.substring(i+1)),s=new ArrayBuffer(n.length),o=new Uint8Array(s);for(let a=0;a<n.length;a++)o[a]=n.charCodeAt(a);return{mimeType:r,buffer:s}}function Pt(l){if(l==null)return"";let e=l.split("/");return e.length===0?"":e[e.length-1]}function ct(l){let e=new Blob([l]);return URL.createObjectURL(e)}function nr(l,e){let t=new Blob([l],{type:e});return URL.createObjectURL(t)}function An(l){URL.revokeObjectURL(l)}function Gn(l,e){let t=null,i=n=>{n.preventDefault();let s=n.clientX-t;e.onSplit(s)},r=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r),document.removeEventListener("mouseleave",r),t=null};l.addEventListener("mousedown",n=>{t=n.clientX,e.onSplitStart(),document.addEventListener("mousemove",i),document.addEventListener("mouseup",r),document.addEventListener("mouseleave",r)})}function sr(l,e){return l.length>0?l:e}function _n(l){return sr(l,"No Name")}function vi(l){return sr(l,"No Name")}function Ti(l){return sr(l,"No Name")}function or(){return window.matchMedia("(hover: hover)").matches}function Rn(l){window.matchMedia("(max-width: 800px)").addEventListener("change",l)}function Fn(){return window.matchMedia("(max-width: 800px)").matches}function Ii(l,e){function t(r,n){let s=window.innerWidth,o=r.getBoundingClientRect(),a=r.offsetWidth,h=r.offsetHeight,u=n.offsetWidth,d=10,m=o.left+a/2-u/2;return m+u>s-d&&(m=s-u-d),m<d&&(m=d),m=Math.max(m,0),{left:m,top:o.top+h+d}}if(!or())return;let i=null;l.addEventListener("mouseover",()=>{i=v(document.body,"ov_tooltip",e);let r=t(l,i);i.style.left=r.left+"px",i.style.top=r.top+"px"}),l.addEventListener("mouseout",()=>{i.remove()})}function Pn(l){let e=document.createElement("input");e.style.position="absolute",e.style.left="0",e.style.top="0",e.setAttribute("value",l),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}function lr(l,e){let t=document.createElement("a");t.href=l,t.download=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}function ar(l,e){let t=ct(l);lr(t,e)}function qt(l,e){let t=me("ov_svg_icon");return e&&t.classList.add(e),Q(t,"i","icon icon-"+l),t}function fe(l,e,t){let i=qt(e,t);return l.appendChild(i),i}function We(l,e){let t=l.firstChild;t.className="icon icon-"+e}function Si(l){let e="#"+Ge(l),t=new E(Math.max(0,l.r-50),Math.max(0,l.g-50),Math.max(0,l.b-50)),i="#"+Ge(t),r=me("ov_color_circle");return r.style.background=e,r.style.border="1px solid "+i,r}function Mi(l,e,t,i){let r=null;Gn(l,{onSplitStart:()=>{r=Ft(e)},onSplit:n=>{let s=280,o=450,a=0;t?a=r-n:a=r+n,a<s?a=s:a>o&&(a=o),yn(e,a),i()}})}function Nn(l,e){async function t(n,s){let o=n.createReader();return new Promise((a,h)=>{o.readEntries(async u=>{for(let d of u)d.isFile?s.push(d):d.isDirectory&&await t(d,s);a()},u=>{h(u)})})}async function i(n,s){let o=[];for(let h of n)h.isFile?o.push(h):h.isDirectory&&await t(h,o);let a=await Promise.all(o.map(h=>new Promise((u,d)=>{h.file(m=>{u(m)},m=>{d(m)})})));s(a)}let r=null;if(DataTransferItem&&(DataTransferItem.prototype.getAsEntry?r=DataTransferItem.prototype.getAsEntry:DataTransferItem.prototype.webkitGetAsEntry&&(r=DataTransferItem.prototype.webkitGetAsEntry)),r!==null){let n=[];for(let s of l.items){let o=r.call(s);o!==null&&n.push(o)}i(n,s=>{e(s)})}else e(l.files)}var bi=null;function Vn(l){bi=l}function le(l,e,t){bi!=null&&bi(l,e,t)}var M=class{constructor(e,t,i){this.x=e,this.y=t,this.z=i}Length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}MultiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}Normalize(){let e=this.Length();return e>0&&this.MultiplyScalar(1/e),this}Offset(e,t){let i=e.Clone().Normalize();return this.x+=i.x*t,this.y+=i.y*t,this.z+=i.z*t,this}Rotate(e,t,i){let r=e.Clone().Normalize(),n=r.x,s=r.y,o=r.z,a=this.x-i.x,h=this.y-i.y,u=this.z-i.z,d=Math.sin(t),m=Math.cos(t);return this.x=-n*(-n*a-s*h-o*u)*(1-m)+a*m+(-o*h+s*u)*d,this.y=-s*(-n*a-s*h-o*u)*(1-m)+h*m+(o*a-n*u)*d,this.z=-o*(-n*a-s*h-o*u)*(1-m)+u*m+(-s*a+n*h)*d,this.x+=i.x,this.y+=i.y,this.z+=i.z,this}Clone(){return new M(this.x,this.y,this.z)}};function _e(l,e){return W(l.x,e.x)&&W(l.y,e.y)&&W(l.z,e.z)}function Ln(l,e){return new M(l.x+e.x,l.y+e.y,l.z+e.z)}function ie(l,e){return new M(l.x-e.x,l.y-e.y,l.z-e.z)}function Re(l,e){return Math.sqrt((l.x-e.x)*(l.x-e.x)+(l.y-e.y)*(l.y-e.y)+(l.z-e.z)*(l.z-e.z))}function hr(l,e){return l.x*e.x+l.y*e.y+l.z*e.z}function Bn(l,e){let t=l.Clone().Normalize(),i=e.Clone().Normalize();if(_e(t,i))return 0;let r=hr(t,i);return Math.acos(r)}function je(l,e){let t=new M(0,0,0);return t.x=l.y*e.z-l.z*e.y,t.y=l.z*e.x-l.x*e.z,t.z=l.x*e.y-l.y*e.x,t}function yi(l,e,t){return Math.sqrt(l*l+e*e+t*t)}function qe(l){return new M(l[0],l[1],l[2])}function On(l,e,t){let i=e/t,r=i*i;return l*(r/(2*(r-i)+1))}function wi(l,e,t,i){let r=ie(e,l).Normalize(),n=Re(l,e),s=[];for(let o=0;o<t;o++){let a=i(n,o,t-1);s.push(l.Clone().Offset(r,a))}return s}var Xe=class{constructor(e,t,i){this.eye=e,this.center=t,this.up=i}Clone(){return new Xe(this.eye.Clone(),this.center.Clone(),this.up.Clone())}};function io(l,e){return _e(l.eye,e.eye)&&_e(l.center,e.center)&&_e(l.up,e.up)}var Un=class{constructor(){this.prev=new R(0,0),this.curr=new R(0,0),this.diff=new R(0,0),this.buttons=[]}Down(e,t){this.buttons.push(t.which),this.curr=this.GetPositionFromEvent(e,t),this.prev=this.curr.Clone()}Move(e,t){this.curr=this.GetPositionFromEvent(e,t),this.diff=tr(this.curr,this.prev),this.prev=this.curr.Clone()}Up(e,t){let i=this.buttons.indexOf(t.which);i!==-1&&this.buttons.splice(i,1),this.curr=this.GetPositionFromEvent(e,t)}Leave(e,t){this.buttons=[],this.curr=this.GetPositionFromEvent(e,t)}IsButtonDown(){return this.buttons.length>0}GetButton(){let e=this.buttons.length;return e===0?0:this.buttons[e-1]}GetPosition(){return this.curr}GetMoveDiff(){return this.diff}GetPositionFromEvent(e,t){return dt(e,t.clientX,t.clientY)}},kn=class{constructor(){this.prevPos=new R(0,0),this.currPos=new R(0,0),this.diffPos=new R(0,0),this.prevDist=0,this.currDist=0,this.diffDist=0,this.fingers=0}Start(e,t){t.touches.length!==0&&(this.fingers=t.touches.length,this.currPos=this.GetPositionFromEvent(e,t),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistanceFromEvent(e,t),this.prevDist=this.currDist)}Move(e,t){t.touches.length!==0&&(this.currPos=this.GetPositionFromEvent(e,t),this.diffPos=tr(this.currPos,this.prevPos),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistanceFromEvent(e,t),this.diffDist=this.currDist-this.prevDist,this.prevDist=this.currDist)}End(e,t){t.touches.length!==0&&(this.fingers=0,this.currPos=this.GetPositionFromEvent(e,t),this.currDist=this.GetTouchDistanceFromEvent(e,t))}IsFingerDown(){return this.fingers!==0}GetFingerCount(){return this.fingers}GetPosition(){return this.currPos}GetMoveDiff(){return this.diffPos}GetDistanceDiff(){return this.diffDist}GetPositionFromEvent(e,t){let i=null;if(t.touches.length!==0){let r=t.touches[0];i=dt(e,r.pageX,r.pageY)}return i}GetTouchDistanceFromEvent(e,t){if(t.touches.length!==2)return 0;let i=t.touches[0],r=t.touches[1];return ir(dt(e,i.pageX,i.pageY),dt(e,r.pageX,r.pageY))}},Hn=class{constructor(){this.isClick=!1,this.startPosition=null}Start(e){this.isClick=!0,this.startPosition=e}Move(e){if(!!this.isClick)if(this.startPosition!==null){let t=3;ir(this.startPosition,e)>t&&this.Cancel()}else this.Cancel()}End(){this.startPosition=null}Cancel(){this.isClick=!1,this.startPosition=null}IsClick(){return this.isClick}},xe={None:0,Orbit:1,Pan:2,Zoom:3},ur=class{constructor(e,t,i){this.canvas=e,this.camera=t,this.callbacks=i,this.fixUpVector=!0,this.mouse=new Un,this.touch=new kn,this.clickDetector=new Hn,this.onMouseClick=null,this.onMouseMove=null,this.onContext=null,this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",this.OnMouseDown.bind(this)),this.canvas.addEventListener("wheel",this.OnMouseWheel.bind(this)),this.canvas.addEventListener("touchstart",this.OnTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.OnTouchMove.bind(this)),this.canvas.addEventListener("touchcancel",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("touchend",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("contextmenu",this.OnContextMenu.bind(this))),document.addEventListener&&(document.addEventListener("mousemove",this.OnMouseMove.bind(this)),document.addEventListener("mouseup",this.OnMouseUp.bind(this)),document.addEventListener("mouseleave",this.OnMouseLeave.bind(this)))}SetMouseClickHandler(e){this.onMouseClick=e}SetMouseMoveHandler(e){this.onMouseMove=e}SetContextMenuHandler(e){this.onContext=e}IsFixUpVector(){return this.fixUpVector}SetFixUpVector(e){this.fixUpVector=e}GetCamera(){return this.camera}SetCamera(e){this.camera=e}MoveCamera(e,t){function i(r,n,s,o){r.camera.eye=n.eye[o],r.camera.center=n.center[o],r.camera.up=n.up[o],r.Update(),o<s-1&&requestAnimationFrame(()=>{i(r,n,s,o+1)})}if(e!==null){if(t===0||io(this.camera,e))this.camera=e;else{let r=On,n={eye:wi(this.camera.eye,e.eye,t,r),center:wi(this.camera.center,e.center,t,r),up:wi(this.camera.up,e.up,t,r)};requestAnimationFrame(()=>{i(this,n,t,0)})}this.Update()}}GetFitToSphereCamera(e,t,i){if(mi(t))return null;let r=this.camera.Clone(),n=ie(r.center,e);r.eye=ie(r.eye,n),r.center=e.Clone();let s=ie(r.eye,r.center).Normalize(),o=i/2;this.canvas.width<this.canvas.height&&(o=o*this.canvas.width/this.canvas.height);let a=t/Math.sin(o*Gt);return r.eye=r.center.Clone().Offset(s,a),r}OnMouseDown(e){e.preventDefault(),this.mouse.Down(this.canvas,e),this.clickDetector.Start(this.mouse.GetPosition())}OnMouseMove(e){if(this.mouse.Move(this.canvas,e),this.clickDetector.Move(this.mouse.GetPosition()),this.onMouseMove){let n=dt(this.canvas,e.clientX,e.clientY);this.onMouseMove(n)}if(!this.mouse.IsButtonDown())return;let t=this.mouse.GetMoveDiff(),i=this.mouse.GetButton(),r=xe.None;if(i===1?e.ctrlKey?r=xe.Zoom:e.shiftKey?r=xe.Pan:r=xe.Orbit:(i===2||i===3)&&(r=xe.Pan),r===xe.Orbit){let n=.5;this.Orbit(t.x*n,t.y*n)}else if(r===xe.Pan){let n=Re(this.camera.eye,this.camera.center),s=.001*n;this.Pan(t.x*s,t.y*s)}else if(r===xe.Zoom){let n=.005;this.Zoom(-t.y*n)}this.Update()}OnMouseUp(e){if(this.mouse.Up(this.canvas,e),this.clickDetector.End(),this.clickDetector.IsClick()){let t=this.mouse.GetPosition();this.Click(e.which,t)}}OnMouseLeave(e){this.mouse.Leave(this.canvas,e),this.clickDetector.Cancel()}OnTouchStart(e){e.preventDefault(),this.touch.Start(this.canvas,e),this.clickDetector.Start(this.touch.GetPosition())}OnTouchMove(e){if(e.preventDefault(),this.touch.Move(this.canvas,e),this.clickDetector.Move(this.touch.GetPosition()),!this.touch.IsFingerDown())return;let t=this.touch.GetMoveDiff(),i=this.touch.GetDistanceDiff(),r=this.touch.GetFingerCount(),n=xe.None;if(r===1?n=xe.Orbit:r===2&&(n=xe.Pan),n===xe.Orbit){let s=.5;this.Orbit(t.x*s,t.y*s)}else if(n===xe.Pan){let s=.005;this.Zoom(i*s);let o=.001*Re(this.camera.eye,this.camera.center);this.Pan(t.x*o,t.y*o)}this.Update()}OnTouchEnd(e){if(e.preventDefault(),this.touch.End(this.canvas,e),this.clickDetector.End(),this.clickDetector.IsClick()){let t=this.touch.GetPosition();this.touch.GetFingerCount()===1&&this.Click(1,t)}}OnMouseWheel(e){let t=e||window.event;t.preventDefault();let i=-t.deltaY/40,r=.1;i<0&&(r=r*-1),this.Zoom(r),this.Update()}OnContextMenu(e){e.preventDefault(),this.clickDetector.IsClick()&&(this.Context(e.clientX,e.clientY),this.clickDetector.Cancel())}Orbit(e,t){let i=e*Gt,r=t*Gt,n=ie(this.camera.center,this.camera.eye).Normalize(),s=je(n,this.camera.up).Normalize();if(this.fixUpVector){let a=Bn(n,this.camera.up)+r;vn(a,0)&&fi(a,Math.PI)&&this.camera.eye.Rotate(s,-r,this.camera.center),this.camera.eye.Rotate(this.camera.up,-i,this.camera.center)}else{let o=je(s,n).Normalize();this.camera.eye.Rotate(s,-r,this.camera.center),this.camera.eye.Rotate(o,-i,this.camera.center),this.camera.up=o}}Pan(e,t){let i=ie(this.camera.center,this.camera.eye).Normalize(),r=je(i,this.camera.up).Normalize(),n=je(r,i).Normalize();this.camera.eye.Offset(r,-e),this.camera.center.Offset(r,-e),this.camera.eye.Offset(n,t),this.camera.center.Offset(n,t)}Zoom(e){let t=ie(this.camera.center,this.camera.eye),r=t.Length()*e;this.camera.eye.Offset(t,r)}Update(){this.callbacks.onUpdate()}Click(e,t){this.onMouseClick&&this.onMouseClick(e,t)}Context(e,t){if(this.onContext){let i={x:e,y:t},r=dt(this.canvas,e,t);this.onContext(i,r)}}};var Ce={IntegerToString(l){return l.toString()},StringToInteger(l){return parseInt(l,10)},NumberToString(l){let e=5;return l.toPrecision(e)},StringToNumber(l){return parseFloat(l)},ModelUrlsToString:function(l){return l===null?null:l.join(",")},StringToModelUrls:function(l){return l===null||l.length===0?null:l.split(",")},CameraToString:function(l){return l===null?null:[this.NumberToString(l.eye.x),this.NumberToString(l.eye.y),this.NumberToString(l.eye.z),this.NumberToString(l.center.x),this.NumberToString(l.center.y),this.NumberToString(l.center.z),this.NumberToString(l.up.x),this.NumberToString(l.up.y),this.NumberToString(l.up.z)].join(",")},StringToCamera:function(l){if(l===null||l.length===0)return null;let e=l.split(",");return e.length!==9?null:new Xe(new M(this.StringToNumber(e[0]),this.StringToNumber(e[1]),this.StringToNumber(e[2])),new M(this.StringToNumber(e[3]),this.StringToNumber(e[4]),this.StringToNumber(e[5])),new M(this.StringToNumber(e[6]),this.StringToNumber(e[7]),this.StringToNumber(e[8])))},ColorToString:function(l){return l===null?null:[this.IntegerToString(l.r),this.IntegerToString(l.g),this.IntegerToString(l.b)].join(",")},StringToColor:function(l){if(l===null||l.length===0)return null;let e=l.split(",");return e.length!==3?null:new E(this.StringToInteger(e[0]),this.StringToInteger(e[1]),this.StringToInteger(e[2]))},EdgeSettingsToString:function(l){return l===null?null:[l.showEdges?"on":"off",this.ColorToString(l.edgeColor),this.IntegerToString(l.edgeThreshold)].join(",")},StringToEdgeSettings:function(l){if(l===null||l.length===0)return null;let e=l.split(",");return e.length!==5?null:{showEdges:e[0]==="on",edgeColor:new E(this.StringToInteger(e[1]),this.StringToInteger(e[2]),this.StringToInteger(e[3])),edgeThreshold:this.StringToInteger(e[4])}}},zn=class{constructor(e){this.separator=e,this.paramList=""}AddModelUrls(e){return this.AddUrlPart("model",Ce.ModelUrlsToString(e)),this}AddCamera(e){return this.AddUrlPart("camera",Ce.CameraToString(e)),this}AddBackgroundColor(e){return this.AddUrlPart("backgroundcolor",Ce.ColorToString(e)),this}AddDefaultColor(e){return this.AddUrlPart("defaultcolor",Ce.ColorToString(e)),this}AddEdgeSettings(e){return this.AddUrlPart("edgesettings",Ce.EdgeSettingsToString(e)),this}AddUrlPart(e,t){e===null||t===null||(this.paramList.length>0&&(this.paramList+=this.separator),this.paramList+=e+"="+t)}GetParameterList(){return this.paramList}},Wn=class{constructor(e,t){this.separator=t,this.paramList=e}GetModelUrls(){if(this.paramList.indexOf("=")===-1)return this.paramList.split(",");let e=this.GetKeywordParams("model");return Ce.StringToModelUrls(e)}GetCamera(){let e=this.GetKeywordParams("camera");return Ce.StringToCamera(e)}GetBackgroundColor(){let e=this.GetKeywordParams("backgroundcolor");return Ce.StringToColor(e)}GetDefaultColor(){let e=this.GetKeywordParams("defaultcolor");return Ce.StringToColor(e)}GetEdgeSettings(){let e=this.GetKeywordParams("edgesettings");return Ce.StringToEdgeSettings(e)}GetKeywordParams(e){if(this.paramList===null||this.paramList.length===0)return null;let t=e+"=",i=this.paramList.split(this.separator);for(let r=0;r<i.length;r++){let n=i[r];if(n.startsWith(t))return n.substring(t.length)}return null}};function Ei(){return new zn("$")}function Nt(l){return new Wn(l,"$")}function Di(l){let e=Ei();return e.AddModelUrls(l),e.GetParameterList()}var Y={Url:1,File:2,Decompressed:3},F={Text:1,Binary:2};function $(l){let e=l.lastIndexOf("/");e===-1&&(e=l.lastIndexOf("\\"));let t=l;e!==-1&&(t=l.substring(e+1));let i=t.indexOf("?");return i!==-1&&(t=t.substring(0,i)),decodeURI(t)}function Be(l){let e=$(l),t=e.lastIndexOf(".");return t===-1?"":e.substring(t+1).toLowerCase()}function jn(l,e){return new Promise((t,i)=>{let r=new XMLHttpRequest;if(r.open("GET",l,!0),e===F.Text)r.responseType="text";else if(e===F.Binary)r.responseType="arraybuffer";else{i();return}r.onload=function(){r.status===200?t(r.response):i()},r.onerror=function(){i()},r.send(null)})}function qn(l,e){return new Promise((t,i)=>{let r=new FileReader;r.onloadend=function(n){n.target.readyState===FileReader.DONE&&t(n.target.result)},r.onerror=function(){i()},e===F.Text?r.readAsText(l):e===F.Binary?r.readAsArrayBuffer(l):i()})}function Ai(l){for(let e=0;e<l.length;e++){let t=l[e];if(t.search(/www\.dropbox\.com/u)!==-1){t=t.replace("www.dropbox.com","dl.dropbox.com");let i=t.indexOf("?");i!==-1&&(t=t.substring(0,i)),l[e]=t}else if(t.search(/github\.com/u)!==-1){t=t.replace("github.com","raw.githubusercontent.com"),t=t.replace("/blob","");let i=t.indexOf("?");i!==-1&&(t=t.substring(0,i)),l[e]=t}}}var dr=class{constructor(){this.count=null,this.current=null,this.callbacks=null}Run(e,t){this.count=e,this.current=0,this.callbacks=t,e===0?this.TaskReady():this.RunOnce()}RunBatch(e,t,i){let r=0;e>0&&(r=parseInt((e-1)/t,10)+1),this.Run(r,{runTask:(n,s)=>{let o=n*t,a=Math.min((n+1)*t,e)-1;i.runTask(o,a,s)},onReady:i.onReady})}RunOnce(){setTimeout(()=>{this.callbacks.runTask(this.current,this.TaskReady.bind(this))},0)}TaskReady(){this.current+=1,this.current<this.count?this.RunOnce():this.callbacks.onReady&&this.callbacks.onReady()}};function pt(l){setTimeout(()=>{l()},0)}function Xn(l,e){new dr().Run(l,e)}function Yn(l,e,t){new dr().RunBatch(l,e,t)}function Kn(l){function e(t){t()&&setTimeout(()=>{e(t)},1)}e(l)}var Gi=class{constructor(e,t){this.source=t,t===Y.Url?(this.fileUrl=e,this.fileObject=null,this.name=$(e),this.extension=Be(e)):t===Y.File?(this.fileUrl=null,this.fileObject=e,this.name=$(e.name),this.extension=Be(e.name)):t===Y.Decompressed&&(this.fileUrl=null,this.fileObject=null,this.name=$(e),this.extension=Be(e)),this.content=null}SetContent(e){this.content=e}},_i=class{constructor(){this.files=[]}FillFromFileUrls(e){this.Fill(e,Y.Url)}FillFromFileObjects(e){this.Fill(e,Y.File)}ExtendFromFileList(e){for(let t=0;t<e.length;t++){let i=e[t];this.ContainsFileByPath(i.name)||this.files.push(i)}}GetFiles(){return this.files}GetContent(e){Xn(this.files.length,{runTask:(t,i)=>{this.GetFileContent(this.files[t],i)},onReady:e})}ContainsFileByPath(e){return this.FindFileByPath(e)!==null}FindFileByPath(e){let t=$(e).toLowerCase();for(let i=0;i<this.files.length;i++){let r=this.files[i];if(r.name.toLowerCase()===t)return r}return null}IsOnlyUrlSource(){if(this.files.length===0)return!1;for(let e=0;e<this.files.length;e++){let t=this.files[e];if(t.source!==Y.Url&&t.source!==Y.Decompressed)return!1}return!0}Fill(e,t){this.files=[];for(let i=0;i<e.length;i++){let r=e[i],n=new Gi(r,t);this.AddFile(n)}}AddFile(e){this.files.push(e)}GetFileContent(e,t){if(e.content!==null){t();return}let i=null;if(e.source===Y.Url)i=jn(e.fileUrl,F.Binary);else if(e.source===Y.File)i=qn(e.fileObject,F.Binary);else{t();return}i.then(r=>{e.SetContent(r)}).catch(()=>{}).finally(()=>{t()})}};var Oe=class{constructor(e,t,i,r){this.x=e,this.y=t,this.z=i,this.w=r}};function Vt(l){return new Oe(l[0],l[1],l[2],l[3])}function Jn(l,e){let t=e/2,i=Math.sin(t);return new Oe(l.x*i,l.y*i,l.z*i,Math.cos(t))}var U=class{constructor(e){this.matrix=null,e!=null&&(this.matrix=e)}IsValid(){return this.matrix!==null}Set(e){return this.matrix=e,this}Get(){return this.matrix}Clone(){let e=[this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],this.matrix[6],this.matrix[7],this.matrix[8],this.matrix[9],this.matrix[10],this.matrix[11],this.matrix[12],this.matrix[13],this.matrix[14],this.matrix[15]];return new U(e)}CreateIdentity(){return this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}IsIdentity(){let e=new U().CreateIdentity().Get();for(let t=0;t<16;t++)if(!W(this.matrix[t],e[t]))return!1;return!0}CreateTranslation(e,t,i){return this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1],this}CreateRotation(e,t,i,r){let n=e+e,s=t+t,o=i+i,a=e*n,h=e*s,u=e*o,d=t*s,m=t*o,c=i*o,g=r*n,f=r*s,p=r*o;return this.matrix=[1-(d+c),h+p,u-f,0,h-p,1-(a+c),m+g,0,u+f,m-g,1-(a+d),0,0,0,0,1],this}CreateRotationAxisAngle(e,t){let i=Jn(e,t);return this.CreateRotation(i.x,i.y,i.z,i.w)}CreateScale(e,t,i){return this.matrix=[e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1],this}ComposeTRS(e,t,i){let r=e.x,n=e.y,s=e.z,o=t.x,a=t.y,h=t.z,u=t.w,d=i.x,m=i.y,c=i.z,g=o+o,f=a+a,p=h+h,x=o*g,C=o*f,I=o*p,T=a*f,S=a*p,w=h*p,b=u*g,D=u*f,y=u*p;return this.matrix=[(1-(T+w))*d,(C+y)*d,(I-D)*d,0,(C-y)*m,(1-(x+w))*m,(S+b)*m,0,(I+D)*c,(S-b)*c,(1-(x+T))*c,0,r,n,s,1],this}DecomposeTRS(){let e=new M(this.matrix[12],this.matrix[13],this.matrix[14]),t=yi(this.matrix[0],this.matrix[1],this.matrix[2]),i=yi(this.matrix[4],this.matrix[5],this.matrix[6]),r=yi(this.matrix[8],this.matrix[9],this.matrix[10]),n=this.Determinant();gi(n)&&(t*=-1);let s=new M(t,i,r),o=this.matrix[0]/t,a=this.matrix[4]/i,h=this.matrix[8]/r,u=this.matrix[1]/t,d=this.matrix[5]/i,m=this.matrix[9]/r,c=this.matrix[2]/t,g=this.matrix[6]/i,f=this.matrix[10]/r,p=null,x=o+d+f;if(x>0){let C=Math.sqrt(x+1)*2;p=new Oe((g-m)/C,(h-c)/C,(u-a)/C,.25*C)}else if(o>d&&o>f){let C=Math.sqrt(1+o-d-f)*2;p=new Oe(.25*C,(a+u)/C,(h+c)/C,(g-m)/C)}else if(d>f){let C=Math.sqrt(1+d-o-f)*2;p=new Oe((a+u)/C,.25*C,(m+g)/C,(h-c)/C)}else{let C=Math.sqrt(1+f-o-d)*2;p=new Oe((h+c)/C,(m+g)/C,.25*C,(u-a)/C)}return{translation:e,rotation:p,scale:s}}Determinant(){let e=this.matrix[0],t=this.matrix[1],i=this.matrix[2],r=this.matrix[3],n=this.matrix[4],s=this.matrix[5],o=this.matrix[6],a=this.matrix[7],h=this.matrix[8],u=this.matrix[9],d=this.matrix[10],m=this.matrix[11],c=this.matrix[12],g=this.matrix[13],f=this.matrix[14],p=this.matrix[15],x=e*s-t*n,C=e*o-i*n,I=e*a-r*n,T=t*o-i*s,S=t*a-r*s,w=i*a-r*o,b=h*g-u*c,D=h*f-d*c,y=h*p-m*c,G=u*f-d*g,k=u*p-m*g,N=d*p-m*f;return x*N-C*k+I*G+T*y-S*D+w*b}Invert(){let e=this.matrix[0],t=this.matrix[1],i=this.matrix[2],r=this.matrix[3],n=this.matrix[4],s=this.matrix[5],o=this.matrix[6],a=this.matrix[7],h=this.matrix[8],u=this.matrix[9],d=this.matrix[10],m=this.matrix[11],c=this.matrix[12],g=this.matrix[13],f=this.matrix[14],p=this.matrix[15],x=e*s-t*n,C=e*o-i*n,I=e*a-r*n,T=t*o-i*s,S=t*a-r*s,w=i*a-r*o,b=h*g-u*c,D=h*f-d*c,y=h*p-m*c,G=u*f-d*g,k=u*p-m*g,N=d*p-m*f,L=x*N-C*k+I*G+T*y-S*D+w*b;if(W(L,0))return null;let B=[(s*N-o*k+a*G)/L,(i*k-t*N-r*G)/L,(g*w-f*S+p*T)/L,(d*S-u*w-m*T)/L,(o*y-n*N-a*D)/L,(e*N-i*y+r*D)/L,(f*I-c*w-p*C)/L,(h*w-d*I+m*C)/L,(n*k-s*y+a*b)/L,(t*y-e*k-r*b)/L,(c*S-g*I+p*x)/L,(u*I-h*S-m*x)/L,(s*D-n*G-o*b)/L,(e*G-t*D+i*b)/L,(g*C-c*T-f*x)/L,(h*T-u*C+d*x)/L];return new U(B)}MultiplyVector(e){let t=e[0],i=e[1],r=e[2],n=e[3],s=this.matrix[0],o=this.matrix[1],a=this.matrix[2],h=this.matrix[3],u=this.matrix[4],d=this.matrix[5],m=this.matrix[6],c=this.matrix[7],g=this.matrix[8],f=this.matrix[9],p=this.matrix[10],x=this.matrix[11],C=this.matrix[12],I=this.matrix[13],T=this.matrix[14],S=this.matrix[15];return[t*s+i*u+r*g+n*C,t*o+i*d+r*f+n*I,t*a+i*m+r*p+n*T,t*h+i*c+r*x+n*S]}MultiplyMatrix(e){let t=this.matrix[0],i=this.matrix[1],r=this.matrix[2],n=this.matrix[3],s=this.matrix[4],o=this.matrix[5],a=this.matrix[6],h=this.matrix[7],u=this.matrix[8],d=this.matrix[9],m=this.matrix[10],c=this.matrix[11],g=this.matrix[12],f=this.matrix[13],p=this.matrix[14],x=this.matrix[15],C=e.matrix[0],I=e.matrix[1],T=e.matrix[2],S=e.matrix[3],w=e.matrix[4],b=e.matrix[5],D=e.matrix[6],y=e.matrix[7],G=e.matrix[8],k=e.matrix[9],N=e.matrix[10],L=e.matrix[11],B=e.matrix[12],ne=e.matrix[13],H=e.matrix[14],pe=e.matrix[15],Le=[t*C+i*w+r*G+n*B,t*I+i*b+r*k+n*ne,t*T+i*D+r*N+n*H,t*S+i*y+r*L+n*pe,s*C+o*w+a*G+h*B,s*I+o*b+a*k+h*ne,s*T+o*D+a*N+h*H,s*S+o*y+a*L+h*pe,u*C+d*w+m*G+c*B,u*I+d*b+m*k+c*ne,u*T+d*D+m*N+c*H,u*S+d*y+m*L+c*pe,g*C+f*w+p*G+x*B,g*I+f*b+p*k+x*ne,g*T+f*D+p*N+x*H,g*S+f*y+p*L+x*pe];return new U(Le)}};var q=class{constructor(e){e!=null?this.matrix=e:(this.matrix=new U,this.matrix.CreateIdentity())}SetMatrix(e){return this.matrix=e,this}GetMatrix(){return this.matrix}IsIdentity(){return this.matrix.IsIdentity()}AppendMatrix(e){return this.matrix=this.matrix.MultiplyMatrix(e),this}Append(e){return this.AppendMatrix(e.GetMatrix()),this}TransformCoord3D(e){let t=this.matrix.MultiplyVector([e.x,e.y,e.z,1]);return new M(t[0],t[1],t[2])}Clone(){let e=this.matrix.Clone();return new q(e)}};var Ye=class{constructor(){this.name=null,this.url=null,this.buffer=null,this.offset=new R(0,0),this.scale=new R(1,1),this.rotation=0}IsValid(){return this.name!==null&&this.url!==null&&this.buffer!==null}HasTransformation(){return!ut(this.offset,new R(0,0))||!ut(this.scale,new R(1,1))||!W(this.rotation,0)}IsEqual(e){return!(this.name!==e.name||this.url!==e.url||!ut(this.offset,e.offset)||!ut(this.scale,e.scale)||!W(this.rotation,e.rotation))}};function Lt(l,e){return l===null&&e===null?!0:l===null||e===null?!1:l.IsEqual(e)}var X={Phong:1,Physical:2},Zn=class{constructor(e){this.type=e,this.isDefault=!1,this.name="",this.color=new E(0,0,0),this.vertexColors=!1}IsEqual(e){return!(this.type!==e.type||this.isDefault!==e.isDefault||this.name!==e.name||!ft(this.color,e.color)||this.vertexColors!==e.vertexColors)}},mr=class extends Zn{constructor(e){super(e);this.emissive=new E(0,0,0),this.opacity=1,this.transparent=!1,this.diffuseMap=null,this.bumpMap=null,this.normalMap=null,this.emissiveMap=null,this.alphaTest=0,this.multiplyDiffuseMap=!1}IsEqual(e){return!(!super.IsEqual(e)||!ft(this.emissive,e.emissive)||!W(this.opacity,e.opacity)||this.transparent!==e.transparent||!Lt(this.diffuseMap,e.diffuseMap)||!Lt(this.bumpMap,e.bumpMap)||!Lt(this.normalMap,e.normalMap)||!Lt(this.emissiveMap,e.emissiveMap)||!W(this.alphaTest,e.alphaTest)||this.multiplyDiffuseMap!==e.multiplyDiffuseMap)}EnumerateTextureMaps(e){this.diffuseMap!==null&&e(this.diffuseMap),this.bumpMap!==null&&e(this.bumpMap),this.normalMap!==null&&e(this.normalMap),this.emissiveMap!==null&&e(this.emissiveMap)}},ee=class extends mr{constructor(){super(X.Phong);this.ambient=new E(0,0,0),this.specular=new E(0,0,0),this.shininess=0,this.specularMap=null}IsEqual(e){return!(!super.IsEqual(e)||!ft(this.ambient,e.ambient)||!ft(this.specular,e.specular)||!W(this.shininess,e.shininess)||!Lt(this.specularMap,e.specularMap))}EnumerateTextureMaps(e){super.EnumerateTextureMaps(e),this.specularMap!==null&&e(this.specularMap)}},gt=class extends mr{constructor(){super(X.Physical);this.metalness=0,this.roughness=1,this.metalnessMap=null}IsEqual(e){return!(!super.IsEqual(e)||!W(this.metalness,e.metalness)||!W(this.roughness,e.roughness)||!Lt(this.metalnessMap,e.metalnessMap))}EnumerateTextureMaps(e){super.EnumerateTextureMaps(e),this.metalnessMap!==null&&e(this.metalnessMap)}};var tt={Empty:0,TriangleMesh:1};function Bt(l){return l.TriangleCount()>0?tt.TriangleMesh:tt.Empty}function Xt(l,e,t){let i=ie(e,l),r=ie(t,l),n=je(i,r);return n.Normalize(),n}function it(l,e){if(!e.IsIdentity()){for(let t=0;t<l.VertexCount();t++){let i=l.GetVertex(t),r=e.TransformCoord3D(i);i.x=r.x,i.y=r.y,i.z=r.z}if(l.NormalCount()>0){let t=e.GetMatrix().DecomposeTRS(),i=new U().ComposeTRS(new M(0,0,0),t.rotation,new M(1,1,1)),r=new q(i);for(let n=0;n<l.NormalCount();n++){let s=l.GetNormal(n),o=r.TransformCoord3D(s);s.x=o.x,s.y=o.y,s.z=o.z}}}}function Qn(l){for(let e=0;e<l.TriangleCount();e++){let t=l.GetTriangle(e),i=t.v1;t.v1=t.v2,t.v2=i}}var Ri=class{constructor(e,t){this.min=e,this.max=t}GetMin(){return this.min}GetMax(){return this.max}GetCenter(){return new M((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,(this.min.z+this.max.z)/2)}},fr=class{constructor(){this.box=new Ri(new M(1/0,1/0,1/0),new M(-1/0,-1/0,-1/0)),this.isValid=!1}GetBox(){return this.isValid?this.box:null}AddPoint(e){this.box.min.x=Math.min(this.box.min.x,e.x),this.box.min.y=Math.min(this.box.min.y,e.y),this.box.min.z=Math.min(this.box.min.z,e.z),this.box.max.x=Math.max(this.box.max.x,e.x),this.box.max.y=Math.max(this.box.max.y,e.y),this.box.max.z=Math.max(this.box.max.z,e.z),this.isValid=!0}};var Fi=class{constructor(e,t){this.boundingBox=e,this.level=t,this.pointItems=[],this.childNodes=[]}AddPoint(e,t,i){let r=this.FindNodeForPoint(e);if(r===null||r.FindPointDirectly(e)!==null)return!1;if(r.pointItems.length<i.maxPointsPerNode||r.level>=i.maxTreeDepth)return r.AddPointDirectly(e,t),!0;{r.CreateChildNodes();let n=r.pointItems;r.pointItems=[];for(let s=0;s<n.length;s++){let o=n[s];if(!r.AddPoint(o.point,o.data,i))return!1}return r.AddPoint(e,t,i)}}FindPoint(e){let t=this.FindNodeForPoint(e);return t===null?null:t.FindPointDirectly(e)}AddPointDirectly(e,t){this.pointItems.push({point:e,data:t})}FindPointDirectly(e){for(let t=0;t<this.pointItems.length;t++){let i=this.pointItems[t];if(_e(e,i.point))return i.data}return null}FindNodeForPoint(e){if(!this.IsPointInBounds(e))return null;if(this.childNodes.length===0)return this;for(let t=0;t<this.childNodes.length;t++){let r=this.childNodes[t].FindNodeForPoint(e);if(r!==null)return r}return null}CreateChildNodes(){function e(o,a,h,u,d,m,c){let g=new Ri(new M(a,h,u),new M(a+d,h+m,u+c));o.childNodes.push(new Fi(g,o.level+1))}let t=this.boundingBox.min,i=this.boundingBox.GetCenter(),r=(this.boundingBox.max.x-this.boundingBox.min.x)/2,n=(this.boundingBox.max.y-this.boundingBox.min.y)/2,s=(this.boundingBox.max.z-this.boundingBox.min.z)/2;e(this,t.x,t.y,t.z,r,n,s),e(this,i.x,t.y,t.z,r,n,s),e(this,t.x,i.y,t.z,r,n,s),e(this,i.x,i.y,t.z,r,n,s),e(this,t.x,t.y,i.z,r,n,s),e(this,i.x,t.y,i.z,r,n,s),e(this,t.x,i.y,i.z,r,n,s),e(this,i.x,i.y,i.z,r,n,s)}IsPointInBounds(e){return pi(e.x,this.boundingBox.min.x)&&pi(e.y,this.boundingBox.min.y)&&pi(e.z,this.boundingBox.min.z)&&ci(e.x,this.boundingBox.max.x)&&ci(e.y,this.boundingBox.max.y)&&ci(e.z,this.boundingBox.max.z)}},cr=class{constructor(e,t){this.options={maxPointsPerNode:10,maxTreeDepth:10},t!==void 0&&(t.maxPointsPerNode!==void 0&&(this.options.maxPointsPerNode=t.maxPointsPerNode),t.maxTreeDepth!==void 0&&(this.options.maxTreeDepth=t.maxTreeDepth)),this.rootNode=new Fi(e,0)}AddPoint(e,t){return this.rootNode.AddPoint(e,t,this.options)}FindPoint(e){return this.rootNode.FindPoint(e)}};var $n=class{constructor(){this.edges=[],this.triangles=[]}},es=class{constructor(e,t){this.vertex1=e,this.vertex2=t,this.triangles=[]}},ts=class{constructor(e,t){this.edge=e,this.reversed=t}},is=class{constructor(){this.triEdge1=null,this.triEdge2=null,this.triEdge3=null}},pr=class{constructor(){this.vertices=[],this.edges=[],this.triangleEdges=[],this.triangles=[],this.edgeStartToEndVertexMap=new Map}AddVertex(){return this.vertices.push(new $n),this.vertices.length-1}AddTriangle(e,t,i){function r(h,u,d){h[u].triangles.push(d)}function n(h,u,d,m){let c=h[d],g=u[m];c.edges.push(g.edge)}function s(h,u,d,m){let c=u[d];h[c.edge].triangles.push(m)}let o=this.triangles.length,a=new is;a.triEdge1=this.AddTriangleEdge(e,t),a.triEdge2=this.AddTriangleEdge(t,i),a.triEdge3=this.AddTriangleEdge(i,e),r(this.vertices,e,o),r(this.vertices,t,o),r(this.vertices,i,o),n(this.vertices,this.triangleEdges,e,a.triEdge1),n(this.vertices,this.triangleEdges,t,a.triEdge2),n(this.vertices,this.triangleEdges,i,a.triEdge3),s(this.edges,this.triangleEdges,a.triEdge1,o),s(this.edges,this.triangleEdges,a.triEdge2,o),s(this.edges,this.triangleEdges,a.triEdge3,o),this.triangles.push(a)}AddTriangleEdge(e,t){let i=e,r=t,n=!1;t<e&&(i=t,r=e,n=!0);let s=this.AddEdge(i,r);return this.triangleEdges.push(new ts(s,n)),this.triangleEdges.length-1}AddEdge(e,t){this.edgeStartToEndVertexMap.has(e)||this.edgeStartToEndVertexMap.set(e,[]);let i=this.edgeStartToEndVertexMap.get(e);for(let n=0;n<i.length;n++){let s=i[n];if(s.endVertex===t)return s.edgeIndex}let r=this.edges.length;return i.push({endVertex:t,edgeIndex:r}),this.edges.push(new es(e,t)),r}};function Pi(l){let e=!0;return l.EnumerateMeshInstances(t=>{Bt(t)!==tt.Empty&&(e=!1)}),e}function gr(l){let e=new fr;return l.EnumerateVertices(t=>{e.AddPoint(t)}),e.GetBox()}function ro(l){function e(n,s,o){let a=s.FindPoint(n);return a===null&&(a=o.AddVertex(),s.AddPoint(n,a)),a}let t=gr(l),i=new cr(t),r=new pr;return l.EnumerateTriangleVertices((n,s,o)=>{let a=e(n,i,r),h=e(s,i,r),u=e(o,i,r);r.AddTriangle(a,h,u)}),r}function rs(l){function e(i,r,n){let s=i.triangles[r],o=i.triangleEdges[s.triEdge1],a=i.triangleEdges[s.triEdge2],h=i.triangleEdges[s.triEdge3];return o.edge===n?o.reversed:a.edge===n?a.reversed:h.edge===n?h.reversed:null}let t=ro(l);for(let i=0;i<t.edges.length;i++){let r=t.edges[i],n=r.triangles.length;if(n===0||n%2!==0)return!1;let s=0;for(let o=0;o<r.triangles.length;o++){let a=r.triangles[o];e(t,a,i)?s+=1:s-=1}if(s!==0)return!1}return!0}function ns(l){for(let e=0;e<l.MaterialCount();e++){let t=l.GetMaterial(e);if(t.isDefault&&!t.vertexColors)return!0}return!1}function xr(l,e){for(let t=0;t<l.MaterialCount();t++){let i=l.GetMaterial(t);i.isDefault&&(i.color=e)}}var P={Text:1,Integer:2,Number:3,Boolean:4,Percent:5,Color:6},O=class{constructor(e,t,i){this.type=e,this.name=t,this.value=i}},Ue=class{constructor(e){this.name=e,this.properties=[]}PropertyCount(){return this.properties.length}AddProperty(e){this.properties.push(e)}GetProperty(e){return this.properties[e]}};var ss=class{constructor(){}VertexCount(){return 0}VertexColorCount(){return 0}NormalCount(){return 0}TextureUVCount(){return 0}TriangleCount(){return 0}EnumerateVertices(e){}EnumerateTriangleVertexIndices(e){}EnumerateTriangleVertices(e){}},xt=class extends ss{constructor(){super();this.name="",this.propertyGroups=[]}GetName(){return this.name}SetName(e){this.name=e}PropertyGroupCount(){return this.propertyGroups.length}AddPropertyGroup(e){return this.propertyGroups.push(e),this.propertyGroups.length-1}GetPropertyGroup(e){return this.propertyGroups[e]}};var K=class extends xt{constructor(){super();this.vertices=[],this.vertexColors=[],this.normals=[],this.uvs=[],this.triangles=[]}VertexCount(){return this.vertices.length}VertexColorCount(){return this.vertexColors.length}NormalCount(){return this.normals.length}TextureUVCount(){return this.uvs.length}TriangleCount(){return this.triangles.length}AddVertex(e){return this.vertices.push(e),this.vertices.length-1}SetVertex(e,t){this.vertices[e]=t}GetVertex(e){return this.vertices[e]}AddVertexColor(e){return this.vertexColors.push(e),this.vertexColors.length-1}SetVertexColor(e,t){this.vertexColors[e]=t}GetVertexColor(e){return this.vertexColors[e]}AddNormal(e){return this.normals.push(e),this.normals.length-1}SetNormal(e,t){this.normals[e]=t}GetNormal(e){return this.normals[e]}AddTextureUV(e){return this.uvs.push(e),this.uvs.length-1}SetTextureUV(e,t){this.uvs[e]=t}GetTextureUV(e){return this.uvs[e]}AddTriangle(e){return this.triangles.push(e),this.triangles.length-1}GetTriangle(e){return this.triangles[e]}EnumerateVertices(e){for(let t of this.vertices)e(t)}EnumerateTriangleVertexIndices(e){for(let t of this.triangles)e(t.v0,t.v1,t.v2)}EnumerateTriangleVertices(e){for(let t of this.triangles){let i=this.vertices[t.v0],r=this.vertices[t.v1],n=this.vertices[t.v2];e(i,r,n)}}Clone(){let e=new K;e.SetName(this.GetName());for(let t=0;t<this.VertexCount();t++){let i=this.GetVertex(t);e.AddVertex(i.Clone())}for(let t=0;t<this.VertexColorCount();t++){let i=this.GetVertexColor(t);e.AddVertexColor(i.Clone())}for(let t=0;t<this.NormalCount();t++){let i=this.GetNormal(t);e.AddNormal(i.Clone())}for(let t=0;t<this.TextureUVCount();t++){let i=this.GetTextureUV(t);e.AddTextureUV(i.Clone())}for(let t=0;t<this.TriangleCount();t++){let i=this.GetTriangle(t);e.AddTriangle(i.Clone())}return e}};var j=class{constructor(e,t,i){this.v0=e,this.v1=t,this.v2=i,this.c0=null,this.c1=null,this.c2=null,this.n0=null,this.n1=null,this.n2=null,this.u0=null,this.u1=null,this.u2=null,this.mat=null,this.curve=null}HasVertices(){return this.v0!==null&&this.v1!==null&&this.v2!==null}HasVertexColors(){return this.c0!==null&&this.c1!==null&&this.c2!==null}HasNormals(){return this.n0!==null&&this.n1!==null&&this.n2!==null}HasTextureUVs(){return this.u0!==null&&this.u1!==null&&this.u2!==null}SetVertices(e,t,i){return this.v0=e,this.v1=t,this.v2=i,this}SetVertexColors(e,t,i){return this.c0=e,this.c1=t,this.c2=i,this}SetNormals(e,t,i){return this.n0=e,this.n1=t,this.n2=i,this}SetTextureUVs(e,t,i){return this.u0=e,this.u1=t,this.u2=i,this}SetMaterial(e){return this.mat=e,this}SetCurve(e){return this.curve=e,this}Clone(){let e=new j(this.v0,this.v1,this.v2);return e.SetVertexColors(this.c0,this.c1,this.c2),e.SetNormals(this.n0,this.n1,this.n2),e.SetTextureUVs(this.u0,this.u1,this.u2),e.SetMaterial(this.mat),e.SetCurve(this.curve),e}};function os(){let l=document.createElement("canvas");document.body.appendChild(l);let e={canvas:l,antialias:!0},t=new THREE.WebGLRenderer(e);t.setClearColor("#ffffff",1),t.setSize(10,10);let i=new THREE.Scene,r=new THREE.AmbientLight(8947848);i.add(r);let n=new THREE.DirectionalLight(8947848);n.position.set(0,0,1),i.add(n);let s=new THREE.PerspectiveCamera(45,1,.1,1e3);s.position.set(0,0,1),s.up.set(0,1,0),s.lookAt(new THREE.Vector3(0,0,0)),i.add(s);let o=new THREE.PlaneGeometry(1,1),a=new THREE.Mesh(o,new THREE.MeshPhongMaterial({color:13369344}));i.add(a),t.render(i,s);let h=t.getContext(),u=new Uint8Array(4);h.readPixels(5,5,1,1,h.RGBA,h.UNSIGNED_BYTE,u),document.body.removeChild(l);let d=50;return u[0]<d&&u[1]<d&&u[2]<d}var ve={Phong:1,Physical:2};function ls(l){let e=0,t=0;for(let i=0;i<l.MaterialCount();i++){let r=l.GetMaterial(i);r.type===X.Phong?e+=1:r.type===X.Physical&&(t+=1)}return e>=t?ve.Phong:ve.Physical}function Ni(l){return $e(l.r,l.g,l.b)}function ye(l){return new THREE.Color(l.r/255,l.g/255,l.b/255)}function Yt(l,e){let t=new K,i=l.attributes.position.array;for(let a=0;a<i.length;a+=3){let h=i[a],u=i[a+1],d=i[a+2];t.AddVertex(new M(h,u,d))}let r=l.attributes.color!==void 0;if(r){let a=l.attributes.color.array,h=l.attributes.color.itemSize;for(let u=0;u<a.length;u+=h){let d=new THREE.Color(a[u],a[u+1],a[u+2]);t.AddVertexColor(Ni(d))}}let n=l.attributes.normal!==void 0;if(n){let a=l.attributes.normal.array;for(let h=0;h<a.length;h+=3){let u=a[h],d=a[h+1],m=a[h+2];t.AddNormal(new M(u,d,m))}}let s=l.attributes.uv!==void 0;if(s){let a=l.attributes.uv.array;for(let h=0;h<a.length;h+=2){let u=a[h],d=a[h+1];t.AddTextureUV(new R(u,d))}}let o=null;if(l.index!==null)o=l.index.array;else{o=[];for(let a=0;a<i.length/3;a++)o.push(a)}for(let a=0;a<o.length;a+=3){let h=o[a],u=o[a+1],d=o[a+2],m=new j(h,u,d);r&&m.SetVertexColors(h,u,d),n&&m.SetNormals(h,u,d),s&&m.SetTextureUVs(h,u,d),e!==null&&m.SetMaterial(e),t.AddTriangle(m)}return t}var rt=class{constructor(e,t){this.nodeId=e,this.meshIndex=t}IsEqual(e){return this.nodeId===e.nodeId&&this.meshIndex===e.meshIndex}GetKey(){return this.nodeId.toString()+":"+this.meshIndex.toString()}},Vi=class extends xt{constructor(e,t,i){super();this.id=e,this.node=t,this.mesh=i}GetId(){return this.id}GetTransformation(){return this.node.GetWorldTransformation()}GetMesh(){return this.mesh}VertexCount(){return this.mesh.VertexCount()}VertexColorCount(){return this.mesh.VertexColorCount()}NormalCount(){return this.mesh.NormalCount()}TextureUVCount(){return this.mesh.TextureUVCount()}TriangleCount(){return this.mesh.TriangleCount()}EnumerateVertices(e){let t=this.node.GetWorldTransformation();t.IsIdentity()?this.mesh.EnumerateVertices(e):this.mesh.EnumerateVertices(i=>{let r=t.TransformCoord3D(i);e(r)})}EnumerateTriangleVertexIndices(e){this.mesh.EnumerateTriangleVertexIndices(e)}EnumerateTriangleVertices(e){let t=this.node.GetWorldTransformation();t.IsIdentity()?this.mesh.EnumerateTriangleVertices(e):this.mesh.EnumerateTriangleVertices((i,r,n)=>{let s=t.TransformCoord3D(i),o=t.TransformCoord3D(r),a=t.TransformCoord3D(n);e(s,o,a)})}PropertyGroupCount(){return this.mesh.PropertyGroupCount()}AddPropertyGroup(e){return this.mesh.AddPropertyGroup(e)}GetPropertyGroup(e){return this.mesh.GetPropertyGroup(e)}GetTransformedMesh(){let e=this.node.GetWorldTransformation(),t=this.mesh.Clone();return it(t,e),t}};var as=class{constructor(){this.nextId=0}GenerateId(){let e=this.nextId;return this.nextId+=1,e}},Te={GroupNode:0,MeshNode:1},Fe=class{constructor(){this.type=Te.GroupNode,this.name="",this.parent=null,this.transformation=new q,this.childNodes=[],this.meshIndices=[],this.idGenerator=new as,this.id=this.idGenerator.GenerateId()}IsEmpty(){return this.childNodes.length===0&&this.meshIndices.length===0}GetType(){return this.type}SetType(e){this.type=e}GetId(){return this.id}GetName(){return this.name}SetName(e){this.name=e}HasParent(){return this.parent!==null}GetParent(){return this.parent}GetTransformation(){return this.transformation}GetWorldTransformation(){let e=this.transformation.Clone(),t=this.parent;for(;t!==null;)e.Append(t.transformation),t=t.parent;return e}SetTransformation(e){this.transformation=e}AddChildNode(e){return e.parent=this,e.idGenerator=this.idGenerator,e.id=e.idGenerator.GenerateId(),this.childNodes.push(e),this.childNodes.length-1}RemoveChildNode(e){e.parent=null;let t=this.childNodes.indexOf(e);this.childNodes.splice(t,1)}GetChildNodes(){return this.childNodes}ChildNodeCount(){return this.childNodes.length}GetChildNode(e){return this.childNodes[e]}AddMeshIndex(e){return this.meshIndices.push(e),this.meshIndices.length-1}MeshIndexCount(){return this.meshIndices.length}GetMeshIndex(e){return this.meshIndices[e]}GetMeshIndices(){return this.meshIndices}Enumerate(e){e(this);for(let t of this.childNodes)t.Enumerate(e)}EnumerateChildren(e){for(let t of this.childNodes)e(t),t.EnumerateChildren(e)}EnumerateMeshIndices(e){for(let t of this.meshIndices)e(t);for(let t of this.childNodes)t.EnumerateMeshIndices(e)}};var Cr=class extends xt{constructor(){super();this.root=new Fe,this.materials=[],this.meshes=[]}GetRootNode(){return this.root}MaterialCount(){return this.materials.length}MeshCount(){return this.meshes.length}MeshInstanceCount(){let e=0;return this.root.Enumerate(t=>{e+=t.MeshIndexCount()}),e}VertexCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.VertexCount()}),e}VertexColorCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.VertexColorCount()}),e}NormalCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.NormalCount()}),e}TextureUVCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.TextureUVCount()}),e}TriangleCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.TriangleCount()}),e}AddMaterial(e){return this.materials.push(e),this.materials.length-1}GetMaterial(e){return this.materials[e]}AddMesh(e){return this.meshes.push(e),this.meshes.length-1}AddMeshToRootNode(e){let t=this.AddMesh(e);return this.root.AddMeshIndex(t),t}RemoveMesh(e){this.meshes.splice(e,1),this.root.Enumerate(t=>{for(let i=0;i<t.meshIndices.length;i++)t.meshIndices[i]===e?(t.meshIndices.splice(i,1),i-=1):t.meshIndices[i]>e&&(t.meshIndices[i]-=1)})}GetMesh(e){return this.meshes[e]}GetMeshInstance(e){let t=null;if(this.root.Enumerate(s=>{s.GetId()===e.nodeId&&(t=s)}),t===null||t.GetMeshIndices().indexOf(e.meshIndex)===-1)return null;let r=this.GetMesh(e.meshIndex),n=new rt(t.GetId(),e.meshIndex);return new Vi(n,t,r)}EnumerateMeshes(e){for(let t of this.meshes)e(t)}EnumerateMeshInstances(e){this.root.Enumerate(t=>{for(let i of t.GetMeshIndices()){let r=new rt(t.GetId(),i),n=this.GetMesh(i),s=new Vi(r,t,n);e(s)}})}EnumerateTransformedMeshes(e){this.EnumerateMeshInstances(t=>{let i=t.GetTransformedMesh();e(i)})}EnumerateVertices(e){this.EnumerateMeshInstances(t=>{t.EnumerateVertices(e)})}EnumerateTriangleVertexIndices(e){this.EnumerateMeshInstances(t=>{t.EnumerateTriangleVertexIndices(e)})}EnumerateTriangleVertices(e){this.EnumerateMeshInstances(t=>{t.EnumerateTriangleVertices(e)})}};function Ot(l){return l!=null}function nt(l,e){return l??e}function Li(l,e){if(!!Ot(l))for(let t of Object.keys(l))Ot(l[t])&&(e[t]=l[t])}var hs=class{constructor(e){this.params={getDefaultMaterialColor:()=>new E(0,0,0)},Li(e,this.params),this.defaultMaterialIndex=null}Finalize(e){this.Reset(),this.FinalizeMeshes(e),this.FinalizeMaterials(e),this.FinalizeNodes(e)}FinalizeMaterials(e){if(!(e.VertexColorCount()>0))return;let i=new Map;for(let r=0;r<e.MeshCount();r++){let n=e.GetMesh(r);for(let s=0;s<n.TriangleCount();s++){let o=n.GetTriangle(s),a=o.HasVertexColors();i.has(o.mat)?a||i.set(o.mat,!1):i.set(o.mat,a)}}for(let[r,n]of i){let s=e.GetMaterial(r);s.vertexColors=n}}FinalizeMeshes(e){for(let t=0;t<e.MeshCount();t++){let i=e.GetMesh(t);if(Bt(i)===tt.Empty){e.RemoveMesh(t),t=t-1;continue}this.FinalizeMesh(e,i)}}FinalizeMesh(e,t){function i(n){function s(h,u,d,m,c){function g(C,I){for(let T=0;T<C.length;T++){let S=C[T];if(_e(S,I))return!0}return!1}let f=[],p=c.get(d);for(let C=0;C<p.length;C++){let I=p[C],T=h.GetTriangle(I);if(u.curve===T.curve){let S=m[I];g(f,S)||f.push(S)}}let x=new M(0,0,0);for(let C=0;C<f.length;C++)x=Ln(x,f[C]);return x.MultiplyScalar(1/f.length),x.Normalize(),h.AddNormal(x)}let o=[],a=new Map;for(let h=0;h<n.VertexCount();h++)a.set(h,[]);for(let h=0;h<n.TriangleCount();h++){let u=n.GetTriangle(h),d=n.GetVertex(u.v0),m=n.GetVertex(u.v1),c=n.GetVertex(u.v2),g=Xt(d,m,c);o.push(g),a.get(u.v0).push(h),a.get(u.v1).push(h),a.get(u.v2).push(h)}for(let h=0;h<n.TriangleCount();h++){let u=n.GetTriangle(h);if(!u.HasNormals()){let d=s(n,u,u.v0,o,a),m=s(n,u,u.v1,o,a),c=s(n,u,u.v2,o,a);u.SetNormals(d,m,c)}}}let r={calculateCurveNormals:!1};for(let n=0;n<t.TriangleCount();n++){let s=t.GetTriangle(n);this.FinalizeTriangle(t,s,r),s.mat===null&&(s.mat=this.GetDefaultMaterialIndex(e))}r.calculateCurveNormals&&i(t)}FinalizeTriangle(e,t,i){if(!t.HasNormals())if(t.curve===null||t.curve===0){let r=e.GetVertex(t.v0),n=e.GetVertex(t.v1),s=e.GetVertex(t.v2),o=Xt(r,n,s),a=e.AddNormal(o);t.SetNormals(a,a,a)}else i.calculateCurveNormals=!0;t.curve===null&&(t.curve=0)}FinalizeNodes(e){let t=e.GetRootNode(),i=[];t.EnumerateChildren(r=>{r.IsEmpty()&&i.push(r)});for(let r=0;r<i.length;r++){let n=i[r],s=n.GetParent();s!==null&&(s.RemoveChildNode(n),s.IsEmpty()&&i.push(s))}}GetDefaultMaterialIndex(e){if(this.defaultMaterialIndex===null){let t=this.params.getDefaultMaterialColor(),i=new ee;i.color=t,i.isDefault=!0,this.defaultMaterialIndex=e.AddMaterial(i)}return this.defaultMaterialIndex}Reset(){this.defaultMaterialIndex=null}};function us(l,e){new hs(e).Finalize(l)}var J=class{constructor(){this.name=null,this.extension=null,this.callbacks=null,this.model=null,this.error=null,this.message=null}Import(e,t,i,r){this.Clear(),this.name=e,this.extension=t,this.callbacks=r,this.model=new Cr,this.error=!1,this.message=null,this.ResetContent(),this.ImportContent(i,()=>{this.CreateResult(r)})}Clear(){this.name=null,this.extension=null,this.callbacks=null,this.model=null,this.error=null,this.message=null,this.ClearContent()}CreateResult(e){if(this.error){e.onError(),e.onComplete();return}if(Pi(this.model)){this.SetError("The model doesn't contain any meshes."),e.onError(),e.onComplete();return}us(this.model,{getDefaultMaterialColor:this.callbacks.getDefaultMaterialColor}),e.onSuccess(),e.onComplete()}CanImportExtension(e){return!1}GetUpDirection(){return _.Z}ClearContent(){}ResetContent(){}ImportContent(e,t){}GetModel(){return this.model}SetError(e){this.error=!0,e!=null&&(this.message=e)}WasError(){return this.error}GetErrorMessage(){return this.message}};function st(l,e,t){let i=l.substring(e),r=i.indexOf(t);return r!==-1&&(i=i.substring(0,r)),i.trim()}function Ke(l,e){if(e!==null){let t=l.indexOf(e);t!==-1&&(l=l.substring(0,t).trim())}return l.split(/\s+/u)}function we(l,e){function t(n,s){let o=n.trim();o.length>0&&s(o)}let i=0,r=l.indexOf(`
`,i);for(;r!==-1;)t(l.substring(i,r),e),i=r+1,r=l.indexOf(`
`,i);t(l.substring(i),e)}function Ie(l){l.transparent=!1,fi(l.opacity,1)&&(l.transparent=!0)}var vr=class extends J{constructor(){super();this.rhino=null}CanImportExtension(e){return e==="3dm"}GetUpDirection(){return _.Z}ClearContent(){this.instanceIdToObject=null,this.instanceIdToDefinition=null}ResetContent(){this.instanceIdToObject=new Map,this.instanceIdToDefinition=new Map}ImportContent(e,t){this.rhino===null?he("loaders/rhino3dm.min.js").then(()=>{rhino3dm().then(i=>{this.rhino=i,this.ImportRhinoContent(e),t()})}).catch(()=>{t()}):(this.ImportRhinoContent(e),t())}ImportRhinoContent(e){let t=this.rhino.File3dm.fromByteArray(e);if(t===null){this.SetError("Failed to read Rhino file.");return}this.ImportRhinoDocument(t),Pi(this.model)&&this.SetError("The model doesn't contain any 3D meshes. Try to save the model while you are in shaded view in Rhino.")}ImportRhinoDocument(e){this.InitRhinoInstances(e),this.ImportRhinoUserStrings(e),this.ImportRhinoGeometry(e)}InitRhinoInstances(e){let t=e.objects();for(let r=0;r<t.count;r++){let n=t.get(r),s=n.attributes();s.isInstanceDefinitionObject&&this.instanceIdToObject.set(s.id,n)}let i=e.instanceDefinitions();for(let r=0;r<i.count();r++){let n=i.get(r);this.instanceIdToDefinition.set(n.id,n)}}ImportRhinoUserStrings(e){let t=e.strings();if(t.count()>0){let i=new Ue("Document user texts");for(let r=0;r<t.count();r++){let n=t.get(r);i.AddProperty(new O(P.Text,n[0],n[1]))}this.model.AddPropertyGroup(i)}}ImportRhinoGeometry(e){let t=e.objects();for(let i=0;i<t.count;i++){let r=t.get(i);this.ImportRhinoGeometryObject(e,r,[])}}ImportRhinoGeometryObject(e,t,i){let r=t.geometry(),n=t.attributes(),s=r.objectType;if(n.isInstanceDefinitionObject&&i.length===0)return;let o=null,a=!1;if(s===this.rhino.ObjectType.Mesh)o=r,a=!1;else if(s===this.rhino.ObjectType.Extrusion)o=r.getMesh(this.rhino.MeshType.Any),a=!0;else if(s===this.rhino.ObjectType.Brep){o=new this.rhino.Mesh;let h=r.faces();for(let u=0;u<h.count;u++){let d=h.get(u),m=d.getMesh(this.rhino.MeshType.Any);m&&(o.append(m),m.delete()),d.delete()}h.delete(),o.compact(),a=!0}else if(s===this.rhino.ObjectType.SubD)r.subdivide(3),o=this.rhino.Mesh.createFromSubDControlNet(r),a=!0;else if(s===this.rhino.ObjectType.InstanceReference){let h=r.parentIdefId;if(this.instanceIdToDefinition.has(h)){let d=this.instanceIdToDefinition.get(h).getObjectIds();for(let m=0;m<d.length;m++){let c=d[m];if(this.instanceIdToObject.has(c)){let g=this.instanceIdToObject.get(c);i.push(t),this.ImportRhinoGeometryObject(e,g,i),i.pop()}}}}o!==null&&(this.ImportRhinoMesh(e,o,t,i),a&&o.delete())}ImportRhinoMesh(e,t,i,r){let n=i.attributes(),s=this.GetMaterialIndex(e,i,r),o=t.toThreejsJSON(),a=Yt(o.data,s);a.SetName(n.name);let h=n.getUserStrings();if(h.length>0){let u=new Ue("User texts");for(let d=0;d<h.length;d++){let m=h[d];u.AddProperty(new O(P.Text,m[0],m[1]))}a.AddPropertyGroup(u)}if(r.length!==0){let u=new U().CreateIdentity();for(let m=r.length-1;m>=0;m--){let f=r[m].geometry().xform.toFloatArray(!1),p=new U(f);u=u.MultiplyMatrix(p)}let d=new q(u);it(a,d)}this.model.AddMeshToRootNode(a)}GetMaterialIndex(e,t,i){function r(o,a,h){let u=a.attributes();if(u.materialSource===o.ObjectMaterialSource.MaterialFromObject){let d=u.materialIndex;if(d>-1)return e.materials().get(d)}else if(u.materialSource===o.ObjectMaterialSource.MaterialFromLayer){let d=u.layerIndex;if(d>-1){let c=e.layers().get(d).renderMaterialIndex;if(c>-1)return e.materials().get(c)}}else if(u.materialSource===o.ObjectMaterialSource.MaterialFromParent&&h.length!==0)return r(o,h[0],[]);return null}function n(o,a){function h(c,g){c.Set(g.r,g.g,g.b)}function u(c){return c.r===0&&c.g===0&&c.b===0}function d(c){return c.r===255&&c.g===255&&c.b===255}let m=null;if(a===null)m=new ee,m.color.Set(255,255,255);else{let c=a.physicallyBased();c.supported?(m=new gt,m.metalness=c.metallic?1:0,m.roughness=c.roughness):(m=new ee,h(m.ambient,a.ambientColor),h(m.specular,a.specularColor)),m.name=a.name,h(m.color,a.diffuseColor),m.opacity=1-a.transparency,Ie(m),u(m.color)&&!d(a.reflectionColor)&&h(m.color,a.reflectionColor),u(m.color)&&!d(a.transparentColor)&&h(m.color,a.transparentColor)}for(let c=0;c<o.MaterialCount();c++)if(o.GetMaterial(c).IsEqual(m))return c;return o.AddMaterial(m)}let s=r(this.rhino,t,i);return n(this.model,s)}};var Ee=class{constructor(e,t){this.arrayBuffer=e,this.dataView=new DataView(e),this.isLittleEndian=t,this.position=0}GetPosition(){return this.position}SetPosition(e){this.position=e}GetByteLength(){return this.arrayBuffer.byteLength}Skip(e){this.position=this.position+e}End(){return this.position>=this.arrayBuffer.byteLength}ReadArrayBuffer(e){let t=new Uint8Array(this.arrayBuffer),i=new ArrayBuffer(e),r=new Uint8Array(i),n=t.subarray(this.position,this.position+e);return r.set(n,0),this.position+=e,i}ReadBoolean8(){let e=this.dataView.getInt8(this.position);return this.position=this.position+1,!!e}ReadCharacter8(){let e=this.dataView.getInt8(this.position);return this.position=this.position+1,e}ReadUnsignedCharacter8(){let e=this.dataView.getUint8(this.position);return this.position=this.position+1,e}ReadInteger16(){let e=this.dataView.getInt16(this.position,this.isLittleEndian);return this.position=this.position+2,e}ReadUnsignedInteger16(){let e=this.dataView.getUint16(this.position,this.isLittleEndian);return this.position=this.position+2,e}ReadInteger32(){let e=this.dataView.getInt32(this.position,this.isLittleEndian);return this.position=this.position+4,e}ReadUnsignedInteger32(){let e=this.dataView.getUint32(this.position,this.isLittleEndian);return this.position=this.position+4,e}ReadFloat32(){let e=this.dataView.getFloat32(this.position,this.isLittleEndian);return this.position=this.position+4,e}ReadDouble64(){let e=this.dataView.getFloat64(this.position,this.isLittleEndian);return this.position=this.position+8,e}};var A={MAIN3DS:19789,EDIT3DS:15677,EDIT_MATERIAL:45055,MAT_NAME:40960,MAT_AMBIENT:40976,MAT_DIFFUSE:40992,MAT_SPECULAR:41008,MAT_SHININESS:41024,MAT_SHININESS_STRENGTH:41025,MAT_TRANSPARENCY:41040,MAT_COLOR_F:16,MAT_COLOR:17,MAT_LIN_COLOR:18,MAT_LIN_COLOR_F:19,MAT_TEXMAP:41472,MAT_TEXMAP_NAME:41728,MAT_TEXMAP_UOFFSET:41816,MAT_TEXMAP_VOFFSET:41818,MAT_TEXMAP_USCALE:41812,MAT_TEXMAP_VSCALE:41814,MAT_TEXMAP_ROTATION:41820,PERCENTAGE:48,PERCENTAGE_F:49,EDIT_OBJECT:16384,OBJ_TRIMESH:16640,OBJ_LIGHT:17920,OBJ_CAMERA:18176,TRI_VERTEX:16656,TRI_TEXVERTEX:16704,TRI_FACE:16672,TRI_TRANSFORMATION:16736,TRI_MATERIAL:16688,TRI_SMOOTH:16720,KF3DS:45056,OBJECT_NODE:45058,OBJECT_HIERARCHY:45072,OBJECT_INSTANCE_NAME:45073,OBJECT_PIVOT:45075,OBJECT_POSITION:45088,OBJECT_ROTATION:45089,OBJECT_SCALE:45090,OBJECT_ID:45104},ds=class{constructor(){this.id=-1,this.name="",this.flags=-1,this.parentId=-1,this.instanceName="",this.pivot=[0,0,0],this.positions=[],this.rotations=[],this.scales=[]}},ms=class{constructor(){this.nodes=[],this.nodeIdToNode=new Map}IsEmpty(){return this.nodes.length===0}AddNode(e){this.nodes.push(e),this.nodeIdToNode.set(e.nodeId,e)}GetNodes(){return this.nodes}},Tr=class extends J{constructor(){super()}CanImportExtension(e){return e==="3ds"}GetUpDirection(){return _.Z}ClearContent(){this.materialNameToIndex=null,this.meshNameToIndex=null,this.nodeList=null}ResetContent(){this.materialNameToIndex=new Map,this.meshNameToIndex=new Map,this.nodeList=new ms}ImportContent(e,t){this.ProcessBinary(e),t()}ProcessBinary(e){let t=new Ee(e,!0),i=t.GetByteLength();this.ReadChunks(t,i,(r,n)=>{r===A.MAIN3DS?this.ReadMainChunk(t,n):this.SkipChunk(t,n)})}ReadMainChunk(e,t){let i=this.GetChunkEnd(e,t);this.ReadChunks(e,i,(r,n)=>{r===A.EDIT3DS?this.ReadEditorChunk(e,n):r===A.KF3DS?this.ReadKeyFrameChunk(e,n):this.SkipChunk(e,n)}),this.BuildNodeHierarchy()}ReadEditorChunk(e,t){let i=this.GetChunkEnd(e,t);this.ReadChunks(e,i,(r,n)=>{r===A.EDIT_MATERIAL?this.ReadMaterialChunk(e,n):r===A.EDIT_OBJECT?this.ReadObjectChunk(e,n):this.SkipChunk(e,n)})}ReadMaterialChunk(e,t){let i=new ee,r=this.GetChunkEnd(e,t),n=null,s=null;this.ReadChunks(e,r,(a,h)=>{a===A.MAT_NAME?i.name=this.ReadName(e):a===A.MAT_AMBIENT?i.ambient=this.ReadColorChunk(e,h):a===A.MAT_DIFFUSE?i.color=this.ReadColorChunk(e,h):a===A.MAT_SPECULAR?i.specular=this.ReadColorChunk(e,h):a===A.MAT_SHININESS?n=this.ReadPercentageChunk(e,h):a===A.MAT_SHININESS_STRENGTH?s=this.ReadPercentageChunk(e,h):a===A.MAT_TRANSPARENCY?(i.opacity=1-this.ReadPercentageChunk(e,h),Ie(i)):a===A.MAT_TEXMAP?(i.diffuseMap=this.ReadTextureMapChunk(e,h),Ie(i)):this.SkipChunk(e,h)}),n!==null&&s!==null&&(i.shininess=n*s/10);let o=this.model.AddMaterial(i);this.materialNameToIndex.set(i.name,o)}ReadTextureMapChunk(e,t){let i=new Ye,r=this.GetChunkEnd(e,t);return this.ReadChunks(e,r,(n,s)=>{if(n===A.MAT_TEXMAP_NAME){let o=this.ReadName(e),a=this.callbacks.getTextureBuffer(o);i.name=o,a!==null&&(i.url=a.url,i.buffer=a.buffer)}else n===A.MAT_TEXMAP_UOFFSET?i.offset.x=e.ReadFloat32():n===A.MAT_TEXMAP_VOFFSET?i.offset.y=e.ReadFloat32():n===A.MAT_TEXMAP_USCALE?i.scale.x=e.ReadFloat32():n===A.MAT_TEXMAP_VSCALE?i.scale.y=e.ReadFloat32():n===A.MAT_TEXMAP_ROTATION?i.rotation=e.ReadFloat32()*Gt:this.SkipChunk(e,s)}),i}ReadColorChunk(e,t){let i=new E(0,0,0),r=this.GetChunkEnd(e,t),n=!1;return this.ReadChunks(e,r,(s,o)=>{s===A.MAT_COLOR?n||(i.r=e.ReadUnsignedCharacter8(),i.g=e.ReadUnsignedCharacter8(),i.b=e.ReadUnsignedCharacter8()):s===A.MAT_LIN_COLOR?(i.r=e.ReadUnsignedCharacter8(),i.g=e.ReadUnsignedCharacter8(),i.b=e.ReadUnsignedCharacter8(),n=!0):s===A.MAT_COLOR_F?n||(i.r=be(e.ReadFloat32()),i.g=be(e.ReadFloat32()),i.b=be(e.ReadFloat32())):s===A.MAT_LIN_COLOR_F?(i.r=be(e.ReadFloat32()),i.g=be(e.ReadFloat32()),i.b=be(e.ReadFloat32()),n=!0):this.SkipChunk(e,o)}),i}ReadPercentageChunk(e,t){let i=0,r=this.GetChunkEnd(e,t);return this.ReadChunks(e,r,(n,s)=>{n===A.PERCENTAGE?i=e.ReadUnsignedInteger16()/100:n===A.PERCENTAGE_F?i=e.ReadFloat32():this.SkipChunk(e,s)}),i}ReadObjectChunk(e,t){let i=this.GetChunkEnd(e,t),r=this.ReadName(e);this.ReadChunks(e,i,(n,s)=>{n===A.OBJ_TRIMESH?this.ReadMeshChunk(e,s,r):this.SkipChunk(e,s)})}ReadMeshChunk(e,t,i){function r(u,d){if(!d.IsValid())return;let m=d.Determinant(),c=gi(m);c&&(d=new U().CreateScale(-1,1,1).MultiplyMatrix(d));let g=d.Invert();if(g===null)return;let f=new q(g);it(u,f),c&&Qn(u)}let n=new K;n.SetName(i);let s=this.GetChunkEnd(e,t),o=null;if(this.ReadChunks(e,s,(u,d)=>{u===A.TRI_VERTEX?this.ReadVerticesChunk(n,e):u===A.TRI_TEXVERTEX?this.ReadTextureVerticesChunk(n,e):u===A.TRI_FACE?this.ReadFacesChunk(n,e,d):u===A.TRI_TRANSFORMATION?o=this.ReadTransformationChunk(e):this.SkipChunk(e,d)}),n.VertexCount()===n.TextureUVCount())for(let u=0;u<n.TriangleCount();u++){let d=n.GetTriangle(u);d.SetTextureUVs(d.v0,d.v1,d.v2)}let a=new U(o);r(n,a);let h=this.model.AddMesh(n);this.meshNameToIndex.set(n.GetName(),h)}ReadVerticesChunk(e,t){let i=t.ReadUnsignedInteger16();for(let r=0;r<i;r++){let n=t.ReadFloat32(),s=t.ReadFloat32(),o=t.ReadFloat32();e.AddVertex(new M(n,s,o))}}ReadTextureVerticesChunk(e,t){let i=t.ReadUnsignedInteger16();for(let r=0;r<i;r++){let n=t.ReadFloat32(),s=t.ReadFloat32();e.AddTextureUV(new R(n,s))}}ReadFacesChunk(e,t,i){let r=this.GetChunkEnd(t,i),n=t.ReadUnsignedInteger16();for(let s=0;s<n;s++){let o=t.ReadUnsignedInteger16(),a=t.ReadUnsignedInteger16(),h=t.ReadUnsignedInteger16();t.ReadUnsignedInteger16(),e.AddTriangle(new j(o,a,h))}this.ReadChunks(t,r,(s,o)=>{s===A.TRI_MATERIAL?this.ReadFaceMaterialsChunk(e,t):s===A.TRI_SMOOTH?this.ReadFaceSmoothingGroupsChunk(e,n,t):this.SkipChunk(t,o)})}ReadFaceMaterialsChunk(e,t){let i=this.ReadName(t),r=this.materialNameToIndex.get(i),n=t.ReadUnsignedInteger16();for(let s=0;s<n;s++){let o=t.ReadUnsignedInteger16(),a=e.GetTriangle(o);r!==void 0&&(a.mat=r)}}ReadFaceSmoothingGroupsChunk(e,t,i){for(let r=0;r<t;r++){let n=i.ReadUnsignedInteger32(),s=e.GetTriangle(r);s.curve=n}}ReadTransformationChunk(e){let t=[];for(let i=0;i<4;i++){for(let r=0;r<3;r++)t.push(e.ReadFloat32());i<3?t.push(0):t.push(1)}return t}ReadKeyFrameChunk(e,t){let i=this.GetChunkEnd(e,t);this.ReadChunks(e,i,(r,n)=>{r===A.OBJECT_NODE?this.ReadObjectNodeChunk(e,n):this.SkipChunk(e,n)})}BuildNodeHierarchy(){function e(i,r){function n(h){return h.positions.length===0?[0,0,0]:h.positions[0]}function s(h){function u(m){let c=[0,0,0,1],g=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]);if(g>0){let f=m[3]*-.5,p=Math.sin(f)/g;c=[p*m[0],p*m[1],p*m[2],Math.cos(f)]}return c}if(h.rotations.length===0)return[0,0,0,1];let d=h.rotations[0];return u(d)}function o(h){return h.scales.length===0?[1,1,1]:h.scales[0]}let a=new U;if(a.ComposeTRS(qe(n(i)),Vt(s(i)),qe(o(i))),r){let h=i.pivot;a=new U().CreateTranslation(-h[0],-h[1],-h[2]).MultiplyMatrix(a)}return new q(a)}let t=this.model.GetRootNode();if(this.nodeList.IsEmpty())for(let i=0;i<this.model.MeshCount();i++)t.AddMeshIndex(i);else{let i=new Map;for(let r of this.nodeList.GetNodes()){let n=new Fe;r.name.length>0&&r.name!=="$$$DUMMY"&&(n.SetName(r.name),r.instanceName.length>0&&n.SetName(n.GetName()+" "+r.instanceName)),r.parentId===65535||!i.has(r.parentId)?t.AddChildNode(n):i.get(r.parentId).AddChildNode(n),i.set(r.id,n);let s=this.meshNameToIndex.has(r.name);n.SetTransformation(e(r,s)),s&&(n.SetType(Te.MeshNode),n.AddMeshIndex(this.meshNameToIndex.get(r.name)))}}}ReadObjectNodeChunk(e,t){function i(s,o,a){let h=[];o.Skip(10);let u=o.ReadInteger32();for(let d=0;d<u;d++){o.ReadInteger32(),o.ReadUnsignedInteger16()!==0&&o.ReadFloat32();let c=null;if(a===A.OBJECT_ROTATION){let g=o.ReadFloat32();c=s.ReadVector(o),c[3]=g}else c=s.ReadVector(o);h.push(c)}return h}let r=new ds,n=this.GetChunkEnd(e,t);this.ReadChunks(e,n,(s,o)=>{s===A.OBJECT_HIERARCHY?(r.name=this.ReadName(e),r.flags=e.ReadUnsignedInteger32(),r.parentId=e.ReadUnsignedInteger16()):s===A.OBJECT_INSTANCE_NAME?r.instanceName=this.ReadName(e):s===A.OBJECT_PIVOT?r.pivot=this.ReadVector(e):s===A.OBJECT_POSITION?r.positions=i(this,e,A.OBJECT_POSITION):s===A.OBJECT_ROTATION?r.rotations=i(this,e,A.OBJECT_ROTATION):s===A.OBJECT_SCALE?r.scales=i(this,e,A.OBJECT_SCALE):s===A.OBJECT_ID?r.id=e.ReadUnsignedInteger16():this.SkipChunk(e,o)}),this.nodeList.AddNode(r)}ReadName(e){let t="",i=0,r=0;for(;r<64&&(i=e.ReadCharacter8(),i!==0);)t=t+String.fromCharCode(i),r=r+1;return t}ReadVector(e){return[e.ReadFloat32(),e.ReadFloat32(),e.ReadFloat32()]}ReadChunks(e,t,i){for(;e.GetPosition()<=t-6;){let r=e.ReadUnsignedInteger16(),n=e.ReadUnsignedInteger32();i(r,n)}}GetChunkEnd(e,t){return e.GetPosition()+t-6}SkipChunk(e,t){e.Skip(t-6)}};var Ut=class{constructor(e,t,i,r){this.x=e,this.y=t,this.z=i,this.w=r}Clone(){return new Ut(this.x,this.y,this.z,this.w)}};var Se={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126},Pe={SCALAR:0,VEC2:1,VEC3:2,VEC4:3,MAT2:4,MAT3:5,MAT4:6},Ct={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Ir={GLTF_STRING:1179937895,JSON_CHUNK_TYPE:1313821514,BINARY_CHUNK_TYPE:5130562};function Kt(l){return $e(Wt(l[0]),Wt(l[1]),Wt(l[2]))}function no(l,e){function t(i,r){let n=i;return r!==Se.FLOAT&&(n/=255),be(Wt(n))}return new E(t(l[0],e),t(l[1],e),t(l[2],e))}var fs=class{constructor(e){this.reader=new Ee(e,!0),this.componentType=null,this.dataType=null,this.byteStride=null,this.dataCount=null,this.sparseReader=null}SetComponentType(e){this.componentType=e}SetDataType(e){e==="SCALAR"?this.dataType=Pe.SCALAR:e==="VEC2"?this.dataType=Pe.VEC2:e==="VEC3"?this.dataType=Pe.VEC3:e==="VEC4"?this.dataType=Pe.VEC4:e==="MAT2"?this.dataType=Pe.MAT2:e==="MAT3"?this.dataType=Pe.MAT3:e==="MAT4"&&(this.dataType=Pe.MAT4)}SetByteStride(e){this.byteStride=e}SetDataCount(e){this.dataCount=e}SetSparseReader(e,t){this.sparseReader={indexReader:e,valueReader:t}}ReadArrayBuffer(e){return this.reader.ReadArrayBuffer(e)}GetDataCount(){return this.dataCount}ReadData(){if(this.dataType===null)return null;if(this.dataType===Pe.SCALAR){let e=this.ReadComponent();return this.SkipBytesByStride(1),e}else if(this.dataType===Pe.VEC2){let e=this.ReadComponent(),t=this.ReadComponent();return this.SkipBytesByStride(2),new R(e,t)}else if(this.dataType===Pe.VEC3){let e=this.ReadComponent(),t=this.ReadComponent(),i=this.ReadComponent();return this.SkipBytesByStride(3),new M(e,t,i)}else if(this.dataType===Pe.VEC4){let e=this.ReadComponent(),t=this.ReadComponent(),i=this.ReadComponent(),r=this.ReadComponent();return this.SkipBytesByStride(4),new Ut(e,t,i,r)}return null}EnumerateData(e){if(this.sparseReader===null)for(let t=0;t<this.dataCount;t++)e(this.ReadData());else{let t=[];for(let r=0;r<this.sparseReader.indexReader.GetDataCount();r++){let n=this.sparseReader.indexReader.ReadData(),s=this.sparseReader.valueReader.ReadData();t.push({index:n,value:s})}let i=0;for(let r=0;r<this.dataCount;r++){let n=this.ReadData();i<t.length&&t[i].index===r?(e(t[i].value),i+=1):e(n)}}}SkipBytes(e){this.reader.Skip(e)}ReadComponent(){return this.componentType===null?null:this.componentType===Se.BYTE?this.reader.ReadCharacter8():this.componentType===Se.UNSIGNED_BYTE?this.reader.ReadUnsignedCharacter8():this.componentType===Se.SHORT?this.reader.ReadInteger16():this.componentType===Se.UNSIGNED_SHORT?this.reader.ReadUnsignedInteger16():this.componentType===Se.UNSIGNED_INT?this.reader.ReadInteger32():this.componentType===Se.FLOAT?this.reader.ReadFloat32():null}SkipBytesByStride(e){if(this.byteStride===null)return;let t=e*this.GetComponentSize();this.reader.Skip(this.byteStride-t)}GetComponentSize(){return this.componentType===Se.BYTE||this.componentType===Se.UNSIGNED_BYTE?1:this.componentType===Se.SHORT||this.componentType===Se.UNSIGNED_SHORT?2:this.componentType===Se.UNSIGNED_INT||this.componentType===Se.FLOAT?4:0}},cs=class{constructor(){this.supportedExtensions=["KHR_draco_mesh_compression","KHR_materials_pbrSpecularGlossiness","KHR_texture_transform"],this.draco=null}LoadLibraries(e,t){if(e===void 0){t.onSuccess();return}this.draco===null&&e.indexOf("KHR_draco_mesh_compression")!==-1?he("loaders/draco_decoder.js").then(()=>{DracoDecoderModule().then(i=>{this.draco=i,t.onSuccess()})}).catch(()=>{t.onError()}):t.onSuccess()}GetUnsupportedExtensions(e){let t=[];if(e===void 0)return t;for(let i=0;i<e.length;i++){let r=e[i];this.supportedExtensions.indexOf(r)===-1&&t.push(r)}return t}ProcessMaterial(e,t,i){if(e.extensions===void 0)return null;let r=e.extensions.KHR_materials_pbrSpecularGlossiness;if(r===void 0)return null;let n=new ee,s=r.diffuseFactor;s!==void 0&&(n.color=Kt(s),n.opacity=s[3]);let o=r.diffuseTexture;o!==void 0&&(n.diffuseMap=i(o));let a=r.specularFactor;a!==void 0&&(n.specular=Kt(a));let h=r.specularGlossinessTexture;h!==void 0&&(n.specularMap=i(h));let u=r.glossinessFactor;return u!==void 0&&(n.shininess=u),n}ProcessTexture(e,t){if(e.extensions===void 0)return;let i=e.extensions.KHR_texture_transform;i!==void 0&&(i.offset!==void 0&&(t.offset.x=i.offset[0],t.offset.y=-i.offset[1]),i.scale!==void 0&&(t.scale.x=i.scale[0],t.scale.y=i.scale[1]),i.rotation!==void 0&&(t.rotation=-i.rotation))}ProcessPrimitive(e,t,i,r){function n(N,L,B,ne,H){let pe=L.GetAttributeByUniqueId(B,ne),Le=pe.num_components(),wt=B.num_points()*Le,Et=wt*4,ht=N._malloc(Et);L.GetAttributeDataArrayForAllPoints(B,pe,N.DT_FLOAT32,Et,ht);let te=new Float32Array(N.HEAPF32.buffer,ht,wt).slice();if(Le===2)for(let z=0;z<te.length;z+=2)H(new R(te[z+0],te[z+1]));else if(Le===3)for(let z=0;z<te.length;z+=3)H(new M(te[z+0],te[z+1],te[z+2]));else if(Le===4)for(let z=0;z<te.length;z+=4)H(new Ut(te[z+0],te[z+1],te[z+2],te[z+3]));N._free(ht)}if(this.draco===null||i.extensions===void 0||i.extensions.KHR_draco_mesh_compression===void 0)return!1;let s=new this.draco.Decoder,o=new this.draco.DecoderBuffer,a=i.extensions.KHR_draco_mesh_compression,h=t.bufferViews[a.bufferView],d=e.GetReaderFromBufferView(h).ReadArrayBuffer(h.byteLength);if(o.Init(new Int8Array(d),d.byteLength),s.GetEncodedGeometryType(o)!==this.draco.TRIANGULAR_MESH)return!0;let c=new this.draco.Mesh;if(!s.DecodeBufferToMesh(o,c).ok())return!0;let f=a.attributes.POSITION!==void 0,p=!1,x=a.attributes.NORMAL!==void 0,C=a.attributes.TEXCOORD_0!==void 0;if(!f)return!0;let I=r.VertexCount(),T=r.VertexColorCount(),S=r.NormalCount(),w=r.TextureUVCount();n(this.draco,s,c,a.attributes.POSITION,N=>{r.AddVertex(N)}),x&&n(this.draco,s,c,a.attributes.NORMAL,N=>{r.AddNormal(N)}),C&&n(this.draco,s,c,a.attributes.TEXCOORD_0,N=>{N.y=-N.y,r.AddTextureUV(N)});let D=c.num_faces()*3,y=D*4,G=this.draco._malloc(y);s.GetTrianglesUInt32Array(c,y,G);let k=new Uint32Array(this.draco.HEAPU32.buffer,G,D).slice();for(let N=0;N<k.length;N+=3){let L=k[N],B=k[N+1],ne=k[N+2];e.AddTriangle(i,r,L,B,ne,p,x,C,I,T,S,w)}return this.draco._free(G),!0}},Sr=class extends J{constructor(){super();this.gltfExtensions=new cs}CanImportExtension(e){return e==="gltf"||e==="glb"}GetUpDirection(){return _.Y}ClearContent(){this.bufferContents=null,this.imageIndexToTextureParams=null}ResetContent(){this.bufferContents=[],this.imageIndexToTextureParams=new Map}ImportContent(e,t){this.extension==="gltf"?this.ProcessGltf(e,t):this.extension==="glb"&&this.ProcessBinaryGltf(e,t)}ProcessGltf(e,t){let i=oe(e),r=JSON.parse(i);if(r.asset.version!=="2.0"){this.SetError("Invalid glTF version."),t();return}for(let n=0;n<r.buffers.length;n++){let s=null,o=r.buffers[n],a=jt(o.uri);if(a!==null)s=a.buffer;else{let h=this.callbacks.getFileBuffer(o.uri);h!==null&&(s=h)}if(s===null){this.SetError("One of the requested buffers is missing."),t();return}this.bufferContents.push(s)}this.ProcessMainFile(r,t)}ProcessBinaryGltf(e,t){function i(h){let u=h.ReadUnsignedInteger32(),d=h.ReadUnsignedInteger32(),m=h.ReadArrayBuffer(u);return{type:d,buffer:m}}let r=new Ee(e,!0);if(r.ReadUnsignedInteger32()!==Ir.GLTF_STRING){this.SetError("Invalid glTF file."),t();return}if(r.ReadUnsignedInteger32()!==2){this.SetError("Invalid glTF version."),t();return}if(r.ReadUnsignedInteger32()!==r.GetByteLength()){this.SetError("Invalid glTF file."),t();return}let a=null;for(;!r.End();){let h=i(r);h.type===Ir.JSON_CHUNK_TYPE?a=oe(h.buffer):h.type===Ir.BINARY_CHUNK_TYPE&&this.bufferContents.push(h.buffer)}if(a!==null){let h=JSON.parse(a);this.ProcessMainFile(h,t)}}ProcessMainFile(e,t){let i=this.gltfExtensions.GetUnsupportedExtensions(e.extensionsRequired);if(i.length>0){this.SetError("Unsupported extension: "+i.join(", ")+"."),t();return}this.gltfExtensions.LoadLibraries(e.extensionsRequired,{onSuccess:()=>{this.ImportModel(e),t()},onError:()=>{this.SetError("Failed to load draco decoder."),t()}})}ImportModel(e){let t=e.materials;if(t!==void 0)for(let r of t)this.ImportMaterial(e,r);let i=e.meshes;if(i!==void 0)for(let r of i)this.ImportMesh(e,r);this.ImportNodes(e),this.ImportModelProperties(e)}ImportModelProperties(e){function t(i,r,n){let s=new Ue(r);for(let o in n)if(Object.prototype.hasOwnProperty.call(n,o)&&typeof n[o]=="string"){let a=new O(P.Text,o,n[o]);s.AddProperty(a)}return s.PropertyCount()>0&&i.AddPropertyGroup(s),s}t(this.model,"Asset properties",e.asset),e.asset.extras&&t(this.model,"Extras",e.asset.extras)}GetDefaultScene(e){let t=e.scene||0;return t>=e.scenes.length?null:e.scenes[t]}ImportMaterial(e,t){let i=new gt;if(t.name!==void 0&&(i.name=t.name),i.color=Kt([1,1,1]),t.pbrMetallicRoughness!==void 0){let n=t.pbrMetallicRoughness.baseColorFactor;n!==void 0&&(i.color=Kt(n),i.opacity=n[3]);let s=t.pbrMetallicRoughness.metallicFactor;s!==void 0&&(i.metalness=s);let o=t.pbrMetallicRoughness.roughnessFactor;o!==void 0&&(i.roughness=o);let a=t.emissiveFactor;a!==void 0&&(i.emissive=Kt(a)),i.diffuseMap=this.ImportTexture(e,t.pbrMetallicRoughness.baseColorTexture),i.metalnessMap=this.ImportTexture(e,t.pbrMetallicRoughness.metallicRoughnessTexture),i.normalMap=this.ImportTexture(e,t.normalTexture),i.emissiveMap=this.ImportTexture(e,t.emissiveTexture),i.diffuseMap!==null&&(i.multiplyDiffuseMap=!0);let h=t.alphaMode;h!==void 0&&(h==="BLEND"?i.transparent=!0:h==="MASK"&&(i.transparent=!0,i.alphaTest=t.alphaCutoff||.5))}let r=this.gltfExtensions.ProcessMaterial(t,i,n=>this.ImportTexture(e,n));r!==null&&(i=r),this.model.AddMaterial(i)}ImportTexture(e,t){if(t==null)return null;let i=new Ye,n=e.textures[t.index].source,s=e.images[n],o=null;if(this.imageIndexToTextureParams.has(n))o=this.imageIndexToTextureParams.get(n);else{o={name:null,url:null,buffer:null};let a=n.toString();if(s.uri!==void 0){let h=jt(s.uri);if(h!==null)o.name="Embedded_"+a+"."+Pt(h.mimeType),o.url=nr(h.buffer,h.mimeType),o.buffer=h.buffer;else{let u=this.callbacks.getTextureBuffer(s.uri);o.name=s.uri,u!==null&&(o.url=u.url,o.buffer=u.buffer)}}else if(s.bufferView!==void 0){let h=e.bufferViews[s.bufferView],u=this.GetReaderFromBufferView(h);if(u!==null){let d=u.ReadArrayBuffer(h.byteLength);o.name="Binary_"+a+"."+Pt(s.mimeType),o.url=nr(d,s.mimeType),o.buffer=d}}this.imageIndexToTextureParams.set(n,o)}return i.name=o.name,i.url=o.url,i.buffer=o.buffer,this.gltfExtensions.ProcessTexture(t,i),i}ImportMesh(e,t){let i=new K;this.model.AddMesh(i),t.name!==void 0&&i.SetName(t.name);for(let r=0;r<t.primitives.length;r++){let n=t.primitives[r];this.ImportPrimitive(e,n,i)}}ImportPrimitive(e,t,i){if(this.gltfExtensions.ProcessPrimitive(this,e,t,i)||t.attributes===void 0)return;let r=t.attributes.POSITION!==void 0,n=t.attributes.COLOR_0!==void 0,s=t.attributes.NORMAL!==void 0,o=t.attributes.TEXCOORD_0!==void 0,a=t.indices!==void 0,h=Ct.TRIANGLES;if(t.mode!==void 0&&(h=t.mode),h!==Ct.TRIANGLES&&h!==Ct.TRIANGLE_STRIP&&h!==Ct.TRIANGLE_FAN)return;let u=i.VertexCount(),d=i.VertexColorCount(),m=i.NormalCount(),c=i.TextureUVCount();if(r){let f=e.accessors[t.attributes.POSITION],p=this.GetReaderFromAccessor(e,f);if(p===null)return;p.EnumerateData(x=>{i.AddVertex(x)})}else return;if(n){let f=e.accessors[t.attributes.COLOR_0],p=this.GetReaderFromAccessor(e,f);if(p===null)return;p.EnumerateData(x=>{let C=no([x.x,x.y,x.z],p.componentType);i.AddVertexColor(C)})}if(s){let f=e.accessors[t.attributes.NORMAL],p=this.GetReaderFromAccessor(e,f);if(p===null)return;p.EnumerateData(x=>{i.AddNormal(x)})}if(o){let f=e.accessors[t.attributes.TEXCOORD_0],p=this.GetReaderFromAccessor(e,f);if(p===null)return;p.EnumerateData(x=>{x.y=-x.y,i.AddTextureUV(x)})}let g=[];if(a){let f=e.accessors[t.indices],p=this.GetReaderFromAccessor(e,f);if(p===null)return;p.EnumerateData(x=>{g.push(x)})}else for(let f=0;f<i.VertexCount();f++)g.push(f);if(h===Ct.TRIANGLES)for(let f=0;f<g.length;f+=3){let p=g[f],x=g[f+1],C=g[f+2];this.AddTriangle(t,i,p,x,C,n,s,o,u,d,m,c)}else if(h===Ct.TRIANGLE_STRIP)for(let f=0;f<g.length-2;f++){let p=g[f],x=g[f+1],C=g[f+2];if(f%2===1){let I=x;x=C,C=I}this.AddTriangle(t,i,p,x,C,n,s,o,u,d,m,c)}else if(h===Ct.TRIANGLE_FAN)for(let f=1;f<g.length-1;f++){let p=g[0],x=g[f],C=g[f+1];this.AddTriangle(t,i,p,x,C,n,s,o,u,d,m,c)}}AddTriangle(e,t,i,r,n,s,o,a,h,u,d,m){let c=new j(h+i,h+r,h+n);s&&c.SetVertexColors(u+i,u+r,u+n),o&&c.SetNormals(d+i,d+r,d+n),a&&c.SetTextureUVs(m+i,m+r,m+n),e.material!==void 0&&(c.mat=e.material),t.AddTriangle(c)}ImportNodes(e){let t=this.GetDefaultScene(e);if(t===null)return;let i=this.model.GetRootNode();for(let r of t.nodes){let n=e.nodes[r];this.ImportNode(e,n,i)}}ImportNode(e,t,i){function r(s){let o=new U().CreateIdentity();if(s.matrix!==void 0)o.Set(s.matrix);else{let a=[0,0,0],h=[0,0,0,1],u=[1,1,1];s.translation!==void 0&&(a=s.translation),s.rotation!==void 0&&(h=s.rotation),s.scale!==void 0&&(u=s.scale),o.ComposeTRS(qe(a),Vt(h),qe(u))}return new q(o)}if(t.children===void 0&&t.mesh===void 0)return;let n=new Fe;if(t.name!==void 0&&n.SetName(t.name),n.SetTransformation(r(t)),i.AddChildNode(n),t.children!==void 0)for(let s of t.children){let o=e.nodes[s];this.ImportNode(e,o,n)}t.mesh!==void 0&&((t.children===void 0||t.children.length===0)&&n.SetType(Te.MeshNode),n.AddMeshIndex(t.mesh))}GetReaderFromBufferView(e){let t=e.buffer||0,i=this.bufferContents[t];if(i==null)return null;let r=new fs(i);r.SkipBytes(e.byteOffset||0);let n=e.byteStride;return n!==void 0&&n!==0&&r.SetByteStride(n),r}GetReaderFromAccessor(e,t){let i=t.bufferView||0,r=e.bufferViews[i],n=this.GetReaderFromBufferView(r);if(n===null)return null;if(n.SetComponentType(t.componentType),n.SetDataType(t.type),n.SetDataCount(t.count),n.SkipBytes(t.byteOffset||0),t.sparse!==void 0){let s=this.GetReaderFromSparseAccessor(e,t.sparse.indices,t.sparse.indices.componentType,"SCALAR",t.sparse.count),o=this.GetReaderFromSparseAccessor(e,t.sparse.values,t.componentType,t.type,t.sparse.count);s!==null&&o!==null&&n.SetSparseReader(s,o)}return n}GetReaderFromSparseAccessor(e,t,i,r,n){if(t.bufferView===void 0)return null;let s=e.bufferViews[t.bufferView],o=this.GetReaderFromBufferView(s);return o===null?null:(o.SetComponentType(i),o.SetDataType(r),o.SetDataCount(n),o.SkipBytes(t.byteOffset||0),o)}};var Mr=class extends J{constructor(){super();this.ifc=null}CanImportExtension(e){return e==="ifc"}GetUpDirection(){return _.Y}ClearContent(){this.materialNameToIndex=null,this.expressIDToMesh=null}ResetContent(){this.materialNameToIndex=new Map,this.expressIDToMesh=new Map}ImportContent(e,t){this.ifc===null?he("loaders/web-ifc-api-browser.js").then(()=>{this.ifc=new WebIFC.IfcAPI,this.ifc.Init().then(()=>{this.ImportIfcContent(e),t()})}).catch(()=>{t()}):(this.ImportIfcContent(e),t())}ImportIfcContent(e){let t=new Uint8Array(e),i=this.ifc.OpenModel(t,{COORDINATE_TO_ORIGIN:!0}),r=this.ifc.LoadAllGeometry(i);for(let n=0;n<r.size();n++){let s=r.get(n);s.geometries.size()>0&&this.ImportIfcMesh(i,s)}this.ImportProperties(i),this.ifc.CloseModel(i)}ImportIfcMesh(e,t){let i=new K;i.SetName("Mesh "+t.expressID.toString());let r=0,n=t.geometries;for(let s=0;s<n.size();s++){let o=n.get(s),a=this.ifc.GetGeometry(e,o.geometryExpressID),h=this.ifc.GetVertexArray(a.GetVertexData(),a.GetVertexDataSize()),u=this.ifc.GetIndexArray(a.GetIndexData(),a.GetIndexDataSize()),d=this.GetMaterialIndexByColor(o.color),m=new U(o.flatTransformation),c=new q(m);for(let g=0;g<h.length;g+=6){let f=h[g],p=h[g+1],x=h[g+2],C=new M(f,p,x),I=c.TransformCoord3D(C);i.AddVertex(I)}for(let g=0;g<u.length;g+=3){let f=u[g],p=u[g+1],x=u[g+2],C=new j(r+f,r+p,r+x);C.SetMaterial(d),i.AddTriangle(C)}r+=h.length/6}this.expressIDToMesh.set(t.expressID,i),this.model.AddMeshToRootNode(i)}ImportProperties(e){let t=this.ifc.GetLineIDsWithType(e,WebIFC.IFCRELDEFINESBYPROPERTIES);for(let i=0;i<t.size();i++){let r=t.get(i),n=this.ifc.GetLine(e,r);Array.isArray(n.RelatingPropertyDefinition)||n.RelatedObjects.forEach(s=>{let o=null;if(this.expressIDToMesh.has(s.value)?o=this.expressIDToMesh.get(s.value):this.ifc.GetLine(e,s.value,!0).type===WebIFC.IFCBUILDING&&(o=this.model),o===null)return;let a=n.RelatingPropertyDefinition,h=this.ifc.GetLine(e,a.value,!0);if(!h||!h.HasProperties)return;let u=new Ue(h.Name.value);h.HasProperties.forEach(d=>{if(!d||!d.Name||!d.NominalValue)return;let m=null,c=this.GetIFCString(d.Name.value),g=null;switch(d.NominalValue.label){case"IFCTEXT":case"IFCLABEL":case"IFCIDENTIFIER":m=new O(P.Text,c,this.GetIFCString(d.NominalValue.value));break;case"IFCBOOLEAN":case"IFCLOGICAL":g="Unknown",d.NominalValue.value==="T"?g="True":d.NominalValue.value==="F"&&(g="False"),m=new O(P.Text,c,g);break;case"IFCINTEGER":case"IFCCOUNTMEASURE":m=new O(P.Integer,c,d.NominalValue.value);break;case"IFCREAL":case"IFCLENGTHMEASURE":case"IFCPOSITIVELENGTHMEASURE":case"IFCAREAMEASURE":case"IFCVOLUMEMEASURE":case"IFCRATIOMEASURE":case"IFCPOSITIVERATIOMEASURE":case"IFCMASSMEASURE":case"IFCMASSPERLENGTHMEASURE":case"IFCPLANEANGLEMEASURE":case"IFCTHERMALTRANSMITTANCEMEASURE":m=new O(P.Number,c,d.NominalValue.value);break;default:console.log(d.NominalValue.label),console.log(d.NominalValue.value);break}m!==null&&u.AddProperty(m)}),u.PropertyCount()>0&&o.AddPropertyGroup(u)})}}GetMaterialIndexByColor(e){let t=$e(e.x,e.y,e.z),i="Color "+ge(t.r)+ge(t.g)+ge(t.b)+ge(parseInt(e.w*255,10));if(this.materialNameToIndex.has(i))return this.materialNameToIndex.get(i);{let r=new ee;r.name=i,r.color=t,r.opacity=e.w,Ie(r);let n=this.model.AddMaterial(r);return this.materialNameToIndex.set(i,n),n}}GetIFCString(e){let t=this.DecodeIFCString(e);return t.length===0&&(t="-"),t}DecodeIFCString(e){let t=/\\X2\\(.*?)\\X0\\/uig,i=e,r=t.exec(e);for(;r;){let n=String.fromCharCode(parseInt(r[1],16));i=i.replace(r[0],n),r=t.exec(e)}return i}};var Bi=class{constructor(){this.name=null,this.material=null}SetName(e){return this.name=e,this}SetMaterial(e){return this.material=e,this}},Jt=class{constructor(e){this.params=e||new Bi,this.mesh=new K,this.params.name!==null&&this.mesh.SetName(this.params.name),this.curve=null}GetMesh(){return this.mesh}AddVertex(e,t,i){let r=new M(e,t,i);return this.mesh.AddVertex(r)}AddVertices(e){let t=[];for(let i=0;i<e.length;i++){let r=e[i];t.push(this.AddVertex(r.x,r.y,r.z))}return t}SetCurve(e){this.curve=e}ResetCurve(){this.curve=null}AddTriangle(e,t,i){let r=new j(e,t,i);return this.params.material!==null&&(r.mat=this.params.material),this.curve!==null&&r.SetCurve(this.curve),this.mesh.AddTriangle(r)}AddTriangleInverted(e,t,i){this.AddTriangle(e,i,t)}AddConvexPolygon(e){for(let t=0;t<e.length-2;t++)this.AddTriangle(e[0],e[t+1],e[t+2])}AddConvexPolygonInverted(e){for(let t=0;t<e.length-2;t++)this.AddTriangleInverted(e[0],e[t+1],e[t+2])}},Oi=class{constructor(e){this.generator=e}GenerateExtrude(e,t,i){let r=[],n=[];for(let s=0;s<e.length;s++){let o=e[s];n.push(this.generator.AddVertex(o.x,o.y,0)),r.push(this.generator.AddVertex(o.x,o.y,t))}this.generator.SetCurve(i),this.GenerateSurfaceBetweenPolygons(n,r),this.generator.ResetCurve(),this.generator.AddConvexPolygonInverted(n),this.generator.AddConvexPolygon(r)}GenerateSurfaceBetweenPolygons(e,t){if(e.length!==t.length)return;let i=e.length;for(let r=0;r<i;r++){let n=r,s=r<i-1?n+1:0;this.generator.AddConvexPolygon([e[n],e[s],t[s],t[n]])}}GenerateTriangleFan(e,t){let i=e.length;for(let r=0;r<i;r++){let n=r,s=r<i-1?n+1:0;this.generator.AddTriangle(t,e[n],e[s])}}};function ps(l,e,t,i){let r=new Jt(l),n=[new R(0,0),new R(e,0),new R(e,t),new R(0,t)];return new Oi(r).GenerateExtrude(n,i,null),r.GetMesh()}function gs(l,e,t,i,r){function n(u,d){return new R(u*Math.cos(d),u*Math.sin(d))}if(i<3)return null;let s=new Jt(l),o=[],a=2*Math.PI/i;for(let u=0;u<i;u++){let d=n(e,u*a);o.push(d)}return new Oi(s).GenerateExtrude(o,t,r?1:null),s.GetMesh()}function xs(l,e,t,i){function r(c,g,f){return new M(c*Math.sin(g)*Math.cos(f),c*Math.sin(g)*Math.sin(f),c*Math.cos(g))}if(t<3)return null;let n=new Jt(l),s=new Oi(n);n.SetCurve(i?1:null);let o=[],a=t+1,h=Math.PI/t,u=2*Math.PI/t;for(let c=1;c<a-1;c++){let g=[],f=c*h;for(let p=0;p<t;p++){let x=p*u,C=r(e,f,-x);g.push(n.AddVertex(C.x,C.y,C.z))}c>1&&s.GenerateSurfaceBetweenPolygons(o[o.length-1],g),o.push(g)}let d=n.AddVertex(0,0,e),m=n.AddVertex(0,0,-e);return s.GenerateTriangleFan(o[0].slice().reverse(),d),s.GenerateTriangleFan(o[o.length-1],m),n.ResetCurve(),n.GetMesh()}function Cs(l,e,t){function i(n,s,o,a,h){let u=new M(o,a,h);u.MultiplyScalar(s/u.Length()),n.AddVertex(u.x,u.y,u.z)}if(mi(t))return null;let r=new Jt(l);if(e==="tetrahedron"){let n=1;i(r,t,+n,+n,+n),i(r,t,-n,-n,+n),i(r,t,-n,+n,-n),i(r,t,+n,-n,-n),r.AddTriangle(0,1,3),r.AddTriangle(0,2,1),r.AddTriangle(0,3,2),r.AddTriangle(1,2,3)}else if(e==="hexahedron"){let n=1;i(r,t,+n,+n,+n),i(r,t,+n,+n,-n),i(r,t,+n,-n,+n),i(r,t,+n,-n,-n),i(r,t,-n,+n,+n),i(r,t,-n,+n,-n),i(r,t,-n,-n,+n),i(r,t,-n,-n,-n),r.AddConvexPolygon([0,1,5,4]),r.AddConvexPolygon([0,2,3,1]),r.AddConvexPolygon([0,4,6,2]),r.AddConvexPolygon([1,3,7,5]),r.AddConvexPolygon([2,6,7,3]),r.AddConvexPolygon([4,5,7,6])}else if(e==="octahedron"){let n=1,s=0;i(r,t,+n,+s,+s),i(r,t,-n,+s,+s),i(r,t,+s,+n,+s),i(r,t,+s,-n,+s),i(r,t,+s,+s,+n),i(r,t,+s,+s,-n),r.AddTriangle(0,2,4),r.AddTriangle(0,3,5),r.AddTriangle(0,4,3),r.AddTriangle(0,5,2),r.AddTriangle(1,2,5),r.AddTriangle(1,3,4),r.AddTriangle(1,4,2),r.AddTriangle(1,5,3)}else if(e==="dodecahedron"){let n=1,s=0,o=(1+Math.sqrt(5))/2,a=1/o;i(r,t,+n,+n,+n),i(r,t,+n,+n,-n),i(r,t,+n,-n,+n),i(r,t,-n,+n,+n),i(r,t,+n,-n,-n),i(r,t,-n,+n,-n),i(r,t,-n,-n,+n),i(r,t,-n,-n,-n),i(r,t,+s,+a,+o),i(r,t,+s,+a,-o),i(r,t,+s,-a,+o),i(r,t,+s,-a,-o),i(r,t,+a,+o,+s),i(r,t,+a,-o,+s),i(r,t,-a,+o,+s),i(r,t,-a,-o,+s),i(r,t,+o,+s,+a),i(r,t,-o,+s,+a),i(r,t,+o,+s,-a),i(r,t,-o,+s,-a),r.AddConvexPolygon([0,8,10,2,16]),r.AddConvexPolygon([0,16,18,1,12]),r.AddConvexPolygon([0,12,14,3,8]),r.AddConvexPolygon([1,9,5,14,12]),r.AddConvexPolygon([1,18,4,11,9]),r.AddConvexPolygon([2,10,6,15,13]),r.AddConvexPolygon([2,13,4,18,16]),r.AddConvexPolygon([3,14,5,19,17]),r.AddConvexPolygon([3,17,6,10,8]),r.AddConvexPolygon([4,13,15,7,11]),r.AddConvexPolygon([5,9,11,7,19]),r.AddConvexPolygon([6,17,19,7,15])}else if(e==="icosahedron"){let n=1,s=0,o=(1+Math.sqrt(5))/2;i(r,t,+s,+n,+o),i(r,t,+s,+n,-o),i(r,t,+s,-n,+o),i(r,t,+s,-n,-o),i(r,t,+n,+o,+s),i(r,t,+n,-o,+s),i(r,t,-n,+o,+s),i(r,t,-n,-o,+s),i(r,t,+o,+s,+n),i(r,t,+o,+s,-n),i(r,t,-o,+s,+n),i(r,t,-o,+s,-n),r.AddTriangle(0,2,8),r.AddTriangle(0,4,6),r.AddTriangle(0,6,10),r.AddTriangle(0,8,4),r.AddTriangle(0,10,2),r.AddTriangle(1,3,11),r.AddTriangle(1,4,9),r.AddTriangle(1,6,4),r.AddTriangle(1,9,3),r.AddTriangle(1,11,6),r.AddTriangle(2,5,8),r.AddTriangle(2,7,5),r.AddTriangle(2,10,7),r.AddTriangle(3,5,7),r.AddTriangle(3,7,11),r.AddTriangle(3,9,5),r.AddTriangle(4,8,9),r.AddTriangle(5,9,8),r.AddTriangle(6,11,10),r.AddTriangle(7,10,11)}return r.GetMesh()}var br=class extends J{constructor(){super()}CanImportExtension(e){return e==="o3dv"}GetUpDirection(){return _.Z}ClearContent(){}ResetContent(){}ImportContent(e,t){let i=oe(e),r=JSON.parse(i);if(r.root===void 0){t();return}if(r.materials!==void 0)for(let s=0;s<r.materials.length;s++){let o=r.materials[s];this.ImportMaterial(o)}if(r.meshes!==void 0)for(let s=0;s<r.meshes.length;s++){let o=r.meshes[s];this.ImportMesh(o)}let n=r.nodes[r.root];this.ImportNode(r,n,this.model.GetRootNode()),this.ImportProperties(this.model,r),t()}ImportMaterial(e){let t=new gt;t.color.Set(255,255,255),e.name!==void 0&&(t.name=e.name),e.color!==void 0&&(t.color=Dn(e.color)),t.metalness=nt(e.metalness,0),t.roughness=nt(e.roughness,1),this.model.AddMaterial(t)}ImportMesh(e){let t=new Bi;e.name!==void 0&&t.SetName(e.name),e.material!==void 0&&t.SetMaterial(e.material);let i=e.parameters;if(i===void 0)return;let r=null;if(e.type==="cuboid"){if(i.size_x===void 0||i.size_y===void 0||i.size_z===void 0)return;r=ps(t,i.size_x,i.size_y,i.size_z)}else if(e.type==="cylinder"){if(i.radius===void 0||i.height===void 0)return;let n=nt(i.segments,25),s=nt(i.smooth,!0);r=gs(t,i.radius,i.height,n,s)}else if(e.type==="sphere"){if(i.radius===void 0)return;let n=nt(i.segments,20),s=nt(i.smooth,!0);r=xs(t,i.radius,n,s)}else if(e.type==="platonic"){if(i.solid_type===void 0)return;let n=nt(i.radius,1);r=Cs(t,i.solid_type,n)}r!==null&&(this.ImportProperties(r,e),this.model.AddMesh(r))}ImportNode(e,t,i){if(t.name!==void 0&&i.SetName(t.name),t.transformation!==void 0){let r=this.GetTransformation(t.transformation);i.SetTransformation(r)}if(t.children!==void 0)for(let r of t.children){let n=e.nodes[r],s=new Fe;i.AddChildNode(s),this.ImportNode(e,n,s)}t.mesh!==void 0&&((t.children===void 0||t.children.length===0)&&i.SetType(Te.MeshNode),i.AddMeshIndex(t.mesh))}ImportProperties(e,t){if(t.properties!==void 0){let i=new Ue("Properties");e.AddPropertyGroup(i);for(let r of t.properties){let n=new O(P.Text,r.name,r.value);i.AddProperty(n)}}}GetTransformation(e){let t=new M(0,0,0),i=new Oe(0,0,0,1),r=new M(1,1,1);e.translation!==void 0&&(t=qe(e.translation)),e.rotation!==void 0&&(i=Vt(e.rotation)),e.scale!==void 0&&(r=qe(e.scale));let n=new U().ComposeTRS(t,i,r);return new q(n)}};var vs=class{constructor(e){this.mesh=e,this.globalToMeshVertices=new Map,this.globalToMeshVertexColors=new Map,this.globalToMeshNormals=new Map,this.globalToMeshUvs=new Map}AddVertex(e,t){return this.GetLocalIndex(e,t,this.globalToMeshVertices,i=>this.mesh.AddVertex(new M(i.x,i.y,i.z)))}AddVertexColor(e,t){return this.GetLocalIndex(e,t,this.globalToMeshVertexColors,i=>this.mesh.AddVertexColor(new E(i.r,i.g,i.b)))}AddNormal(e,t){return this.GetLocalIndex(e,t,this.globalToMeshNormals,i=>this.mesh.AddNormal(new M(i.x,i.y,i.z)))}AddUV(e,t){return this.GetLocalIndex(e,t,this.globalToMeshUvs,i=>this.mesh.AddTextureUV(new R(i.x,i.y)))}AddTriangle(e){this.mesh.AddTriangle(e)}GetLocalIndex(e,t,i,r){if(isNaN(e)||e<0||e>=t.length)return null;if(i.has(e))return i.get(e);{let n=t[e],s=r(n);return i.set(e,s),s}}};function Ui(l,e,t){return $e(parseFloat(l),parseFloat(e),parseFloat(t))}var yr=class extends J{constructor(){super()}CanImportExtension(e){return e==="obj"}GetUpDirection(){return _.Y}ClearContent(){this.globalVertices=null,this.globalVertexColors=null,this.globalNormals=null,this.globalUvs=null,this.currentMeshConverter=null,this.currentMaterial=null,this.currentMaterialIndex=null,this.meshNameToConverter=null,this.materialNameToIndex=null}ResetContent(){this.globalVertices=[],this.globalVertexColors=[],this.globalNormals=[],this.globalUvs=[],this.currentMeshConverter=null,this.currentMaterial=null,this.currentMaterialIndex=null,this.meshNameToConverter=new Map,this.materialNameToIndex=new Map}ImportContent(e,t){let i=oe(e);we(i,r=>{this.WasError()||this.ProcessLine(r)}),t()}ProcessLine(e){if(e[0]==="#")return;let t=Ke(e,"#");if(t.length===0)return;let i=t[0].toLowerCase();t.shift(),!this.ProcessMeshParameter(i,t,e)&&!this.ProcessMaterialParameter(i,t,e)}AddNewMesh(e){if(this.meshNameToConverter.has(e))this.currentMeshConverter=this.meshNameToConverter.get(e);else{let t=new K;t.SetName(e),this.model.AddMeshToRootNode(t),this.currentMeshConverter=new vs(t),this.meshNameToConverter.set(e,this.currentMeshConverter)}}ProcessMeshParameter(e,t,i){if(e==="g"||e==="o"){if(t.length===0)return!0;let r=st(i,e.length,"#");return this.AddNewMesh(r),!0}else{if(e==="v")return t.length<3||(this.globalVertices.push(new M(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),t.length>=6&&this.globalVertexColors.push(Ui(t[3],t[4],t[5]))),!0;if(e==="vn")return t.length<3||this.globalNormals.push(new M(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),!0;if(e==="vt")return t.length<2||this.globalUvs.push(new R(parseFloat(t[0]),parseFloat(t[1]))),!0;if(e==="f")return t.length<3||this.ProcessFace(t),!0}return!1}ProcessMaterialParameter(e,t,i){function r(n,s,o){let a=new Ye,h=st(s,n.length,"#"),u=o.getTextureBuffer(h);return a.name=h,u!==null&&(a.url=u.url,a.buffer=u.buffer),a}if(e==="newmtl"){if(t.length===0)return!0;let n=new ee,s=st(i,e.length,"#"),o=this.model.AddMaterial(n);return n.name=s,this.currentMaterial=n,this.materialNameToIndex.set(s,o),!0}else if(e==="usemtl"){if(t.length===0)return!0;let n=st(i,e.length,"#");return this.materialNameToIndex.has(n)&&(this.currentMaterialIndex=this.materialNameToIndex.get(n)),!0}else if(e==="mtllib"){if(t.length===0)return!0;let n=st(i,e.length,"#"),s=this.callbacks.getFileBuffer(n);if(s!==null){let o=oe(s);we(o,a=>{this.WasError()||this.ProcessLine(a)})}return!0}else{if(e==="map_kd")return this.currentMaterial===null||t.length===0||(this.currentMaterial.diffuseMap=r(e,i,this.callbacks),Ie(this.currentMaterial)),!0;if(e==="map_ks")return this.currentMaterial===null||t.length===0||(this.currentMaterial.specularMap=r(e,i,this.callbacks)),!0;if(e==="map_bump"||e==="bump")return this.currentMaterial===null||t.length===0||(this.currentMaterial.bumpMap=r(e,i,this.callbacks)),!0;if(e==="ka")return this.currentMaterial===null||t.length<3||(this.currentMaterial.ambient=Ui(t[0],t[1],t[2])),!0;if(e==="kd")return this.currentMaterial===null||t.length<3||(this.currentMaterial.color=Ui(t[0],t[1],t[2])),!0;if(e==="ks")return this.currentMaterial===null||t.length<3||(this.currentMaterial.specular=Ui(t[0],t[1],t[2])),!0;if(e==="ns")return this.currentMaterial===null||t.length<1||(this.currentMaterial.shininess=parseFloat(t[0])/1e3),!0;if(e==="tr")return this.currentMaterial===null||t.length<1||(this.currentMaterial.opacity=1-parseFloat(t[0]),Ie(this.currentMaterial)),!0;if(e==="d")return this.currentMaterial===null||t.length<1||(this.currentMaterial.opacity=parseFloat(t[0]),Ie(this.currentMaterial)),!0}return!1}ProcessFace(e){function t(o,a){return o>0?o-1:a+o}let i=[],r=[],n=[],s=[];for(let o=0;o<e.length;o++){let a=e[o].split("/");i.push(t(parseInt(a[0],10),this.globalVertices.length)),this.globalVertices.length===this.globalVertexColors.length&&r.push(t(parseInt(a[0],10),this.globalVertices.length)),a.length>1&&a[1].length>0&&s.push(t(parseInt(a[1],10),this.globalUvs.length)),a.length>2&&a[2].length>0&&n.push(t(parseInt(a[2],10),this.globalNormals.length))}this.currentMeshConverter===null&&this.AddNewMesh("");for(let o=0;o<i.length-2;o++){let a=this.currentMeshConverter.AddVertex(i[0],this.globalVertices),h=this.currentMeshConverter.AddVertex(i[o+1],this.globalVertices),u=this.currentMeshConverter.AddVertex(i[o+2],this.globalVertices);if(a===null||h===null||u===null){this.SetError("Invalid vertex index.");break}let d=new j(a,h,u);if(r.length===i.length){let m=this.currentMeshConverter.AddVertexColor(r[0],this.globalVertexColors),c=this.currentMeshConverter.AddVertexColor(r[o+1],this.globalVertexColors),g=this.currentMeshConverter.AddVertexColor(r[o+2],this.globalVertexColors);if(m===null||c===null||g===null){this.SetError("Invalid vertex color index.");break}d.SetVertexColors(m,c,g)}if(n.length===i.length){let m=this.currentMeshConverter.AddNormal(n[0],this.globalNormals),c=this.currentMeshConverter.AddNormal(n[o+1],this.globalNormals),g=this.currentMeshConverter.AddNormal(n[o+2],this.globalNormals);if(m===null||c===null||g===null){this.SetError("Invalid normal index.");break}d.SetNormals(m,c,g)}if(s.length===i.length){let m=this.currentMeshConverter.AddUV(s[0],this.globalUvs),c=this.currentMeshConverter.AddUV(s[o+1],this.globalUvs),g=this.currentMeshConverter.AddUV(s[o+2],this.globalUvs);if(m===null||c===null||g===null){this.SetError("Invalid uv index.");break}d.SetTextureUVs(m,c,g)}this.currentMaterialIndex!==null&&(d.mat=this.currentMaterialIndex),this.currentMeshConverter.AddTriangle(d)}}};var wr=class extends J{constructor(){super()}CanImportExtension(e){return e==="off"}GetUpDirection(){return _.Y}ClearContent(){this.mesh=null,this.status=null}ResetContent(){this.mesh=new K,this.model.AddMeshToRootNode(this.mesh),this.status={vertexCount:0,faceCount:0,foundVertex:0,foundFace:0}}ImportContent(e,t){let i=oe(e);we(i,r=>{this.WasError()||this.ProcessLine(r)}),t()}ProcessLine(e){if(e[0]==="#")return;let t=Ke(e,"#");if(t.length!==0&&t[0]!=="OFF"){if(this.status.vertexCount===0&&this.status.faceCount===0){t.length>1&&(this.status.vertexCount=parseInt(t[0],10),this.status.faceCount=parseInt(t[1],10));return}if(this.status.foundVertex<this.status.vertexCount){t.length>=3&&(this.mesh.AddVertex(new M(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),this.status.foundVertex+=1);return}if(this.status.foundFace<this.status.faceCount){if(t.length>=4){let i=parseInt(t[0],10);if(t.length<i+1)return;for(let r=0;r<i-2;r++){let n=parseInt(t[1]),s=parseInt(t[r+2]),o=parseInt(t[r+3]),a=new j(n,s,o);this.mesh.AddTriangle(a)}this.status.foundFace+=1}return}}}};var ot={Ok:1,NoVertices:2,NoFaces:3,UnknownError:4},Ts=class{constructor(){this.format=null,this.elements=[]}SetFormat(e){this.format=e}AddElement(e,t){this.elements.push({name:e,count:t,format:[]})}GetElements(){return this.elements}AddSingleFormat(e,t){this.elements[this.elements.length-1].format.push({name:t,isSingle:!0,elemType:e})}AddListFormat(e,t,i){this.elements[this.elements.length-1].format.push({name:i,isSingle:!1,countType:e,elemType:t})}GetElement(e){for(let t=0;t<this.elements.length;t++){let i=this.elements[t];if(i.name===e)return i}return null}Check(){let e=this.GetElement("vertex");if(e===null||e.length===0||e.format.length<3)return ot.NoVertices;let t=this.GetElement("face");if(this.format==="ascii"){if(t===null||t.count===0||t.format.length<0)return ot.NoFaces}else if(this.format==="binary_little_endian"||this.format==="binary_big_endian"){let i=this.GetElement("tristrips"),r=t!==null&&t.count>0&&t.format.length>0,n=i!==null&&i.count>0&&i.format.length>0;if(!r&&!n)return ot.NoFaces}else return ot.UnknownError;return ot.Ok}},Is=class{constructor(e){this.model=e,this.colorToMaterial=new Map}GetMaterialIndexByColor(e){let t="Color "+ge(e[0])+ge(e[1])+ge(e[2])+ge(e[3]);if(this.colorToMaterial.has(t))return this.colorToMaterial.get(t);{let i=new ee;i.name=t,i.color=new E(e[0],e[1],e[2]),i.opacity=e[3]/255,Ie(i);let r=this.model.AddMaterial(i);return this.colorToMaterial.set(t,r),r}}},Er=class extends J{constructor(){super()}CanImportExtension(e){return e==="ply"}GetUpDirection(){return _.Y}ClearContent(){this.mesh=null}ResetContent(){this.mesh=new K,this.model.AddMeshToRootNode(this.mesh)}ImportContent(e,t){let i=this.GetHeaderContent(e),r=this.ReadHeader(i),n=r.Check();if(n===ot.Ok)if(r.format==="ascii"){let s=oe(e);s=s.substring(i.length),this.ReadAsciiContent(r,s)}else(r.format==="binary_little_endian"||r.format==="binary_big_endian")&&this.ReadBinaryContent(r,e,i.length);else n===ot.NoVertices?this.SetError("The model contains no vertices."):n===ot.NoFaces?this.SetError("The model contains no faces."):this.SetError("Invalid header information.");t()}GetHeaderContent(e){let t="",i=new Uint8Array(e),r=0;for(r=0;r<e.byteLength&&(t+=String.fromCharCode(i[r]),!t.endsWith("end_header"));r++);for(r+=1;r<e.byteLength;){let n=String.fromCharCode(i[r]);if(t+=n,r+=1,n===`
`)break}return t}ReadHeader(e){let t=new Ts;return we(e,i=>{let r=Ke(i,null);r.length===0||r[0]==="comment"||r[0]!=="ply"&&(r[0]==="format"&&r.length>=2?t.SetFormat(r[1]):r[0]==="element"&&r.length>=3?t.AddElement(r[1],parseInt(r[2],10)):r[0]==="property"&&r.length>=3&&(r[1]==="list"&&r.length>=5?t.AddListFormat(r[2],r[3],r[4]):t.AddSingleFormat(r[1],r[2])))}),t}ReadAsciiContent(e,t){let i=e.GetElement("vertex"),r=e.GetElement("face"),n=0,s=0;we(t,o=>{if(this.WasError())return;let a=Ke(o,null);if(!(a.length===0||a[0]==="comment")){if(n<i.count){a.length>=3&&(this.mesh.AddVertex(new M(parseFloat(a[0]),parseFloat(a[1]),parseFloat(a[2]))),n+=1);return}if(r!==null&&s<r.count){if(a.length>=4){let h=parseInt(a[0],10);if(a.length<h+1)return;for(let u=0;u<h-2;u++){let d=parseInt(a[1]),m=parseInt(a[u+2]),c=parseInt(a[u+3]),g=new j(d,m,c);this.mesh.AddTriangle(g)}s+=1}return}}})}ReadBinaryContent(e,t,i){function r(u,d){function m(c,g){return g==="char"||g==="int8"?c.ReadCharacter8():g==="uchar"||g==="uint8"?c.ReadUnsignedCharacter8():g==="short"||g==="int16"?c.ReadInteger16():g==="ushort"||g==="uint16"?c.ReadUnsignedInteger16():g==="int"||g==="int32"?c.ReadInteger32():g==="uint"||g==="uint32"?c.ReadUnsignedInteger32():g==="float"||g==="float32"?c.ReadFloat32():g==="double"||g==="double64"?c.ReadDouble64():null}if(d.isSingle)return m(u,d.elemType);{let c=[],g=m(u,d.countType);for(let f=0;f<g;f++)c.push(m(u,d.elemType));return c}}function n(u,d,m){for(let c=m;c<d.length;c++)r(u,d[c])}function s(u,d,m){let c=null,g=null,f=null,p=255;for(let x=m;x<d.length;x++){let C=d[x],I=r(u,C);C.name==="red"?c=I:C.name==="green"?g=I:C.name==="blue"?f=I:C.name==="alpha"&&(p=I)}return c!==null&&g!==null&&f!==null?[c,g,f,p]:null}let o=null;if(e.format==="binary_little_endian")o=new Ee(t,!0);else if(e.format==="binary_big_endian")o=new Ee(t,!1);else return;o.Skip(i);let a=new Is(this.model),h=e.GetElements();for(let u=0;u<h.length;u++){let d=h[u];if(d.name==="vertex")for(let m=0;m<d.count;m++){let c=r(o,d.format[0]),g=r(o,d.format[1]),f=r(o,d.format[2]),p=s(o,d.format,3);p!==null&&this.mesh.AddVertexColor(new E(p[0],p[1],p[2])),this.mesh.AddVertex(new M(c,g,f))}else if(d.name==="face")for(let m=0;m<d.count;m++){let c=r(o,d.format[0]),g=s(o,d.format,1);for(let f=0;f<c.length-2;f++){let p=c[0],x=c[f+1],C=c[f+2],I=new j(p,x,C);g!==null?I.mat=a.GetMaterialIndexByColor(g):this.mesh.VertexColorCount()>0&&I.SetVertexColors(p,x,C),this.mesh.AddTriangle(I)}}else if(d.name==="tristrips")for(let m=0;m<d.count;m++){let c=r(o,d.format[0]);n(o,d.format,1);let g=!0;for(let f=0;f<c.length-2;f++){let p=c[f],x=c[f+1],C=c[f+2];if(C===-1){f+=2,g=!0;continue}if(!g){let T=x;x=C,C=T}g=!g;let I=new j(p,x,C);this.mesh.AddTriangle(I)}}else n(o,d.format,0)}}};var Dr=class extends J{constructor(){super()}CanImportExtension(e){return e==="stl"}GetUpDirection(){return _.Z}ClearContent(){this.mesh=null,this.triangle=null}ResetContent(){this.mesh=new K,this.model.AddMeshToRootNode(this.mesh),this.triangle=null}ImportContent(e,t){if(this.IsBinaryStlFile(e))this.ProcessBinary(e);else{let i=oe(e);we(i,r=>{this.WasError()||this.ProcessLine(r)})}t()}IsBinaryStlFile(e){let t=e.byteLength;if(t<84)return!1;let i=new Ee(e,!0);i.Skip(80);let r=i.ReadUnsignedInteger32();return t===r*50+84}ProcessLine(e){if(e[0]==="#")return;let t=Ke(e,"#");if(t.length===0)return;let i=t[0];if(i==="solid"){if(t.length>1){let r=st(e,i.length,"#");this.mesh.SetName(r)}return}if(i==="facet"){if(this.triangle=new j(-1,-1,-1),t.length>=5&&t[1]==="normal"){let r=new M(parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4]));if(er(r.Length())){let n=this.mesh.AddNormal(r);this.triangle.SetNormals(n,n,n)}}return}if(i==="vertex"&&this.triangle!==null){if(t.length>=4){let r=this.mesh.AddVertex(new M(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])));this.triangle.v0===-1?this.triangle.v0=r:this.triangle.v1===-1?this.triangle.v1=r:this.triangle.v2===-1&&(this.triangle.v2=r)}return}if(i==="endfacet"&&this.triangle!==null){this.triangle.v0!==-1&&this.triangle.v1!==-1&&this.triangle.v2!==null&&this.mesh.AddTriangle(this.triangle),this.triangle=null;return}}ProcessBinary(e){function t(s){let o=new M;return o.x=s.ReadFloat32(),o.y=s.ReadFloat32(),o.z=s.ReadFloat32(),o}function i(s,o){let a=t(o);return s.AddVertex(a)}let r=new Ee(e,!0);r.Skip(80);let n=r.ReadUnsignedInteger32();for(let s=0;s<n;s++){let o=t(r),a=i(this.mesh,r),h=i(this.mesh,r),u=i(this.mesh,r);r.Skip(2);let d=new j(a,h,u);if(er(o.Length())){let m=this.mesh.AddNormal(o);d.SetNormals(m,m,m)}this.mesh.AddTriangle(d)}}};var Zt=class extends J{constructor(){super()}GetExternalLibraries(){return null}CreateLoader(e){return null}GetMainObject(e){return e}IsMeshVisible(e){return!0}ClearContent(){this.loader=null,this.materialIdToIndex=null,this.objectUrlToFileName=null}ResetContent(){this.loader=null,this.materialIdToIndex=new Map,this.objectUrlToFileName=new Map}ImportContent(e,t){async function i(n,s,o){try{for(let a=0;a<n.length;a++)await he(n[a])}catch{o()}s()}let r=this.GetExternalLibraries();if(r===null){t();return}i(r,()=>{this.LoadModel(e,t)},()=>{t()})}LoadModel(e,t){let i=!1,r=new THREE.LoadingManager(()=>{i=!0}),n=ct(e);r.setURLModifier(o=>{if(o===n)return o;let a=$(o);if(Be(o).length>0){let u=this.callbacks.getFileBuffer(o);if(u!==null){let d=ct(u);return this.objectUrlToFileName.set(d,a),d}}return o});let s=this.CreateLoader(r);if(s===null){t();return}s.load(n,o=>{Kn(()=>i?(this.OnThreeObjectsLoaded(o,t),!1):!0)},()=>{},o=>{this.SetError(o),t()})}OnThreeObjectsLoaded(e,t){function i(o){let a=new U().CreateIdentity();return o.updateMatrix(),o.matrix!==void 0&&o.matrix!==null&&a.Set(o.matrix.elements),new q(a)}function r(o,a,h,u){let d=new Fe;h.name!==void 0&&d.SetName(h.name),d.SetTransformation(i(h)),u.AddChildNode(d);for(let m of h.children)r(o,a,m,d);if(h.isMesh&&o.IsMeshVisible(h)){h.children.length===0&&d.SetType(Te.MeshNode);let m=o.ConvertThreeMesh(h),c=a.AddMesh(m);d.AddMeshIndex(c)}}let n=this.GetMainObject(e),s=this.model.GetRootNode();s.SetTransformation(i(n));for(let o of n.children)r(this,this.model,o,s);t()}ConvertThreeMesh(e){let t=null;if(Array.isArray(e.material)){if(t=Yt(e.geometry,null),e.geometry.attributes.color===void 0||e.geometry.attributes.color===null){let i=[];for(let r=0;r<e.material.length;r++){let n=e.material[r],s=this.FindOrCreateMaterial(n);i.push(s)}for(let r=0;r<e.geometry.groups.length;r++){let n=e.geometry.groups[r],s=null;n.count===1/0?s=t.TriangleCount():s=n.start/3+n.count/3;for(let o=n.start/3;o<s;o++)t.GetTriangle(o).SetMaterial(i[n.materialIndex])}}}else{let i=this.FindOrCreateMaterial(e.material);t=Yt(e.geometry,i)}return e.name!==void 0&&e.name!==null&&t.SetName(e.name),t}FindOrCreateMaterial(e){if(this.materialIdToIndex.has(e.id))return this.materialIdToIndex.get(e.id);let t=this.ConvertThreeMaterial(e),i=this.model.AddMaterial(t);return this.materialIdToIndex.set(e.id,i),i}ConvertThreeMaterial(e){function t(r,n){function s(o){if(o.data!==void 0&&o.data!==null){let a=new ImageData(o.width,o.height),h=o.width*o.height*4;for(let u=0;u<h;u++)a.data[u]=o.data[u];return THREE.ImageUtils.getDataURL(a)}else return THREE.ImageUtils.getDataURL(o)}if(r==null||r.image===void 0||r.image===null)return null;try{let o=s(r.image),a=jt(o),h=new Ye,u=null;return n.has(r.image.src)?u=n.get(r.image.src):r.name!==void 0&&r.name!==null?u=r.name+"."+Pt(a.mimeType):u="Embedded_"+r.id.toString()+"."+Pt(a.mimeType),h.name=u,h.url=o,h.buffer=a.buffer,h.rotation=r.rotation,h.offset.x=r.offset.x,h.offset.y=r.offset.y,h.scale.x=r.repeat.x,h.scale.y=r.repeat.y,h}catch{return null}}let i=new ee;return i.name=e.name,i.color=Ni(e.color),i.opacity=e.opacity,i.transparent=e.transparent,i.alphaTest=e.alphaTest,e.type==="MeshPhongMaterial"&&(i.specular=Ni(e.specular),i.shininess=e.shininess/100),i.diffuseMap=t(e.map,this.objectUrlToFileName),i.normalMap=t(e.normalMap,this.objectUrlToFileName),i.bumpMap=t(e.bumpMap,this.objectUrlToFileName),i}},Ar=class extends Zt{constructor(){super()}CanImportExtension(e){return e==="fbx"}GetUpDirection(){return _.Y}GetExternalLibraries(){return["loaders/fflate.min.js","three_loaders/TGALoader.js","three_loaders/FBXLoader.js"]}CreateLoader(e){return e.addHandler(/\.tga$/i,new THREE.TGALoader(e)),new THREE.FBXLoader(e)}GetMainObject(e){return e}},Gr=class extends Zt{constructor(){super()}CanImportExtension(e){return e==="dae"}GetUpDirection(){return _.Y}GetExternalLibraries(){return["three_loaders/TGALoader.js","three_loaders/ColladaLoader.js"]}CreateLoader(e){return e.addHandler(/\.tga$/i,new THREE.TGALoader(e)),new THREE.ColladaLoader(e)}GetMainObject(e){return e.scene}},_r=class extends Zt{constructor(){super()}CanImportExtension(e){return e==="wrl"}GetUpDirection(){return _.Y}GetExternalLibraries(){return["three_loaders/chevrotain.min.js","three_loaders/VRMLLoader.js"]}CreateLoader(e){return new THREE.VRMLLoader(e)}GetMainObject(e){return e}IsMeshVisible(e){let t=!0;if(Array.isArray(e.material)){for(let i=0;i<e.material.length;i++)if(e.material[i].side===THREE.BackSide){t=!1;break}}else t=e.material.side!==THREE.BackSide;return t}},Rr=class extends Zt{constructor(){super()}CanImportExtension(e){return e==="3mf"}GetUpDirection(){return _.Z}GetExternalLibraries(){return["loaders/fflate.min.js","three_loaders/3MFLoader.js"]}CreateLoader(e){return new THREE.ThreeMFLoader(e)}GetMainObject(e){return e}};var kt=class{constructor(){this.defaultColor=new E(200,200,200)}},De={NoImportableFile:1,FailedToLoadFile:2,ImportFailed:3,UnknownError:4},Qt=class{constructor(e,t){this.code=e,this.message=t}},Ss=class{constructor(){this.model=null,this.mainFile=null,this.upVector=null,this.usedFiles=null,this.missingFiles=null}},Ms=class{constructor(e){this.getBufferCallback=e,this.fileBuffers=new Map,this.textureBuffers=new Map}GetFileBuffer(e){let t=$(e);if(this.fileBuffers.has(t))return this.fileBuffers.get(t);let i=this.getBufferCallback(t);return this.fileBuffers.set(t,i),i}GetTextureBuffer(e){let t=$(e);if(this.textureBuffers.has(t))return this.textureBuffers.get(t);let i=null,r=this.getBufferCallback(t);return r!==null&&(i={url:ct(r),buffer:r}),this.textureBuffers.set(t,i),i}},Fr=class{constructor(){this.importers=[new yr,new Dr,new wr,new Er,new Tr,new Sr,new br,new vr,new Mr,new Ar,new Gr,new _r,new Rr],this.fileList=new _i,this.model=null,this.usedFiles=[],this.missingFiles=[]}AddImporter(e){this.importers.push(e)}ImportFiles(e,t,i,r){this.LoadFiles(e,t,()=>{r.onFilesLoaded(),pt(()=>{this.ImportLoadedFiles(i,r)})})}LoadFiles(e,t,i){let r=new _i;t===Y.Url?r.FillFromFileUrls(e):t===Y.File&&r.FillFromFileObjects(e);let n=!1;if(this.HasImportableFile(r))n=!0;else{let s=!1;for(let o=0;o<this.missingFiles.length;o++){let a=this.missingFiles[o];r.ContainsFileByPath(a)&&(s=!0)}if(!s)n=!0;else{let o=r.GetFiles();this.fileList.ExtendFromFileList(o),n=!1}}n&&(this.fileList=r),this.fileList.GetContent(()=>{this.DecompressArchives(this.fileList,()=>{i()})})}ImportLoadedFiles(e,t){let i=this.GetImportableFiles(this.fileList);if(i.length===0){t.onImportError(new Qt(De.NoImportableFile,null));return}if(i.length===1||!t.onSelectMainFile){let r=i[0];this.ImportLoadedMainFile(r,e,t)}else{let r=i.map(n=>n.file.name);t.onSelectMainFile(r,n=>{if(n===null){t.onImportError(new Qt(De.NoImportableFile,null));return}pt(()=>{let s=i[n];this.ImportLoadedMainFile(s,e,t)})})}}ImportLoadedMainFile(e,t,i){if(e===null||e.file===null||e.file.content===null){i.onImportError(new Qt(De.FailedToLoadFile,null));return}this.RevokeModelUrls(),this.model=null,this.usedFiles=[],this.missingFiles=[],this.usedFiles.push(e.file.name);let r=e.importer,n=new Ms(s=>{let o=null,a=this.fileList.FindFileByPath(s);return a===null||a.content===null?(this.missingFiles.push(s),o=null):(this.usedFiles.push(s),o=a.content),o});r.Import(e.file.name,e.file.extension,e.file.content,{getDefaultMaterialColor:()=>t.defaultColor,getFileBuffer:s=>n.GetFileBuffer(s),getTextureBuffer:s=>n.GetTextureBuffer(s),onSuccess:()=>{this.model=r.GetModel();let s=new Ss;s.mainFile=e.file.name,s.model=this.model,s.usedFiles=this.usedFiles,s.missingFiles=this.missingFiles,s.upVector=r.GetUpDirection(),i.onImportSuccess(s)},onError:()=>{let s=r.GetErrorMessage();i.onImportError(new Qt(De.ImportFailed,s))},onComplete:()=>{r.Clear()}})}DecompressArchives(e,t){let i=e.GetFiles(),r=[];for(let n of i)n.extension==="zip"&&r.push(n);if(r.length===0){t();return}he("loaders/fflate.min.js").then(()=>{for(let n=0;n<r.length;n++){let s=r[n],o=new Uint8Array(s.content),a=fflate.unzipSync(o);for(let h in a)if(Object.prototype.hasOwnProperty.call(a,h)){let u=new Gi(h,Y.Decompressed);u.SetContent(a[h].buffer),e.AddFile(u)}}t()}).catch(()=>{t()})}GetFileList(){return this.fileList}HasImportableFile(e){return this.GetImportableFiles(e).length>0}GetImportableFiles(e){function t(n,s){for(let o=0;o<s.length;o++){let a=s[o];if(a.CanImportExtension(n.extension))return a}return null}let i=[],r=e.GetFiles();for(let n=0;n<r.length;n++){let s=r[n],o=t(s,this.importers);o!==null&&i.push({file:s,importer:o})}return i}RevokeModelUrls(){if(this.model!==null)for(let e=0;e<this.model.MaterialCount();e++)this.model.GetMaterial(e).EnumerateTextureMaps(i=>{i.url!==null&&An(i.url)})}};function bs(l,e){function t(i,r){for(let n of i)n.polygonOffset=r,n.polygonOffsetUnit=1,n.polygonOffsetFactor=1}t(l.material,e),l.userData.threeMaterials&&t(l.userData.threeMaterials,e)}var Pr=class{constructor(e){this.scene=e,this.mainObject=null,this.mainGridObject=null,this.mainEdgeObject=null,this.gridSettings={showGrid:!1},this.edgeSettings={showEdges:!1,edgeColor:new E(0,0,0),edgeThreshold:1}}SetMainObject(e){this.mainObject=e,this.scene.add(this.mainObject),this.gridSettings.showGrid&&this.GenerateMainGridObject(),this.edgeSettings.showEdges&&this.GenerateMainEdgeObject()}UpdateWorldMatrix(){this.mainObject!==null&&this.mainObject.updateWorldMatrix(!0,!0)}SetGridSettings(e){this.gridSettings.showGrid=e,this.mainObject!==null&&(this.gridSettings.showGrid?(this.ClearMainGridObject(),this.GenerateMainGridObject()):this.ClearMainGridObject())}SetEdgeSettings(e,t,i){let r=!1;if(e&&(!this.edgeSettings.showEdges||this.edgeSettings.edgeThreshold!==i)&&(r=!0),this.edgeSettings.showEdges=e,this.edgeSettings.edgeThreshold=i,this.edgeSettings.edgeColor=t,this.mainObject!==null)if(this.edgeSettings.showEdges)if(r)this.ClearMainEdgeObject(),this.GenerateMainEdgeObject();else{let n=ye(this.edgeSettings.edgeColor);this.EnumerateEdges(s=>{s.material.color=n})}else this.ClearMainEdgeObject()}GenerateMainGridObject(){function e(f,p,x){let C=[f,p],I=new THREE.BufferGeometry().setFromPoints(C);return new THREE.Line(I,x)}this.UpdateWorldMatrix();let t=this.GetBoundingBox(f=>!0);if(t===null)return;this.mainGridObject=new THREE.Object3D;let i=new THREE.LineBasicMaterial({color:8947848}),r=new THREE.LineBasicMaterial({color:14540253}),n=new THREE.Vector3;t.getSize(n);let s=1,o=new THREE.Vector2(t.min.z-s,t.min.x-s),a=new THREE.Vector2(t.max.z+s,t.max.x+s),h=1,u=new THREE.Vector2(Math.floor(o.x/h)*h,Math.floor(o.y/h)*h),d=new THREE.Vector2(Math.ceil(a.x/h)*h,Math.ceil(a.y/h)*h),m=t.min.y,c=Math.floor((d.x-u.x)/h),g=Math.floor((d.y-u.y)/h);for(let f=0;f<c+1;f++){let p=u.x+f*h,x=new THREE.Vector3(u.y,m,p),C=new THREE.Vector3(d.y,m,p),I=W(p,0)?i:r;this.mainGridObject.add(e(x,C,I))}for(let f=0;f<g+1;f++){let p=u.y+f*h,x=new THREE.Vector3(p,m,u.x),C=new THREE.Vector3(p,m,d.x),I=W(p,0)?i:r;this.mainGridObject.add(e(x,C,I))}this.scene.add(this.mainGridObject)}GenerateMainEdgeObject(){let e=ye(this.edgeSettings.edgeColor);this.mainEdgeObject=new THREE.Object3D,this.UpdateWorldMatrix(),this.EnumerateMeshes(t=>{bs(t,!0);let i=new THREE.EdgesGeometry(t.geometry,this.edgeSettings.edgeThreshold),r=new THREE.LineSegments(i,new THREE.LineBasicMaterial({color:e}));r.applyMatrix4(t.matrixWorld),r.userData=t.userData,r.visible=t.visible,this.mainEdgeObject.add(r)}),this.scene.add(this.mainEdgeObject)}GetBoundingBox(e){let t=!1,i=new THREE.Box3;return this.EnumerateMeshes(r=>{e(r.userData)&&(i.union(new THREE.Box3().setFromObject(r)),t=!0)}),t?i:null}GetBoundingSphere(e){let t=this.GetBoundingBox(e);if(t===null)return null;let i=new THREE.Sphere;return t.getBoundingSphere(i),i}Clear(){this.ClearMainObject(),this.ClearMainGridObject(),this.ClearMainEdgeObject()}ClearMainObject(){this.mainObject!==null&&(this.EnumerateMeshes(e=>{e.geometry.dispose()}),this.scene.remove(this.mainObject),this.mainObject=null)}ClearMainGridObject(){this.mainGridObject!==null&&(this.mainGridObject.traverse(e=>{e.isLineSegments&&e.geometry.dispose()}),this.scene.remove(this.mainGridObject),this.mainGridObject=null)}ClearMainEdgeObject(){this.mainEdgeObject!==null&&(this.EnumerateMeshes(e=>{bs(e,!1)}),this.EnumerateEdges(e=>{e.geometry.dispose()}),this.scene.remove(this.mainEdgeObject),this.mainEdgeObject=null)}EnumerateMeshes(e){this.mainObject!==null&&this.mainObject.traverse(t=>{t.isMesh&&e(t)})}EnumerateEdges(e){this.mainEdgeObject!==null&&this.mainEdgeObject.traverse(t=>{t.isLineSegments&&e(t)})}GetMeshIntersectionUnderMouse(e,t,i,r){if(this.mainObject===null)return null;let n=new THREE.Raycaster,s=new THREE.Vector2;s.x=e.x/i*2-1,s.y=-(e.y/r)*2+1,n.setFromCamera(s,t);let o=n.intersectObject(this.mainObject,!0);for(let a=0;a<o.length;a++){let h=o[a];if(h.object.type==="Mesh"&&h.object.visible)return h}return null}},Nr=class{constructor(e){this.scene=e,this.mainObject=null}AddObject(e){this.mainObject===null&&(this.mainObject=new THREE.Object3D,this.scene.add(this.mainObject)),this.mainObject.add(e)}Clear(){this.mainObject!==null&&(this.mainObject.traverse(e=>{(e.isMesh||e.isLineSegments)&&e.geometry.dispose()}),this.scene.remove(this.mainObject),this.mainObject=null)}};function ys(l){return l===_.X?new Xe(new M(2,-3,1.5),new M(0,0,0),new M(1,0,0)):l===_.Y?new Xe(new M(-1.5,2,3),new M(0,0,0),new M(0,1,0)):l===_.Z?new Xe(new M(-1.5,-3,2),new M(0,0,0),new M(0,0,1)):null}function ws(l,e){if(!e(l))return!1;for(let t of l.children)if(!ws(t,e))return!1;return!0}function so(l){let e=null;return ws(l,t=>{if(t.isMesh)for(let i of t.material)return i.type==="MeshPhongMaterial"?e=ve.Phong:i.type==="MeshStandardMaterial"&&(e=ve.Physical),!1;return!0}),e}var Es=class{constructor(){this.direction=_.Z,this.isFixed=!0,this.isFlipped=!1}SetDirection(e,t){this.direction=e,this.isFlipped=!1;let i=ys(this.direction),r=ie(i.eye,i.center),n=Re(t.center,t.eye),s=t.center.Clone().Offset(r,n),o=t.Clone();return this.direction===_.X?(o.up=new M(1,0,0),o.eye=s):this.direction===_.Y?(o.up=new M(0,1,0),o.eye=s):this.direction===_.Z&&(o.up=new M(0,0,1),o.eye=s),o}SetFixed(e,t){return this.isFixed=e,this.isFixed?this.SetDirection(this.direction,t):null}Flip(e){this.isFlipped=!this.isFlipped;let t=e.Clone();return t.up.MultiplyScalar(-1),t}},Ds=class{constructor(e){this.scene=e,this.type=ve.Phong,this.ambientLight=new THREE.AmbientLight(8947848),this.directionalLight=new THREE.DirectionalLight(8947848),this.environment=null,this.scene.add(this.ambientLight),this.scene.add(this.directionalLight)}SetType(e){this.type=e,this.type===ve.Phong?(this.ambientLight.color.set(8947848),this.directionalLight.color.set(8947848),this.scene.environment=null):this.type===ve.Physical&&(this.ambientLight.color.set(0),this.directionalLight.color.set(5592405),this.scene.environment=this.environment)}SetEnvironment(e,t){let i=new THREE.CubeTextureLoader;this.environment=i.load(e,()=>{t()})}UpdateByCamera(e){let t=ie(e.eye,e.center);this.directionalLight.position.set(t.x,t.y,t.z)}CreateHighlightMaterial(e,t){let i=null;return this.type===ve.Phong?i=new THREE.MeshPhongMaterial({color:e,side:THREE.DoubleSide}):this.type===ve.Physical&&(i=new THREE.MeshStandardMaterial({color:e,side:THREE.DoubleSide})),i!==null&&t&&(i.polygonOffset=!0,i.polygonOffsetUnit=1,i.polygonOffsetFactor=1),i}},$t=class{constructor(){this.canvas=null,this.renderer=null,this.scene=null,this.geometry=null,this.extraGeometry=null,this.camera=null,this.shading=null,this.navigation=null,this.upVector=null,this.settings={animationSteps:40}}Init(e){this.canvas=e,this.canvas.id="viewer";let t={canvas:this.canvas,antialias:!0};this.renderer=new THREE.WebGLRenderer(t),window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor("#ffffff",1),this.renderer.setSize(this.canvas.width,this.canvas.height),this.scene=new THREE.Scene,this.geometry=new Pr(this.scene),this.extraGeometry=new Nr(this.scene),this.InitNavigation(),this.InitShading(),this.Render()}SetMouseClickHandler(e){this.navigation.SetMouseClickHandler(e)}SetMouseMoveHandler(e){this.navigation.SetMouseMoveHandler(e)}SetContextMenuHandler(e){this.navigation.SetContextMenuHandler(e)}SetBackgroundColor(e){let t="#"+Ge(e);this.renderer.setClearColor(t,1),this.Render()}SetGridSettings(e){this.geometry.SetGridSettings(e),this.Render()}SetEdgeSettings(e,t,i){this.geometry.SetEdgeSettings(e,t,i),this.Render()}SetEnvironmentMap(e){this.shading.SetEnvironment(e,()=>{this.Render()})}GetCanvas(){return this.canvas}GetCamera(){return this.navigation.GetCamera()}SetCamera(e){this.navigation.SetCamera(e),this.Render()}Resize(e,t){let i=Sn(this.canvas,e,t);this.ResizeRenderer(i.width,i.height)}ResizeRenderer(e,t){window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.Render()}FitSphereToWindow(e,t){if(e===null)return;let i=new M(e.center.x,e.center.y,e.center.z),r=e.radius,n=this.camera.fov,s=this.navigation.GetFitToSphereCamera(i,r,n);this.navigation.MoveCamera(s,t?this.settings.animationSteps:0)}AdjustClippingPlanesToSphere(e){e!==null&&(e.radius<10?(this.camera.near=.01,this.camera.far=100):e.radius<100?(this.camera.near=.1,this.camera.far=1e3):e.radius<1e3?(this.camera.near=10,this.camera.far=1e4):(this.camera.near=100,this.camera.far=1e6),this.camera.updateProjectionMatrix(),this.Render())}IsFixUpVector(){return this.navigation.IsFixUpVector()}SetFixUpVector(e){let t=this.navigation.GetCamera(),i=this.upVector.SetFixed(e,t);this.navigation.SetFixUpVector(e),i!==null&&this.navigation.MoveCamera(i,this.settings.animationSteps),this.Render()}SetUpVector(e,t){let i=this.navigation.GetCamera(),r=this.upVector.SetDirection(e,i),n=t?this.settings.animationSteps:0;this.navigation.MoveCamera(r,n),this.Render()}FlipUpVector(){let e=this.navigation.GetCamera(),t=this.upVector.Flip(e);this.navigation.MoveCamera(t,0),this.Render()}Render(){let e=this.navigation.GetCamera();this.camera.position.set(e.eye.x,e.eye.y,e.eye.z),this.camera.up.set(e.up.x,e.up.y,e.up.z),this.camera.lookAt(new THREE.Vector3(e.center.x,e.center.y,e.center.z)),this.shading.UpdateByCamera(e),this.renderer.render(this.scene,this.camera)}SetMainObject(e){let t=so(e);this.geometry.SetMainObject(e),this.shading.SetType(t),this.Render()}AddExtraObject(e){this.extraGeometry.AddObject(e),this.Render()}Clear(){this.geometry.Clear(),this.extraGeometry.Clear(),this.Render()}ClearExtra(){this.extraGeometry.Clear(),this.Render()}SetMeshesVisibility(e){this.geometry.EnumerateMeshes(t=>{let i=e(t.userData);t.visible!==i&&(t.visible=i)}),this.geometry.EnumerateEdges(t=>{let i=e(t.userData);t.visible!==i&&(t.visible=i)}),this.Render()}SetMeshesHighlight(e,t){function i(n,s){let o=[];for(let a=0;a<n.length;a++)o.push(s);return o}let r=this.CreateHighlightMaterial(e);this.geometry.EnumerateMeshes(n=>{t(n.userData)?n.userData.threeMaterials===null&&(n.userData.threeMaterials=n.material,n.material=i(n.material,r)):n.userData.threeMaterials!==null&&(n.material=n.userData.threeMaterials,n.userData.threeMaterials=null)}),this.Render()}CreateHighlightMaterial(e){let t=this.geometry.edgeSettings.showEdges;return this.shading.CreateHighlightMaterial(e,t)}GetMeshUserDataUnderMouse(e){let t=this.GetMeshIntersectionUnderMouse(e);return t===null?null:t.object.userData}GetMeshIntersectionUnderMouse(e){let t=this.GetCanvasSize(),i=this.geometry.GetMeshIntersectionUnderMouse(e,this.camera,t.width,t.height);return i===null?null:i}GetBoundingBox(e){return this.geometry.GetBoundingBox(e)}GetBoundingSphere(e){return this.geometry.GetBoundingSphere(e)}EnumerateMeshesUserData(e){this.geometry.EnumerateMeshes(t=>{e(t.userData)})}InitNavigation(){this.camera=new THREE.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,1e3),this.scene.add(this.camera);let e=this.renderer.domElement,t=ys(_.Z);this.navigation=new ur(e,t,{onUpdate:()=>{this.Render()}}),this.upVector=new Es}InitShading(){this.shading=new Ds(this.scene)}GetImageSize(){let e=new THREE.Vector2;return this.renderer.getSize(e),{width:parseInt(e.x,10),height:parseInt(e.y,10)}}GetCanvasSize(){let e=this.canvas.width,t=this.canvas.height;return window.devicePixelRatio&&(e/=window.devicePixelRatio,t/=window.devicePixelRatio),{width:e,height:t}}GetImageAsDataUrl(e,t){let i=this.GetImageSize(),r=e,n=t;window.devicePixelRatio&&(r/=window.devicePixelRatio,n/=window.devicePixelRatio),this.ResizeRenderer(r,n),this.Render();let s=this.renderer.domElement.toDataURL();return this.ResizeRenderer(i.width,i.height),s}};var ei=class{constructor(){this.skipNextEvent=!1,this.eventListener=null}SetEventListener(e){this.eventListener=e,window.onhashchange=this.OnChange.bind(this)}SkipNextEventHandler(){this.skipNextEvent=!0}HasHash(){return this.GetHash().length>0}ClearHash(){this.SetHash("")}GetModelFilesFromHash(){return Nt(this.GetHash()).GetModelUrls()}SetModelFilesToHash(e){let t=Di(e);this.SetHash(t)}GetCameraFromHash(){return Nt(this.GetHash()).GetCamera()}GetBackgroundFromHash(){return Nt(this.GetHash()).GetBackgroundColor()}GetDefaultColorFromHash(){return Nt(this.GetHash()).GetDefaultColor()}GetEdgeSettingsFromHash(){return Nt(this.GetHash()).GetEdgeSettings()}GetHash(){return window.location.hash.substring(1)}SetHash(e){window.location.hash=e}OnChange(){if(this.skipNextEvent){this.skipNextEvent=!1;return}this.eventListener()}};var Vr=class{constructor(){this.forceMediumpForMaterials=!1}},Lr=class{constructor(){this.defaultMaterial=null}},As=class{constructor(e){this.callbacks=e,this.texturesNeeded=0,this.texturesLoaded=0,this.threeObject=null}OnTextureNeeded(){this.texturesNeeded+=1}OnTextureLoaded(){this.texturesLoaded+=1,this.callbacks.onTextureLoaded(),this.Finish()}OnModelLoaded(e){this.threeObject=e,this.Finish()}Finish(){this.threeObject!==null&&this.texturesNeeded===this.texturesLoaded&&this.callbacks.onModelLoaded(this.threeObject)}},Gs=class{constructor(e,t){this.meshInstances=[],this.AddNode(e,t)}AddNode(e,t){let i=e.GetTransformation().GetMatrix(),r=new THREE.Matrix4().fromArray(i.Get());t.applyMatrix4(r);for(let n of e.GetChildNodes()){let s=new THREE.Object3D;t.add(s),this.AddNode(n,s)}for(let n of e.GetMeshIndices())this.meshInstances.push({node:e,threeNode:t,meshIndex:n})}GetMeshInstances(){return this.meshInstances}};function _s(l,e,t,i){function r(m,c,g,f,p,x){function C(y,G){G.wrapS=THREE.RepeatWrapping,G.wrapT=THREE.RepeatWrapping,G.rotation=y.rotation,G.offset.x=y.offset.x,G.offset.y=y.offset.y,G.repeat.x=y.scale.x,G.repeat.y=y.scale.y}function I(y,G,k,N){if(k===null||!k.IsValid())return;let L=new THREE.TextureLoader;y.OnTextureNeeded(),L.load(k.url,B=>{C(k,B),G.needsUpdate=!0,N(B),y.OnTextureLoaded()},null,B=>{y.OnTextureLoaded()})}let T=c.GetMaterial(g),S=ye(T.color);T.vertexColors&&S.setRGB(1,1,1);let w={color:S,vertexColors:T.vertexColors,opacity:T.opacity,transparent:T.transparent,alphaTest:T.alphaTest,side:THREE.DoubleSide};p.forceMediumpForMaterials&&(w.precision="mediump");let b=null;if(f===ve.Phong){if(b=new THREE.MeshPhongMaterial(w),T.type===X.Phong){let y=ye(T.specular);W(T.shininess,0)&&y.setRGB(0,0,0),b.specular=y,b.shininess=T.shininess*100,I(m,b,T.specularMap,G=>{b.specularMap=G})}}else f===ve.Physical&&(b=new THREE.MeshStandardMaterial(w),T.type===X.Physical&&(b.metalness=T.metalness,b.roughness=T.roughness,I(m,b,T.metalnessMap,y=>{b.metalness=1,b.roughness=1,b.metalnessMap=y,b.roughnessMap=y})));let D=ye(T.emissive);return b.emissive=D,I(m,b,T.diffuseMap,y=>{T.multiplyDiffuseMap||b.color.setRGB(1,1,1),b.map=y}),I(m,b,T.bumpMap,y=>{b.bumpMap=y}),I(m,b,T.normalMap,y=>{b.normalMap=y}),I(m,b,T.emissiveMap,y=>{b.emissiveMap=y}),T.isDefault&&(x.defaultMaterial=b),b}function n(m,c,g){let f=m.GetMesh(c.meshIndex),p=f.TriangleCount(),x=[];for(let B=0;B<p;B++)x.push(B);x.sort((B,ne)=>{let H=f.GetTriangle(B),pe=f.GetTriangle(ne);return H.mat-pe.mat});let C=new THREE.BufferGeometry,I=[],T=[],S=new Map,w=[],b=[],D=[],y=[],G=[];G.push({start:0,end:-1});let k=f.VertexColorCount()>0,N=f.TextureUVCount()>0;for(let B=0;B<x.length;B++){let ne=x[B],H=f.GetTriangle(ne),pe=f.GetVertex(H.v0),Le=f.GetVertex(H.v1),di=f.GetVertex(H.v2);if(w.push(pe.x,pe.y,pe.z,Le.x,Le.y,Le.z,di.x,di.y,di.z),H.HasVertexColors()){let z=ye(f.GetVertexColor(H.c0)),Dt=ye(f.GetVertexColor(H.c1)),At=ye(f.GetVertexColor(H.c2));b.push(z.r,z.g,z.b,Dt.r,Dt.g,Dt.b,At.r,At.g,At.b)}else k&&b.push(0,0,0,0,0,0,0,0,0);let wt=f.GetNormal(H.n0),Et=f.GetNormal(H.n1),ht=f.GetNormal(H.n2);if(D.push(wt.x,wt.y,wt.z,Et.x,Et.y,Et.z,ht.x,ht.y,ht.z),H.HasTextureUVs()){let z=f.GetTextureUV(H.u0),Dt=f.GetTextureUV(H.u1),At=f.GetTextureUV(H.u2);y.push(z.x,z.y,Dt.x,Dt.y,At.x,At.y)}else N&&y.push(0,0,0,0,0,0);let te=H.mat;S.has(te)||(S.set(te,I.length),I.push(g[te]),T.push(te),B>0&&(G[G.length-1].end=B-1,G.push({start:G[G.length-1].end+1,end:-1})))}G[G.length-1].end=p-1,C.setAttribute("position",new THREE.Float32BufferAttribute(w,3)),b.length!==0&&C.setAttribute("color",new THREE.Float32BufferAttribute(b,3)),C.setAttribute("normal",new THREE.Float32BufferAttribute(D,3)),y.length!==0&&C.setAttribute("uv",new THREE.Float32BufferAttribute(y,2));for(let B=0;B<G.length;B++){let ne=G[B];C.addGroup(ne.start*3,(ne.end-ne.start+1)*3,B)}let L=new THREE.Mesh(C,I);return L.userData={originalMeshId:c,originalMaterials:T,threeMaterials:null},L}function s(m,c,g,f){let p=c.GetMesh(g.meshIndex);if(Bt(p)===tt.TriangleMesh){let C=n(c,g,f);m.add(C)}}function o(m,c,g,f){let p=c.GetRootNode(),C=new Gs(p,m).GetMeshInstances();Yn(C.length,100,{runTask:(I,T,S)=>{for(let w=I;w<=T;w++){let b=C[w],D=b.node,y=b.threeNode,G=new rt(D.GetId(),b.meshIndex);s(y,c,G,g)}S()},onReady:()=>{f.OnModelLoaded(m)}})}let a=new As(i),h=ls(l),u=[];for(let m=0;m<l.MaterialCount();m++){let c=r(a,l,m,h,e,t);u.push(c)}let d=new THREE.Object3D;o(d,l,u,a)}var Br=class{constructor(){this.importer=new Fr,this.inProgress=!1,this.defaultMaterial=null,this.hasHighpDriverIssue=os()}InProgress(){return this.inProgress}LoadModel(e,t,i,r){this.inProgress||(this.inProgress=!0,r.onLoadStart(),this.importer.ImportFiles(e,t,i,{onFilesLoaded:()=>{r.onImportStart()},onSelectMainFile:(n,s)=>{r.onSelectMainFile?r.onSelectMainFile(n,s):s(0)},onImportSuccess:n=>{r.onVisualizationStart();let s=new Vr;s.forceMediumpForMaterials=this.hasHighpDriverIssue;let o=new Lr;_s(n.model,s,o,{onTextureLoaded:()=>{r.onTextureLoaded()},onModelLoaded:a=>{this.defaultMaterial=o.defaultMaterial,r.onModelFinished(n,a),this.inProgress=!1}})},onImportError:n=>{r.onLoadError(n),this.inProgress=!1}}))}GetImporter(){return this.importer}GetDefaultMaterial(){return this.defaultMaterial}ReplaceDefaultMaterialColor(e){this.defaultMaterial!==null&&!this.defaultMaterial.vertexColors&&(this.defaultMaterial.color=ye(e))}};var Rs=class{constructor(){this.modalDiv=me("ov_modal"),this.overlayDiv=null,this.resizeHandler=null,this.positionCalculator=null,this.closeHandler=null,this.isOpen=!1,this.closeable=!0}GetContentDiv(){return this.modalDiv}SetCloseable(e){this.closeable=e}SetPositionCalculator(e){this.positionCalculator=e}SetCloseHandler(e){this.closeHandler=e}Open(){this.overlayDiv=v(document.body,"ov_modal_overlay"),document.body.appendChild(this.modalDiv),this.resizeHandler=this.Resize.bind(this),window.addEventListener("resize",this.resizeHandler),this.closeable&&(this.overlayDiv.addEventListener("click",e=>{e.preventDefault(),this.Close()}),this.overlayDiv.addEventListener("contextmenu",e=>{e.preventDefault(),this.Close()})),this.isOpen=!0,this.Resize()}Close(){!this.isOpen||(window.removeEventListener("resize",this.resizeHandler),this.closeHandler!==null&&this.closeHandler(),this.modalDiv.remove(),this.overlayDiv.remove(),this.overlayDiv=null,this.resizeHandler=null,this.isOpen=!1)}IsOpen(){return this.isOpen}Resize(){let e=window.innerWidth,t=window.innerHeight,i=(e-this.modalDiv.offsetWidth)/2,r=(t-this.modalDiv.offsetHeight)/3;if(this.positionCalculator!==null){let n=this.positionCalculator();i=n.x,r=n.y}this.modalDiv.style.left=i+"px",this.modalDiv.style.top=r+"px"}},ki=class{constructor(){this.modal=new Rs}GetContentDiv(){return this.modal.GetContentDiv()}SetCloseable(e){this.modal.SetCloseable(e)}SetCloseHandler(e){this.modal.SetCloseHandler(e)}SetPositionCalculator(e){this.modal.SetPositionCalculator(e)}Show(){this.modal.Open()}Hide(){this.modal.Close()}},ti=class extends ki{constructor(){super();this.modal.SetCloseable(!1),this.textDiv=null}Init(e){let t=this.modal.GetContentDiv();t.classList.add("ov_progress"),v(t,"ov_progress_img",'<svg><use href="assets/images/3dviewer_net_logo.svg#logo"></use></svg>'),this.textDiv=v(t,"ov_progress_text"),this.SetText(e)}SetText(e){this.textDiv.innerHTML=e}},Ne=class extends ki{constructor(){super()}Init(e,t){function i(a,h){let u=v(h,"ov_button ov_dialog_button",a.name);a.subClass&&u.classList.add(a.subClass),u.addEventListener("click",()=>{a.onClick()})}let r=this.modal.GetContentDiv();r.classList.add("ov_dialog"),v(r,"ov_dialog_title",e);let n=v(r,"ov_dialog_content"),s=v(r,"ov_dialog_buttons"),o=v(s,"ov_dialog_buttons_inner");for(let a=0;a<t.length;a++)i(t[a],o);return n}},Fs=class extends ki{constructor(){super()}Init(e){let t=this.modal.GetContentDiv();return t.classList.add("ov_popup"),this.modal.SetPositionCalculator(e),t}},Or=class extends Fs{constructor(){super();this.listDiv=null}Init(e){let t=super.Init(e);return this.listDiv=v(t,"ov_popup_list ov_thin_scrollbar"),t}AddListItem(e,t){let i=v(this.listDiv,"ov_popup_list_item");if(e.icon&&fe(i,e.icon,"left_inline"),e.color){let r=v(i,"ov_popup_list_item_icon"),n=Si(e.color);r.appendChild(n)}v(i,"ov_popup_list_item_name",e.name),i.addEventListener("click",t.onClick),or()&&t.onHoverStart&&t.onHoverStop&&(i.addEventListener("mouseover",()=>{t.onHoverStart()}),i.addEventListener("mouseout",()=>{t.onHoverStop()}))}};function Je(l,e,t){let i=new Ne,r=i.Init(l,[{name:"OK",onClick(){i.Hide()}}]);return v(r,"ov_dialog_message",e),t!==null&&v(r,"ov_dialog_submessage",t),i.Show(),i}function Ht(l,e){if(l.length===0)return null;let t=new Or;t.Init(()=>e.calculatePosition(t.GetContentDiv()));for(let i=0;i<l.length;i++){let r=l[i];t.AddListItem(r,{onHoverStart:function(){e.onHoverStart&&e.onHoverStart(i)},onHoverStop:function(){e.onHoverStop&&e.onHoverStop(i)},onClick:function(){t.Hide(),e.onClick(i)}})}return t.Show(),t}function Hi(l,e){let t=l.getBoundingClientRect();return{x:t.left+l.offsetWidth,y:t.top+l.offsetHeight-e.offsetHeight}}function Ps(l,e){let t=window.innerWidth,i=window.innerHeight,r=l.x,n=l.y,s=r+e.offsetWidth,o=n+e.offsetHeight;return s>t&&(r=r-(s-t)),o>i&&(n=n-(o-i)),{x:r,y:n}}var ii=class{constructor(){this.modelLoader=new Br,this.modalDialog=null}LoadModel(e,t,i,r){if(this.modelLoader.InProgress())return;let n=null;this.modelLoader.LoadModel(e,t,i,{onLoadStart:()=>{this.CloseDialogIfOpen(),r.onStart(),n=new ti,n.Init("Loading Model"),n.Show()},onSelectMainFile:(s,o)=>{n.Hide(),this.modalDialog=this.ShowFileSelectorDialog(s,a=>{n.Show(),o(a)})},onImportStart:()=>{n.SetText("Importing Model")},onVisualizationStart:()=>{n.SetText("Visualizing Model")},onModelFinished:(s,o)=>{n.Hide(),r.onFinish(s,o)},onTextureLoaded:()=>{r.onRender()},onLoadError:s=>{n.Hide(),r.onError(s),this.modalDialog=this.ShowErrorDialog(s)}})}GetModelLoader(){return this.modelLoader}GetImporter(){return this.modelLoader.GetImporter()}ShowErrorDialog(e){return e.code===De.NoImportableFile?Je("Something went wrong","No importable file found.",e.message):e.code===De.FailedToLoadFile?Je("Something went wrong","Failed to load file for import.",e.message):e.code===De.ImportFailed?Je("Something went wrong","Failed to import model.",e.message):Je("Something went wrong","Unknown error.",e.message)}ShowFileSelectorDialog(e,t){let i=new Ne,r=i.Init("Select Model",[{name:"Cancel",subClass:"outline",onClick(){i.Hide()}}]);i.SetCloseHandler(()=>{t(null)}),v(r,"ov_dialog_message","Multiple importable models found. Select the model you would like to import from the list below.");let s=v(r,"ov_dialog_section"),o=v(s,"ov_dialog_import_file_list ov_thin_scrollbar");for(let a=0;a<e.length;a++){let h=e[a],u=v(o,"ov_dialog_file_link");fe(u,"meshes","ov_file_link_img"),v(u,"ov_dialog_file_link_text",h),u.addEventListener("click",()=>{i.SetCloseHandler(null),i.Hide(),t(a)})}return i.Show(),i}CloseDialogIfOpen(){this.modalDialog!==null&&(this.modalDialog.Hide(),this.modalDialog=null)}};var Ur=class{constructor(e){this.parameters=e,this.viewer=new $t,this.hashHandler=new ei,this.modelLoaderUI=new ii}Load(){let e=Q(this.parameters.viewerDiv,"canvas");if(this.InitViewer(e),this.Resize(),this.hashHandler.HasHash()){let t=this.hashHandler.GetModelFilesFromHash();if(t===null)return;Ai(t);let i=this.hashHandler.GetBackgroundFromHash();i!==null&&this.viewer.SetBackgroundColor(i);let r=this.hashHandler.GetEdgeSettingsFromHash();r!==null&&this.viewer.SetEdgeSettings(r.showEdges,r.edgeColor,r.edgeThreshold);let n=new kt,s=this.hashHandler.GetDefaultColorFromHash();s!==null&&(n.defaultColor=s),this.modelLoaderUI.LoadModel(t,Y.Url,n,{onStart:()=>{},onFinish:(h,u)=>{this.OnModelFinished(h,u)},onRender:()=>{this.viewer.Render()},onError:h=>{}});let o=Di(t),a=this.parameters.websiteLinkDiv.getAttribute("href")+"#"+o;this.parameters.websiteLinkDiv.setAttribute("href",a)}window.addEventListener("resize",()=>{this.Resize()})}Resize(){let e=window.innerWidth,t=window.innerHeight;this.viewer.Resize(e,t)}OnModelFinished(e,t){this.viewer.SetMainObject(t);let i=this.viewer.GetBoundingSphere(n=>!0);this.viewer.AdjustClippingPlanesToSphere(i);let r=this.hashHandler.GetCameraFromHash();r!==null?this.viewer.SetCamera(r):this.viewer.SetUpVector(e.upVector,!1),this.viewer.FitSphereToWindow(i,!1)}InitViewer(e){this.viewer.Init(e),this.viewer.SetEnvironmentMap(["assets/envmaps/grayclouds/posx.jpg","assets/envmaps/grayclouds/negx.jpg","assets/envmaps/grayclouds/posy.jpg","assets/envmaps/grayclouds/negy.jpg","assets/envmaps/grayclouds/posz.jpg","assets/envmaps/grayclouds/negz.jpg"])}};var kr=class{constructor(){this.viewer=null,this.highlightColor=null,this.isActive=!1,this.markers=[]}Init(e,t){this.viewer=e,this.highlightColor=t}IsActive(){return this.isActive}SetActive(e){this.isActive=e,this.isActive||this.Clear()}Click(e){let t=this.viewer.GetMeshIntersectionUnderMouse(e);if(t===null){this.Clear();return}this.markers.length===2&&this.Clear(),this.AddMarker(t)}GetMarkerCount(){return this.markers.length}AddMarker(e){this.markers.push(e),this.GenerateMarker(e)}Calculate(){if(this.markers.length!==2)return null;let e=this.markers[0],t=this.markers[1],i={pointsDistance:null,parallelFacesDistance:null,facesAngle:null},r=this.GetFaceWorldNormal(e),n=this.GetFaceWorldNormal(t);if(i.pointsDistance=e.point.distanceTo(t.point),i.facesAngle=r.angleTo(n),$i(i.facesAngle,0,Qi)||$i(i.facesAngle,Math.PI,Qi)){let s=new THREE.Plane().setFromNormalAndCoplanarPoint(r,e.point);i.parallelFacesDistance=Math.abs(s.distanceToPoint(t.point))}return i}Clear(){this.viewer.ClearExtra(),this.markers=[]}GenerateMarker(e){let i=this.viewer.GetBoundingSphere(h=>!0).radius/5,r=i/2,n=new THREE.ConeGeometry(r,i,32);n.translate(0,-i/2,0),n.rotateX(-Math.PI/2);let s=this.viewer.CreateHighlightMaterial(this.highlightColor);s.opacity=.6,s.transparent=!0;let o=new THREE.Mesh(n,s),a=this.GetFaceWorldNormal(e);o.lookAt(a),o.position.set(e.point.x,e.point.y,e.point.z),this.viewer.AddExtraObject(o)}GetFaceWorldNormal(e){let t=new THREE.Matrix4;e.object.updateWorldMatrix(!0,!1),t.extractRotation(e.object.matrixWorld);let i=e.face.normal.clone();return i.applyMatrix4(t),i}};var ri=class{constructor(e){this.parentDiv=e,this.panelDiv=v(e),V(this.panelDiv,!1),this.visible=!1}GetIcon(){return null}IsVisible(){return this.visible}Show(e){this.visible!==e&&(this.visible=e,V(this.panelDiv,this.visible))}Resize(){}Clear(){}},ni=class{constructor(e){this.parentDiv=e,this.menuDiv=v(e,"ov_panel_set_menu"),this.contentDiv=v(e,"ov_panel_set_content ov_thin_scrollbar"),this.panels=[],this.panelButtons=[],this.panelsVisible=!0,this.panelsPrevWidth=null,this.callbacks=null}Init(e){this.callbacks=e}GetContentDiv(){return this.contentDiv}AddPanel(e){this.panels.push(e);let t=fe(this.menuDiv,e.GetIcon(),"ov_panel_set_menu_button");t.setAttribute("alt",e.GetName()),t.setAttribute("title",e.GetName()),this.panelButtons.push(t),t.addEventListener("click",()=>{e===this.GetVisiblePanel()?this.ShowPanels(!1):(this.ShowPanels(!0),this.ShowPanel(e))})}IsPanelsVisible(){return this.panelsVisible}ShowPanels(e){if(!!this.IsParentVisible()&&this.panelsVisible!==e){if(this.panelsVisible=e,this.panelsVisible)V(this.contentDiv,!0),Rt(this.parentDiv,this.menuDiv.offsetWidth+this.panelsPrevWidth);else{for(let t of this.panelButtons)t.classList.remove("selected");for(let t of this.panels)t.Show(!1);this.panelsPrevWidth=this.contentDiv.offsetWidth,Rt(this.parentDiv,this.menuDiv.offsetWidth),V(this.contentDiv,!1)}this.callbacks.onShowHidePanels(this.panelsVisible),this.callbacks.onResize()}}ShowPanel(e){if(e===this.GetVisiblePanel())return;let t=this.GetPanelButton(e);for(let i of this.panelButtons)i!==t&&i.classList.remove("selected");t.classList.add("selected");for(let i of this.panels)i!==e&&i.Show(!1);e.Show(!0),e.Resize()}GetVisiblePanel(){if(!this.panelsVisible)return null;for(let e of this.panels)if(e.IsVisible())return e;return null}SetPanelIcon(e,t){let i=this.GetPanelButton(e);We(i,t)}GetPanelButton(e){let t=this.panels.indexOf(e);return this.panelButtons[t]}Resize(){let e=this.parentDiv.offsetHeight;if(de(this.menuDiv,e),de(this.contentDiv,e),this.panelsVisible)for(let t of this.panels)t.IsVisible()&&t.Resize()}IsParentVisible(){return bn(this.parentDiv)}Clear(){for(let e of this.panels)e.Clear()}};function Ns(l){l.scrollIntoView({behavior:"smooth",block:"nearest"})}var lt=class{constructor(e){this.imagePath=e,this.mainElement=qt(this.imagePath,"ov_tree_item_button"),this.mainElement.setAttribute("src",this.imagePath)}SetImage(e){this.imagePath=e,We(this.mainElement,this.imagePath)}OnClick(e){this.mainElement.addEventListener("click",t=>{t.stopPropagation(),e(t)})}GetDomElement(){return this.mainElement}},Hr=class{constructor(e,t){if(this.name=e,this.parent=null,this.mainElement=me("ov_tree_item"),this.mainElement.setAttribute("title",this.name),this.nameElement=v(this.mainElement,"ov_tree_item_name",this.name),Ot(t)){let i=qt(t,"ov_tree_item_icon");mt(i,this.nameElement)}}OnClick(e){this.mainElement.classList.add("clickable"),this.mainElement.style.cursor="pointer",this.mainElement.addEventListener("click",e)}SetParent(e){this.parent=e}AddDomElements(e){e.appendChild(this.mainElement)}},vt=class extends Hr{constructor(e,t){super(e,t);this.selected=!1}SetSelected(e){if(this.selected=e,this.selected){this.mainElement.classList.add("selected");let t=this.parent;if(t===null)Ns(this.mainElement);else for(;t!==null;)t.ShowChildren(!0),Ns(this.mainElement),t=t.parent}else this.mainElement.classList.remove("selected")}},si=class extends vt{constructor(e,t){super(e,t);this.buttonsDiv=me("ov_tree_item_button_container"),mt(this.buttonsDiv,this.nameElement)}AppendButton(e){this.buttonsDiv.appendChild(e.GetDomElement())}},Tt=class extends Hr{constructor(e,t){super(e,t);this.children=[],this.isVisible=!0,this.isChildrenVisible=!1,this.childrenDiv=null,this.openButtonIcon="arrow_down",this.closeButtonIcon="arrow_right",this.openCloseButton=qt(this.openButtonIcon,"ov_tree_item_icon"),mt(this.openCloseButton,this.nameElement)}AddChild(e){this.CreateChildrenDiv(),this.children.push(e),e.SetParent(this),e.AddDomElements(this.childrenDiv)}ExpandAll(e){for(let t of this.children)t instanceof Tt&&(t.ShowChildren(e),t.ExpandAll(e))}Show(e){this.isVisible=e,this.childrenDiv!==null&&(this.isVisible?(V(this.mainElement,!0),this.childrenDiv.classList.add("ov_tree_view_children")):(V(this.mainElement,!1),this.childrenDiv.classList.remove("ov_tree_view_children")))}ShowChildren(e){this.isChildrenVisible=e,this.childrenDiv!==null&&(e?(We(this.openCloseButton,this.openButtonIcon),V(this.childrenDiv,!0)):(We(this.openCloseButton,this.closeButtonIcon),V(this.childrenDiv,!1)))}CreateChildrenDiv(){return this.childrenDiv===null&&(this.childrenDiv=me("ov_tree_view_children"),Mn(this.childrenDiv,this.mainElement),this.Show(this.isVisible),this.ShowChildren(this.isChildrenVisible),this.OnClick(e=>{this.isChildrenVisible=!this.isChildrenVisible,this.ShowChildren(this.isChildrenVisible)})),this.childrenDiv}},zr=class extends Tt{constructor(e,t){super(e,t);this.buttonsDiv=me("ov_tree_item_button_container"),mt(this.buttonsDiv,this.nameElement)}AppendButton(e){this.buttonsDiv.appendChild(e.GetDomElement())}},Wr=class{constructor(e){this.mainDiv=v(e,"ov_tree_view"),this.children=[]}AddClass(e){this.mainDiv.classList.add(e)}AddChild(e){e.AddDomElements(this.mainDiv),this.children.push(e)}Clear(){ue(this.mainDiv),this.children=[]}};var oi=class{constructor(e){this.parentDiv=e,this.callbacks=null,this.popup=null,this.button=v(this.parentDiv,"ov_navigator_info_button"),this.buttonText=v(this.button,"ov_navigator_info_button_text"),fe(this.button,"arrow_right","ov_navigator_info_button_icon"),this.button.addEventListener("click",()=>{this.OnButtonClick()})}Init(e){this.callbacks=e}OnButtonClick(){}Clear(){this.popup!==null&&(this.popup.Hide(),this.popup=null)}},It=class extends ri{constructor(e){super(e);this.callbacks=null,this.titleDiv=v(this.panelDiv,"ov_navigator_tree_title"),this.treeDiv=v(this.panelDiv,"ov_navigator_tree_panel ov_thin_scrollbar"),this.treeView=new Wr(this.treeDiv);let t=this.GetName();this.titleDiv.innerHTML=t,this.titleDiv.setAttribute("title",t)}Clear(){this.treeView.Clear()}GetName(){return null}Init(e){this.callbacks=e}Fill(e){}};var jr=class extends It{constructor(e){super(e)}GetName(){return"Files"}GetIcon(){return"files"}Resize(){let e=Ae(this.titleDiv),t=this.parentDiv.offsetHeight;de(this.treeDiv,t-e)}Clear(){super.Clear()}Fill(e){super.Fill(e);let t=e.usedFiles,i=e.missingFiles;if(i.length>0){let r=new Tt("Missing Files",null);r.ShowChildren(!0),this.treeView.AddChild(r);for(let s=0;s<i.length;s++){let o=i[s],a=new si(o),h=new lt("open");h.OnClick(()=>{this.callbacks.onFileBrowseButtonClicked()}),a.AppendButton(h),r.AddChild(a)}let n=new Tt("Available Files",null);n.ShowChildren(!0),this.treeView.AddChild(n);for(let s=0;s<t.length;s++){let o=t[s],a=new vt(o);n.AddChild(a)}}else for(let r=0;r<t.length;r++){let n=t[r],s=new vt(n);this.treeView.AddChild(s)}}};var ce={No:0,Parents:1,Children:2,All:3},qr=class extends vt{constructor(e,t,i){super(e);this.OnClick(()=>{i.onSelected(t)})}},zt=class extends si{constructor(e,t,i,r){super(e,t);this.meshInstanceId=i,this.visible=!0,this.fitToWindowButton=new lt("fit"),this.fitToWindowButton.OnClick(()=>{r.onFitToWindow(this.meshInstanceId)}),this.AppendButton(this.fitToWindowButton),this.showHideButton=new lt("visible"),this.showHideButton.OnClick(()=>{r.onShowHide(this.meshInstanceId)}),this.AppendButton(this.showHideButton),this.OnClick(()=>{r.onSelected(this.meshInstanceId)})}GetMeshInstanceId(){return this.meshInstanceId}IsVisible(){return this.visible}SetVisible(e,t){if(this.visible!==e&&(this.visible=e,this.visible?this.showHideButton.SetImage("visible"):this.showHideButton.SetImage("hidden"),t===ce.Parents&&this.parent instanceof ke)){let i=this.parent.CalculateIsVisible();this.parent.SetVisible(i,ce.Parents)}}},ke=class extends zr{constructor(e,t,i){super(e,null);this.nodeId=t,this.callbacks=i,this.visible=!0,this.fitToWindowButton=new lt("fit"),this.fitToWindowButton.OnClick(()=>{this.callbacks.onFitToWindow(t)}),this.AppendButton(this.fitToWindowButton),this.showHideButton=new lt("visible"),this.showHideButton.OnClick(()=>{this.callbacks.onShowHide(t)}),this.AppendButton(this.showHideButton)}GetNodeId(){return this.nodeId}IsVisible(){return this.visible}CalculateIsVisible(){let e=!1;for(let t of this.children)if((t instanceof ke||t instanceof zt)&&t.IsVisible()){e=!0;break}return e}SetVisible(e,t){if(this.visible!==e){if(this.visible=e,this.visible?this.showHideButton.SetImage("visible"):this.showHideButton.SetImage("hidden"),Ot(this.callbacks.onVisibilityChanged)&&this.callbacks.onVisibilityChanged(this.visible),t===ce.Children||t===ce.All)for(let i of this.children)(i instanceof ke||i instanceof zt)&&i.SetVisible(this.visible,ce.Children);if((t===ce.Parents||t===ce.All)&&this.parent instanceof ke){let i=this.parent.CalculateIsVisible();this.parent.SetVisible(i,ce.Parents)}}}EnumerateMeshItems(e){for(let t of this.children)t instanceof ke?t.EnumerateMeshItems(e):t instanceof zt&&e(t)}};var Vs=class extends oi{constructor(e){super(e);this.meshInfoArray=null}Update(e){if(this.meshInfoArray=e,this.meshInfoArray===null)return;let t="Meshes ("+this.meshInfoArray.length+")";this.buttonText.innerHTML=t}OnButtonClick(){if(this.meshInfoArray===null)return;let e=[];for(let t=0;t<this.meshInfoArray.length;t++){let i=this.meshInfoArray[t];e.push({name:vi(i.name)})}e.length!==0&&(this.popup=Ht(e,{calculatePosition:t=>Hi(this.button,t),onHoverStart:t=>{let i=this.meshInfoArray[t];this.callbacks.onMeshHover(i.meshId)},onHoverStop:t=>{this.callbacks.onMeshHover(null)},onClick:t=>{let i=this.meshInfoArray[t];this.callbacks.onMeshSelected(i.meshId)}}))}},Xr=class extends It{constructor(e){super(e);this.callbacks=null,this.materialIndexToItem=new Map,this.popupDiv=v(this.panelDiv,"ov_navigator_info_panel"),this.meshesButton=new Vs(this.popupDiv)}GetName(){return"Materials"}GetIcon(){return"materials"}Resize(){let e=Ae(this.titleDiv),t=Ae(this.popupDiv),i=this.parentDiv.offsetHeight;de(this.treeDiv,i-e-t)}Clear(){super.Clear(),this.meshesButton.Clear(),this.materialIndexToItem=new Map}Init(e){super.Init(e),this.meshesButton.Init({onMeshHover:t=>{this.callbacks.onMeshTemporarySelected(t)},onMeshSelected:t=>{this.callbacks.onMeshSelected(t)}})}Fill(e){super.Fill(e);let t=e.model;for(let i=0;i<t.MaterialCount();i++){let r=t.GetMaterial(i),n=Ti(r.name),s=new qr(n,i,{onSelected:o=>{this.callbacks.onMaterialSelected(o)}});this.materialIndexToItem.set(i,s),this.treeView.AddChild(s)}}GetMaterialItem(e){return this.materialIndexToItem.get(e)}SelectMaterialItem(e,t){this.GetMaterialItem(e).SetSelected(t)}UpdateMeshList(e){this.meshesButton.Update(e)}};var Ls=class extends oi{constructor(e){super(e);this.materialInfoArray=null}Update(e){if(this.materialInfoArray=e,this.materialInfoArray===null)return;let t="Materials ("+this.materialInfoArray.length+")";this.buttonText.innerHTML=t}OnButtonClick(){if(this.materialInfoArray===null)return;let e=[];for(let t=0;t<this.materialInfoArray.length;t++){let i=this.materialInfoArray[t];e.push({name:Ti(i.name),color:i.color})}e.length!==0&&(this.popup=Ht(e,{calculatePosition:t=>Hi(this.button,t),onClick:t=>{let i=this.materialInfoArray[t];this.callbacks.onMaterialSelected(i.index)}}))}},Yr=class extends It{constructor(e){super(e);this.callbacks=null,this.nodeIdToItem=new Map,this.meshInstanceIdToItem=new Map,this.rootItem=null,this.showTree=!1,this.buttons=null,this.titleDiv.classList.add("nomargin"),this.treeView.AddClass("tight"),this.buttonsDiv=me("ov_navigator_buttons"),mt(this.buttonsDiv,this.treeDiv),this.popupDiv=v(this.panelDiv,"ov_navigator_info_panel"),this.materialsButton=new Ls(this.popupDiv)}GetName(){return"Meshes"}GetIcon(){return"meshes"}Resize(){let e=this.titleDiv.offsetHeight,t=Ae(this.buttonsDiv),i=Ae(this.popupDiv),r=this.parentDiv.offsetHeight;de(this.treeDiv,r-e-t-i)}Clear(){this.ClearMeshTree(),ue(this.buttonsDiv),this.buttons=null}ClearMeshTree(){super.Clear(),this.materialsButton.Clear(),this.nodeIdToItem=new Map,this.meshInstanceIdToItem=new Map,this.rootItem=null}Init(e){super.Init(e),this.materialsButton.Init({onMeshHover:t=>{this.callbacks.onMeshTemporarySelected(t)},onMeshSelected:t=>{this.callbacks.onMeshSelected(t)},onMaterialSelected:t=>{this.callbacks.onMaterialSelected(t)}})}Fill(e){super.Fill(e);let t=e.model;this.FillButtons(e),this.FillMeshTree(t),this.Resize()}FillButtons(e){function t(o,a,h,u){a.div=v(o,"ov_navigator_button"),a.div.setAttribute("alt",a.name),a.div.setAttribute("title",a.name),h&&a.div.classList.add(h),a.iconDiv=fe(a.div,a.icon),a.div.addEventListener("click",()=>{u()})}function i(o,a,h){a?(o.flatList.iconDiv.classList.remove("selected"),o.treeView.iconDiv.classList.add("selected")):(o.flatList.iconDiv.classList.add("selected"),o.treeView.iconDiv.classList.remove("selected"));let u=a&&h;V(o.separator,u),V(o.expandAll.div,u),V(o.collapseAll.div,u)}function r(o,a,h){let u=[];o.EnumerateMeshItems(d=>(d.IsVisible()||u.push(d.GetMeshInstanceId()),!0)),o.ClearMeshTree(),o.FillMeshTree(a.model);for(let d of u)o.GetMeshItem(d).SetVisible(!1,ce.Parents);i(o.buttons,o.showTree,h),o.callbacks.onViewTypeChanged()}this.buttons={flatList:{name:"Flat list",icon:"flat_list",div:null,iconDiv:null},treeView:{name:"Tree view",icon:"tree_view",div:null,iconDiv:null},separator:null,expandAll:{name:"Expand all",icon:"expand",div:null,iconDiv:null},collapseAll:{name:"Collapse all",icon:"collapse",div:null,iconDiv:null},showHideMeshes:{name:"Show/hide meshes",icon:"visible",div:null,iconDiv:null},fitToWindow:{name:"Fit meshes to window",icon:"fit",div:null,iconDiv:null}};let n=e.model.GetRootNode(),s=!1;for(let o of n.GetChildNodes())if(o.GetType()===Te.GroupNode){s=!0;break}t(this.buttonsDiv,this.buttons.flatList,null,()=>{!this.showTree||(this.showTree=!1,r(this,e,s))}),t(this.buttonsDiv,this.buttons.treeView,null,()=>{this.showTree||(this.showTree=!0,r(this,e,s))}),this.buttons.separator=v(this.buttonsDiv,"ov_navigator_buttons_separator"),t(this.buttonsDiv,this.buttons.expandAll,null,()=>{this.rootItem.ExpandAll(!0)}),t(this.buttonsDiv,this.buttons.collapseAll,null,()=>{this.rootItem.ExpandAll(!1)}),t(this.buttonsDiv,this.buttons.showHideMeshes,"right",()=>{let o=this.rootItem.GetNodeId();this.callbacks.onNodeShowHide(o)}),t(this.buttonsDiv,this.buttons.fitToWindow,"right",()=>{let o=this.rootItem.GetNodeId();this.callbacks.onNodeFitToWindow(o)}),i(this.buttons,this.showTree,s)}FillMeshTree(e){function t(o,a,h,u,d,m){let c=a.GetMesh(u),g=vi(c.GetName()),f=new rt(h.GetId(),u),p=m?"tree_mesh":null,x=new zt(g,p,f,{onShowHide:C=>{o.callbacks.onMeshShowHide(C)},onFitToWindow:C=>{o.callbacks.onMeshFitToWindow(C)},onSelected:C=>{o.callbacks.onMeshSelected(C)}});o.meshInstanceIdToItem.set(f.GetKey(),x),d.AddChild(x)}function i(o,a){let h=_n(a.GetName()),u=a.GetId(),d=new ke(h,u,{onShowHide:m=>{o.callbacks.onNodeShowHide(m)},onFitToWindow:m=>{o.callbacks.onNodeFitToWindow(m)}});return o.nodeIdToItem.set(u,d),d}function r(o,a){let h=a.GetId(),u=new ke(null,h,{onVisibilityChanged:d=>{d?We(o.buttons.showHideMeshes.iconDiv,"visible"):We(o.buttons.showHideMeshes.iconDiv,"hidden")}});return u.Show(!1),u.ShowChildren(!0),o.treeView.AddChild(u),o.nodeIdToItem.set(h,u),u}function n(o,a,h,u,d){let m=[];for(let c of h.GetChildNodes())if(d)if(c.GetType()===Te.GroupNode){let g=i(o,c);u.AddChild(g),n(o,a,c,g,d)}else c.GetType()===Te.MeshNode&&m.push(c);else n(o,a,c,u,d);for(let c of m)n(o,a,c,u,d);for(let c of h.GetMeshIndices())t(o,a,h,c,u,d)}let s=e.GetRootNode();this.rootItem=r(this,s),n(this,e,s,this.rootItem,this.showTree)}UpdateMaterialList(e){this.materialsButton.Update(e)}GetNodeItem(e){return this.nodeIdToItem.get(e)}MeshItemCount(){return this.meshInstanceIdToItem.size}GetMeshItem(e){return this.meshInstanceIdToItem.get(e.GetKey())}EnumerateNodeItems(e){for(let t of this.nodeIdToItem.values())if(!e(t))break}EnumerateMeshItems(e){for(let t of this.meshInstanceIdToItem.values())if(!e(t))break}IsMeshVisible(e){return this.GetMeshItem(e).IsVisible()}HasHiddenMesh(){let e=!1;return this.EnumerateMeshItems(t=>t.IsVisible()?!0:(e=!0,!1)),e}ShowAllMeshes(e){this.EnumerateNodeItems(t=>(t.SetVisible(e,ce.No),!0)),this.EnumerateMeshItems(t=>(t.SetVisible(e,ce.No),!0))}ToggleNodeVisibility(e){let t=this.GetNodeItem(e);t.SetVisible(!t.IsVisible(),ce.All)}ToggleMeshVisibility(e){let t=this.GetMeshItem(e);t.SetVisible(!t.IsVisible(),ce.Parents)}IsMeshIsolated(e){let t=!0;return this.EnumerateMeshItems(i=>!i.GetMeshInstanceId().IsEqual(e)&&i.IsVisible()?(t=!1,!1):!0),t}IsolateMesh(e){this.ShowAllMeshes(!1),this.ToggleMeshVisibility(e)}};var re={Material:1,Mesh:2},St=class{constructor(e,t){this.type=e,this.materialIndex=null,this.meshInstanceId=null,this.type===re.Material?this.materialIndex=t:this.type===re.Mesh&&(this.meshInstanceId=t)}IsEqual(e){if(this.type!==e.type)return!1;if(this.type===re.Material)return this.materialIndex===e.materialIndex;if(this.type===re.Mesh)return this.meshInstanceId.IsEqual(e.meshInstanceId)}},Kr=class{constructor(e,t){this.mainDiv=e,this.splitterDiv=t,this.panelSet=new ni(e),this.callbacks=null,this.selection=null,this.tempSelectedMeshId=null,this.filesPanel=new jr(this.panelSet.GetContentDiv()),this.materialsPanel=new Xr(this.panelSet.GetContentDiv()),this.meshesPanel=new Yr(this.panelSet.GetContentDiv()),this.panelSet.AddPanel(this.filesPanel),this.panelSet.AddPanel(this.materialsPanel),this.panelSet.AddPanel(this.meshesPanel),this.panelSet.ShowPanel(this.meshesPanel)}ShowPanels(e){this.panelSet.ShowPanels(e)}Init(e){this.callbacks=e,this.panelSet.Init({onResize:()=>{V(this.splitterDiv,this.panelSet.IsPanelsVisible()),this.callbacks.onResize()},onShowHidePanels:t=>{this.callbacks.onShowHidePanels(t)}}),this.filesPanel.Init({onFileBrowseButtonClicked:()=>{this.callbacks.openFileBrowserDialog()}}),this.materialsPanel.Init({onMaterialSelected:t=>{this.SetSelection(new St(re.Material,t))},onMeshTemporarySelected:t=>{this.tempSelectedMeshId=t,this.callbacks.updateMeshesSelection()},onMeshSelected:t=>{this.SetSelection(new St(re.Mesh,t))}}),this.meshesPanel.Init({onMeshSelected:t=>{this.SetSelection(new St(re.Mesh,t))},onMeshShowHide:t=>{this.ToggleMeshVisibility(t)},onMeshFitToWindow:t=>{this.FitMeshToWindow(t)},onNodeShowHide:t=>{this.ToggleNodeVisibility(t)},onNodeFitToWindow:t=>{this.FitNodeToWindow(t)},onMaterialSelected:t=>{this.SetSelection(new St(re.Material,t))},onViewTypeChanged:()=>{this.SetSelection(null)}}),Mi(this.splitterDiv,this.mainDiv,!1,()=>{this.callbacks.onResize()})}GetWidth(){let e=Ft(this.mainDiv),t=0;return this.panelSet.IsPanelsVisible()&&(t=this.splitterDiv.offsetWidth),e+t}Resize(e){Qe(this.mainDiv,e),de(this.splitterDiv,e),this.panelSet.Resize()}FillTree(e){this.filesPanel.Fill(e),e.missingFiles.length===0?this.panelSet.SetPanelIcon(this.filesPanel,"files"):this.panelSet.SetPanelIcon(this.filesPanel,"missing_files"),this.materialsPanel.Fill(e),this.meshesPanel.Fill(e),this.OnSelectionChanged()}MeshItemCount(){return this.meshesPanel.MeshItemCount()}IsMeshVisible(e){return this.meshesPanel.IsMeshVisible(e)}HasHiddenMesh(){return this.meshesPanel.HasHiddenMesh()}ShowAllMeshes(e){this.meshesPanel.ShowAllMeshes(e),this.callbacks.updateMeshesVisibility()}ToggleNodeVisibility(e){this.meshesPanel.ToggleNodeVisibility(e),this.callbacks.updateMeshesVisibility()}ToggleMeshVisibility(e){this.meshesPanel.ToggleMeshVisibility(e),this.callbacks.updateMeshesVisibility()}IsMeshIsolated(e){return this.meshesPanel.IsMeshIsolated(e)}IsolateMesh(e){this.meshesPanel.IsolateMesh(e),this.callbacks.updateMeshesVisibility()}GetSelectedMeshId(){return this.tempSelectedMeshId!==null?this.tempSelectedMeshId:this.selection===null||this.selection.type!==re.Mesh?null:this.selection.meshInstanceId}SetSelection(e){function t(n,s,o){s.type===re.Material?(o&&n.panelSet.IsPanelsVisible()&&n.panelSet.ShowPanel(n.materialsPanel),n.materialsPanel.SelectMaterialItem(s.materialIndex,o)):s.type===re.Mesh&&(o&&n.panelSet.IsPanelsVisible()&&n.panelSet.ShowPanel(n.meshesPanel),n.meshesPanel.GetMeshItem(s.meshInstanceId).SetSelected(o))}function i(n,s){n.selection=s,n.OnSelectionChanged()}let r=this.selection;r!==null&&t(this,r,!1),i(this,e),this.tempSelectedMeshId=null,this.selection!==null&&(r!==null&&r.IsEqual(this.selection)?(t(this,this.selection,!1),i(this,null)):t(this,this.selection,!0)),this.callbacks.updateMeshesSelection()}OnSelectionChanged(){this.selection===null?this.callbacks.onModelSelected():this.selection.type===re.Material?this.callbacks.onMaterialSelected(this.selection.materialIndex):this.selection.type===re.Mesh&&this.callbacks.onMeshSelected(this.selection.meshInstanceId),this.UpdatePanels()}UpdatePanels(){let e=null,t=null;this.selection!==null&&(this.selection.type===re.Material?e=this.selection.materialIndex:this.selection.type===re.Mesh&&(t=this.selection.meshInstanceId));let i=this.callbacks.getMeshesForMaterial(e);this.materialsPanel.UpdateMeshList(i);let r=this.callbacks.getMaterialsForMesh(t);this.meshesPanel.UpdateMaterialList(r)}FitNodeToWindow(e){let t=new Set;this.meshesPanel.GetNodeItem(e).EnumerateMeshItems(r=>{t.add(r.GetMeshInstanceId())}),this.callbacks.fitMeshesToWindow(t)}FitMeshToWindow(e){this.callbacks.fitMeshToWindow(e)}Clear(){this.panelSet.Clear(),this.selection=null}};function li(l,e){let t=new Date,i=365;t.setTime(t.getTime()+i*24*60*60*1e3),document.cookie=l+"="+e+"; expires="+t.toUTCString()+";"}function ai(l,e){let i=decodeURIComponent(document.cookie).split(";");for(let r=0;r<i.length;r++){let n=i[r].trim();if(n.startsWith(l+"="))return n.substring(l.length+1)}return e}function Mt(l,e){let t=ai(l,null);return t===null?e:t==="true"}function bt(l,e){li(l,e?"true":"false")}function Jr(l,e){let t=ai(l,null);return t===null?e:parseInt(t,10)}function Zr(l,e){li(l,e.toString())}function zi(l,e){let t=ai(l,null);return t===null?e:Ce.StringToColor(t)}function Wi(l,e){li(l,Ce.ColorToString(e))}var ae={Light:1,Dark:2},hi=class{constructor(){this.backgroundColor=new E(255,255,255),this.defaultColor=new E(200,200,200),this.showGrid=!1,this.showEdges=!1,this.edgeColor=new E(0,0,0),this.edgeThreshold=1,this.themeId=ae.Light}LoadFromCookies(){this.backgroundColor=zi("ov_background_color",new E(255,255,255)),this.defaultColor=zi("ov_default_color",new E(200,200,200)),this.showGrid=Mt("ov_show_grid",!1),this.showEdges=Mt("ov_show_edges",!1),this.edgeColor=zi("ov_edge_color",new E(0,0,0)),this.edgeThreshold=Jr("ov_edge_threshold",1),this.themeId=Jr("ov_theme_id",ae.Light)}SaveToCookies(){Wi("ov_background_color",this.backgroundColor),Wi("ov_default_color",this.defaultColor),bt("ov_show_grid",this.showGrid),bt("ov_show_edges",this.showEdges),Wi("ov_edge_color",this.edgeColor),Zr("ov_edge_threshold",this.edgeThreshold),Zr("ov_theme_id",this.themeId)}};var ji={ShowGrid:!1,MeasureTool:!1};function oo(l,e,t){let i=Re(l,e),r=Re(e,t),n=Re(l,t),s=(i+r+n)/2,o=s*(s-i)*(s-r)*(s-n);return o<0?0:Math.sqrt(o)}function lo(l,e,t){return hr(l,je(e,t))/6}function Bs(l){let e=0;return l.EnumerateTriangleVertices((t,i,r)=>{e+=lo(t,i,r)}),e}function Os(l){let e=0;return l.EnumerateTriangleVertices((t,i,r)=>{e+=oo(t,i,r)}),e}var yt=class extends ri{constructor(e){super(e);this.callbacks=null,this.titleDiv=v(this.panelDiv,"ov_sidebar_title"),this.contentDiv=v(this.panelDiv,"ov_sidebar_content ov_thin_scrollbar");let t=this.GetName();v(this.titleDiv,"ov_sidebar_title_text",this.GetName()),this.titleDiv.setAttribute("title",t)}GetName(){return null}Clear(){ue(this.contentDiv)}Init(e){this.callbacks=e}};var Qr=class extends yt{constructor(e){super(e)}GetName(){return"Details"}GetIcon(){return"details"}AddObject3DProperties(e){this.Clear();let t=v(this.contentDiv,"ov_property_table"),i=gr(e),r=ie(i.max,i.min);if(this.AddProperty(t,new O(P.Integer,"Vertices",e.VertexCount())),this.AddProperty(t,new O(P.Integer,"Triangles",e.TriangleCount())),this.AddProperty(t,new O(P.Number,"Size X",r.x)),this.AddProperty(t,new O(P.Number,"Size Y",r.y)),this.AddProperty(t,new O(P.Number,"Size Z",r.z)),this.AddCalculatedProperty(t,"Volume",()=>{if(!rs(e))return null;let n=Bs(e);return new O(P.Number,null,n)}),this.AddCalculatedProperty(t,"Surface",()=>{let n=Os(e);return new O(P.Number,null,n)}),e.PropertyGroupCount()>0){let n=v(this.contentDiv,"ov_property_table ov_property_table_custom");for(let s=0;s<e.PropertyGroupCount();s++){let o=e.GetPropertyGroup(s);this.AddPropertyGroup(n,o);for(let a=0;a<o.PropertyCount();a++){let h=o.GetProperty(a);this.AddPropertyInGroup(n,h)}}}this.Resize()}AddMaterialProperties(e){function t(n,s,o,a){if(a===null||a.name===null)return;let h=$(a.name);n.AddProperty(s,new O(P.Text,o,h))}this.Clear();let i=v(this.contentDiv,"ov_property_table"),r=null;e.type===X.Phong?r="Phong":e.type===X.Physical&&(r="Physical"),this.AddProperty(i,new O(P.Text,"Source",e.isDefault?"Default":"Model")),this.AddProperty(i,new O(P.Text,"Type",r)),e.vertexColors?this.AddProperty(i,new O(P.Text,"Color","Vertex colors")):(this.AddProperty(i,new O(P.Color,"Color",e.color)),e.type===X.Phong&&(this.AddProperty(i,new O(P.Color,"Ambient",e.ambient)),this.AddProperty(i,new O(P.Color,"Specular",e.specular)))),e.type===X.Physical&&(this.AddProperty(i,new O(P.Percent,"Metalness",e.metalness)),this.AddProperty(i,new O(P.Percent,"Roughness",e.roughness))),this.AddProperty(i,new O(P.Percent,"Opacity",e.opacity)),t(this,i,"Diffuse Map",e.diffuseMap),t(this,i,"Bump Map",e.bumpMap),t(this,i,"Normal Map",e.normalMap),t(this,i,"Emissive Map",e.emissiveMap),e.type===X.Phong?t(this,i,"Specular Map",e.specularMap):e.type===X.Physical&&t(this,i,"Metallic Map",e.metalnessMap),this.Resize()}AddPropertyGroup(e,t){v(e,"ov_property_table_row group",t.name).setAttribute("title",t.name)}AddProperty(e,t){let i=v(e,"ov_property_table_row"),r=v(i,"ov_property_table_cell ov_property_table_name",t.name+":"),n=v(i,"ov_property_table_cell ov_property_table_value");return r.setAttribute("title",t.name),this.DisplayPropertyValue(t,n),i}AddPropertyInGroup(e,t){this.AddProperty(e,t).classList.add("ingroup")}AddCalculatedProperty(e,t,i){let r=v(e,"ov_property_table_row"),n=v(r,"ov_property_table_cell ov_property_table_name",t+":"),s=v(r,"ov_property_table_cell ov_property_table_value");n.setAttribute("title",t),v(s,"ov_property_table_button","Calculate...").addEventListener("click",()=>{ue(s),s.innerHTML="Please wait...",pt(()=>{let a=i();a===null?s.innerHTML="-":this.DisplayPropertyValue(a,s)})})}DisplayPropertyValue(e,t){ue(t);let i=null;if(e.type===P.Text)i=e.value;else if(e.type===P.Integer)i=e.value.toLocaleString();else if(e.type===P.Number)i=e.value.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2});else if(e.type===P.Boolean)i=e.value?"True":"False";else if(e.type===P.Percent)i=parseInt(e.value*100,10).toString()+"%";else if(e.type===P.Color){let r="#"+Ge(e.value),n=Si(e.value);t.appendChild(n),Q(t,"span",null,r)}i!==null&&(t.innerHTML=i,t.setAttribute("title",i))}};var $r=class extends yt{constructor(e,t){super(e);this.measureTool=t,this.helpSection=null,this.resultSection=null}GetName(){return"Measure"}GetIcon(){return"measure"}Init(e){super.Init(e);let t=!1,i=v(this.contentDiv,"ov_button ov_sidebar_button","Activate");i.addEventListener("click",()=>{t=!t,t?(i.classList.add("outline"),i.innerHTML="Deactivate"):(i.classList.remove("outline"),i.innerHTML="Activate"),this.callbacks.onActivatedChange(t)}),this.helpSection=v(this.contentDiv,"ov_sidebar_section"),this.resultSection=v(this.contentDiv,"ov_sidebar_section"),this.helpSection.innerHTML=this.GetDefaultHelpText()}UpdateMeasureTool(){if(ue(this.helpSection),ue(this.resultSection),V(this.helpSection,!0),V(this.resultSection,!1),this.measureTool.IsActive()){let e=this.measureTool.GetMarkerCount();if(e===0)this.helpSection.innerHTML="Click on a model point to start measure.";else if(e===1)this.helpSection.innerHTML="Click on another model point to see the results.";else if(e===2){V(this.helpSection,!1),V(this.resultSection,!0);let t=this.measureTool.Calculate();v(this.resultSection,"ov_sidebar_measure_name","Distance of points");let i=t.pointsDistance.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4});if(v(this.resultSection,"ov_sidebar_measure_value",i),v(this.resultSection,"ov_sidebar_measure_name","Distance of parallel faces"),t.parallelFacesDistance!==null){let s=t.parallelFacesDistance.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4});v(this.resultSection,"ov_sidebar_measure_value",s)}else v(this.resultSection,"ov_sidebar_measure_value","Faces are not parallel");v(this.resultSection,"ov_sidebar_measure_name","Angle of faces");let n=(t.facesAngle*Cn).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:4});v(this.resultSection,"ov_sidebar_measure_value",n+"\xB0")}}else this.helpSection.innerHTML=this.GetDefaultHelpText()}GetDefaultHelpText(){return`<ol>
        <li>Activate measure mode with the button above.</li>
        <li>Click two points in the model to see the results.</li>
        </ol>`}Clear(){}};function Us(l,e,t,i){let r=Pickr.create({el:l,theme:"monolith",position:"left-start",swatches:t,comparison:!1,default:"#"+Ge(e),components:{preview:!1,opacity:!1,hue:!0,interaction:{hex:!1,rgba:!1,hsla:!1,hsva:!1,cmyk:!1,input:!0,clear:!1,save:!1}}});return r.on("change",(n,s,o)=>{let a=n.toRGBA(),h=new E(parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10));i(h)}),r}var en=class{constructor(e){this.parentDiv=e,this.contentDiv=null,this.pickr=null}Init(e,t,i,r,n){this.contentDiv=v(this.parentDiv,"ov_sidebar_settings_content");let s=v(this.contentDiv,"ov_sidebar_subtitle"),o=v(s,"ov_color_picker");v(s,"ov_sidebar_subtitle",e),this.pickr=Us(o,i,r,a=>{n(a)}),v(this.contentDiv,"ov_sidebar_settings_padded",t)}Show(e){V(this.contentDiv,e)}Update(e){this.pickr!==null&&this.pickr.setColor("#"+Ge(e))}Clear(){this.pickr!==null&&this.pickr.hide()}},ks=class{constructor(e){this.parentDiv=e,this.gridDisplayToggle=null}Init(e,t){let i=v(this.parentDiv,"ov_sidebar_settings_content"),r=v(i,"ov_sidebar_subtitle");this.showGridToggle=xi(r,"ov_sidebar_subtitle_toggle"),this.showGridToggle.OnChange(()=>{t(this.showGridToggle.GetStatus())}),v(r,"ov_sidebar_subtitle_text","Show Grid"),this.showGridToggle.SetStatus(e)}Update(e){this.showGridToggle!==null&&this.showGridToggle.SetStatus(e)}},Hs=class{constructor(e){this.parentDiv=e,this.edgeDisplayToggle=null,this.pickr=null,this.thresholdSlider=null,this.thresholdSliderValue=null,this.edgeSettingsDiv=null}Init(e,t,i,r){let n=v(this.parentDiv,"ov_sidebar_settings_content"),s=v(n,"ov_sidebar_subtitle");this.edgeDisplayToggle=xi(s,"ov_sidebar_subtitle_toggle"),v(s,"ov_sidebar_subtitle_text","Show Edges"),this.edgeSettingsDiv=v(n,"ov_sidebar_settings_padded"),this.edgeDisplayToggle.OnChange(()=>{V(this.edgeSettingsDiv,this.edgeDisplayToggle.GetStatus()),r.onShowEdgesChange(!!this.edgeDisplayToggle.GetStatus())});let o=v(this.edgeSettingsDiv,"ov_sidebar_settings_row"),a=["#ffffff","#e3e3e3","#c9c9c9","#898989","#5f5f5f","#494949","#383838","#0f0f0f"],h=v(o,"ov_color_picker");this.pickr=Us(h,t,a,d=>{r.onEdgeColorChange(d)}),v(o,null,"Edge Color");let u=v(this.edgeSettingsDiv,"ov_sidebar_settings_row large");this.thresholdSlider=En(u,0,90),this.thresholdSlider.setAttribute("title","Edge Angle Threshold"),this.thresholdSliderValue=Q(u,"span","ov_slider_label"),this.thresholdSlider.addEventListener("input",()=>{this.thresholdSliderValue.innerHTML=this.thresholdSlider.value}),this.thresholdSlider.addEventListener("change",()=>{r.onEdgeThresholdChange(this.thresholdSlider.value)}),this.thresholdSlider.value=i,this.thresholdSliderValue.innerHTML=i,this.edgeDisplayToggle.SetStatus(e),this.ShowEdgeSettings(e)}Update(e,t,i){this.edgeDisplayToggle!==null&&(this.edgeDisplayToggle.SetStatus(e),this.ShowEdgeSettings(e),this.pickr.setColor("#"+Ge(t)),this.thresholdSlider.value=i,this.thresholdSliderValue.innerHTML=i)}ShowEdgeSettings(e){V(this.edgeSettingsDiv,e)}Clear(){this.pickr!==null&&this.pickr.hide()}},zs=class{constructor(e){this.parentDiv=e,this.darkModeToggle=null}Init(e,t){let i=v(this.parentDiv,"ov_sidebar_settings_content"),r=v(i,"ov_sidebar_subtitle");this.darkModeToggle=xi(r,"ov_sidebar_subtitle_toggle"),this.darkModeToggle.OnChange(()=>{t(this.darkModeToggle.GetStatus()?ae.Dark:ae.Light)}),v(r,"ov_sidebar_subtitle_text","Dark Mode");let n=e===ae.Dark;this.darkModeToggle.SetStatus(n)}Update(e){if(this.darkModeToggle===null)return;let t=e===ae.Dark;this.darkModeToggle.SetStatus(t)}},tn=class extends yt{constructor(e,t){super(e);this.settings=t,this.sectionsDiv=v(this.contentDiv,"ov_sidebar_settings_sections ov_thin_scrollbar"),this.backgroundColorSection=new en(this.sectionsDiv),this.defaultColorSection=new en(this.sectionsDiv),this.gridDisplaySection=null,ji.ShowGrid&&(this.gridDisplaySection=new ks(this.sectionsDiv)),this.edgeDisplaySection=new Hs(this.sectionsDiv),this.themeSection=new zs(this.sectionsDiv),this.resetToDefaultsButton=v(this.contentDiv,"ov_button ov_sidebar_button outline","Reset to Default"),this.resetToDefaultsButton.addEventListener("click",()=>{this.ResetToDefaults()})}GetName(){return"Settings"}GetIcon(){return"settings"}Clear(){this.backgroundColorSection.Clear(),this.defaultColorSection.Clear(),this.edgeDisplaySection.Clear()}Init(e){super.Init(e),this.backgroundColorSection.Init("Background Color","Affects only the visualization.",this.settings.backgroundColor,["#ffffff","#e3e3e3","#c9c9c9","#898989","#5f5f5f","#494949","#383838","#0f0f0f"],t=>{this.SetBackgroundColor(t,!1)}),this.defaultColorSection.Init("Default Color","Appears when the model doesn't have materials.",this.settings.defaultColor,["#ffffff","#e3e3e3","#cc3333","#fac832","#4caf50","#3393bd","#9b27b0","#fda4b8"],t=>{this.SetDefaultColor(t,!1)}),this.gridDisplaySection!==null&&this.gridDisplaySection.Init(this.settings.showGrid,t=>{this.settings.showGrid=t,e.onGridDisplayChange()}),this.edgeDisplaySection.Init(this.settings.showEdges,this.settings.edgeColor,this.settings.edgeThreshold,{onShowEdgesChange:t=>{this.settings.showEdges=t,e.onEdgeDisplayChange()},onEdgeColorChange:t=>{this.settings.edgeColor=t,e.onEdgeDisplayChange()},onEdgeThresholdChange:t=>{this.settings.edgeThreshold=t,e.onEdgeDisplayChange()}}),this.themeSection.Init(this.settings.themeId,t=>{this.settings.themeId=t,t===ae.Light?(this.SetBackgroundColor(new E(255,255,255),!0),this.SetDefaultColor(new E(200,200,200),!0)):t===ae.Dark&&(this.SetBackgroundColor(new E(42,43,46),!0),this.SetDefaultColor(new E(200,200,200),!0)),e.onThemeChange()})}UpdateSettings(e){this.defaultColorSection.Show(e),this.Resize()}SetBackgroundColor(e,t){this.settings.backgroundColor=e,t?this.backgroundColorSection.Update(e):this.callbacks.onBackgroundColorChange()}SetDefaultColor(e,t){this.settings.defaultColor=e,t?this.defaultColorSection.Update(e):this.callbacks.onDefaultColorChange()}ResetToDefaults(){let e=new hi;this.settings.backgroundColor=e.backgroundColor,this.settings.defaultColor=e.defaultColor,this.settings.showGrid=e.showGrid,this.settings.showEdges=e.showEdges,this.settings.edgeColor=e.edgeColor,this.settings.edgeThreshold=e.edgeThreshold,this.settings.themeId=e.themeId,this.backgroundColorSection.Update(e.backgroundColor),this.defaultColorSection.Update(e.defaultColor),this.gridDisplaySection!==null&&this.gridDisplaySection.Update(e.showGrid),this.edgeDisplaySection.Update(e.showEdges,e.edgeColor,e.edgeThreshold),this.themeSection.Update(e.themeId),this.gridDisplaySection!==null&&this.callbacks.onGridDisplayChange(),this.callbacks.onThemeChange()}Resize(){let e=Ae(this.titleDiv),t=Ae(this.resetToDefaultsButton),i=this.parentDiv.offsetHeight;Qe(this.sectionsDiv,i-e-t)}};var rn=class{constructor(e,t,i,r){this.mainDiv=e,this.splitterDiv=t,this.panelSet=new ni(e),this.detailsPanel=new Qr(this.panelSet.GetContentDiv()),this.settingsPanel=new tn(this.panelSet.GetContentDiv(),i),this.measurePanel=new $r(this.panelSet.GetContentDiv(),r),this.panelSet.AddPanel(this.detailsPanel),this.panelSet.AddPanel(this.settingsPanel),ji.MeasureTool&&this.panelSet.AddPanel(this.measurePanel),this.panelSet.ShowPanel(this.detailsPanel)}IsPanelsVisible(){return this.panelSet.IsPanelsVisible()}ShowPanels(e){this.panelSet.ShowPanels(e)}Init(e){this.callbacks=e,this.panelSet.Init({onResize:()=>{V(this.splitterDiv,this.panelSet.IsPanelsVisible()),this.callbacks.onResize()},onShowHidePanels:t=>{this.callbacks.onShowHidePanels(t)}}),this.settingsPanel.Init({onBackgroundColorChange:()=>{this.callbacks.onBackgroundColorChange()},onDefaultColorChange:()=>{this.callbacks.onDefaultColorChange()},onGridDisplayChange:()=>{this.callbacks.onGridDisplayChange()},onEdgeDisplayChange:()=>{this.callbacks.onEdgeDisplayChange()},onThemeChange:()=>{this.callbacks.onThemeChange()}}),this.measurePanel.Init({onActivatedChange:t=>{this.callbacks.onMeasureToolActivedChange(t)}}),Mi(this.splitterDiv,this.mainDiv,!0,()=>{this.callbacks.onResize()})}UpdateSettings(e){this.settingsPanel.UpdateSettings(e)}UpdateMeasureTool(){this.measurePanel.UpdateMeasureTool()}Resize(e){Qe(this.mainDiv,e),de(this.splitterDiv,e),this.panelSet.Resize()}GetWidth(){let e=Ft(this.mainDiv),t=0;return this.panelSet.IsPanelsVisible()&&(t=this.splitterDiv.offsetWidth),e+t}DecreaseWidth(e){let t=this.mainDiv.offsetWidth;Rt(this.mainDiv,t-e)}Clear(){this.panelSet.Clear()}AddObject3DProperties(e){this.detailsPanel.AddObject3DProperties(e)}AddMaterialProperties(e){this.detailsPanel.AddMaterialProperties(e)}};var nn=class{constructor(){this.css={"--ov_foreground_color":{},"--ov_background_color":{},"--ov_button_color":{},"--ov_button_hover_color":{},"--ov_button_text_color":{},"--ov_outline_button_color":{},"--ov_outline_button_hover_color":{},"--ov_outline_button_text_color":{},"--ov_icon_color":{},"--ov_light_icon_color":{},"--ov_selected_icon_color":{},"--ov_disabled_icon_color":{},"--ov_hover_color":{},"--ov_hover_text_color":{},"--ov_logo_text_color":{},"--ov_logo_border_color":{},"--ov_toolbar_background_color":{},"--ov_toolbar_selected_color":{},"--ov_toolbar_separator_color":{},"--ov_treeview_selected_color":{},"--ov_dialog_foreground_color":{},"--ov_dialog_background_color":{},"--ov_border_color":{},"--ov_shadow":{}};let e=document.querySelector(":root"),t=window.getComputedStyle(e);for(let i in this.css)Object.prototype.hasOwnProperty.call(this.css,i)&&(this.css[i].light=t.getPropertyValue(i),this.css[i].dark=t.getPropertyValue(i+"_dark"))}SwitchTheme(e){let t=null;if(e===ae.Light)t="light";else if(e===ae.Dark)t="dark";else return;let i=document.querySelector(":root");for(let r in this.css)if(Object.prototype.hasOwnProperty.call(this.css,r)){let n=this.css[r][t];n!==void 0&&i.style.setProperty(r,n)}}};var sn=class{constructor(e,t,i){this.image=e,this.imageTitle=t,this.selected=!1,this.buttonDiv=me("ov_toolbar_button"),this.buttonImg=fe(this.buttonDiv,this.image),i!==null&&this.buttonDiv.addEventListener("click",i),this.buttonDiv.setAttribute("alt",this.imageTitle),Ii(this.buttonDiv,this.imageTitle)}AddDomElements(e){e.appendChild(this.buttonDiv)}AddClass(e){this.buttonDiv.classList.add(e)}RemoveClass(e){this.buttonDiv.classList.remove(e)}AddImageClass(e){this.buttonImg.classList.add(e)}RemoveImageClass(e){this.buttonImg.classList.remove(e)}IsSelected(){return this.selected}SetSelected(e){this.selected=e,this.selected?this.buttonDiv.classList.add("selected"):this.buttonDiv.classList.remove("selected")}},on=class{constructor(e){this.mainDiv=v(e,"ov_toolbar")}AddImageButton(e,t,i){let r=new sn(e,t,i);return r.AddDomElements(this.mainDiv),r}AddImagePushButton(e,t,i,r){let n=new sn(e,t,()=>{n.SetSelected(!n.IsSelected()),r()});return n.AddDomElements(this.mainDiv),n.SetSelected(i),n}AddImageRadioButton(e,t,i){let r=[];for(let n=0;n<e.length;n++){let s=e[n],o=this.AddImageButton(s.image,s.title,()=>{for(let a=0;a<r.length;a++){let h=r[a];a===n?h.SetSelected(!0):h.SetSelected(!1)}i(n)});t===n&&o.SetSelected(!0),r.push(o)}return r}AddSeparator(){return v(this.mainDiv,"ov_toolbar_separator")}};var Ws=class{constructor(){this.indices=[],this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.material=null}GetBounds(){let e=[1/0,1/0,1/0],t=[-1/0,-1/0,-1/0];for(let i=0;i<this.vertices.length/3;i++)for(let r=0;r<3;r++)e[r]=Math.min(e[r],this.vertices[i*3+r]),t[r]=Math.max(t[r],this.vertices[i*3+r]);return{min:e,max:t}}GetByteLength(e,t){let i=this.indices.length,r=this.vertices.length+this.colors.length+this.normals.length+this.uvs.length;return i*e+r*t}},js=class{constructor(){this.primitives=[]}PrimitiveCount(){return this.primitives.length}GetPrimitive(e){return this.primitives[e]}GetByteLength(e,t){let i=0;for(let r=0;r<this.primitives.length;r++)i+=this.primitives[r].GetByteLength(e,t);return i}};function qi(l){function e(o,a,h,u){function d(f,p,x){return p!==null?f.GetVertexColor(p):x?new E(0,0,0):null}function m(f,p,x){return p!==null?f.GetTextureUV(p):x?new R(0,0):null}function c(f,p,x){let C=f.VertexColorCount()>0,I=f.TextureUVCount()>0,T=f.GetVertex(p.vertex),S=f.GetNormal(p.normal),w=x.vertices.length/3;x.indices.push(w),x.vertices.push(T.x,T.y,T.z);let b=d(f,p.color,C);b!==null&&x.colors.push(b.r/255,b.g/255,b.b/255),x.normals.push(S.x,S.y,S.z);let D=m(f,p.uv,I);return D!==null&&x.uvs.push(D.x,D.y),{index:w,color:b,normal:S,uv:D}}function g(f,p,x){function C(S,w,b){if(b===null&&w===null)return!0;let D=d(S,w,!0);return ft(b,D)}function I(S,w,b){let D=S.GetNormal(w);return _e(b,D)}function T(S,w,b){if(b===null&&w===null)return!0;let D=m(S,w,!0);return ut(b,D)}for(let S=0;S<p.length;S++){let w=p[S],b=C(f,x.color,w.color),D=I(f,x.normal,w.normal),y=T(f,x.uv,w.uv);if(b&&D&&y)return w}return null}if(u.has(a.vertex)){let f=u.get(a.vertex),p=g(o,f,a);if(p!==null)h.indices.push(p.index);else{let x=c(o,a,h);f.push(x)}}else{let f=c(o,a,h);u.set(a.vertex,[f])}}let t=new js,i=l.TriangleCount();if(i===0)return null;let r=[];for(let o=0;o<i;o++)r.push(o);r.sort((o,a)=>{let h=l.GetTriangle(o),u=l.GetTriangle(a);return h.mat-u.mat});let n=null,s=null;for(let o=0;o<r.length;o++){let a=r[o],h=l.GetTriangle(a);(n===null||n.material!==h.mat)&&(n=new Ws,n.material=h.mat,s=new Map,t.primitives.push(n));let u={vertex:h.v0,color:h.c0,normal:h.n0,uv:h.u0},d={vertex:h.v1,color:h.c1,normal:h.n1,uv:h.u1},m={vertex:h.v2,color:h.c2,normal:h.n2,uv:h.u2};e(l,u,n,s),e(l,d,n,s),e(l,m,n,s)}return t}var Z=class{constructor(e){this.name=e,this.content=null}GetName(){return this.name}SetName(e){this.name=e}GetTextContent(){return oe(this.content)}GetBufferContent(){return this.content}SetTextContent(e){let t=Ci(e);this.content=t}SetBufferContent(e){this.content=e}},Me=class{constructor(){}CanExport(e,t){return!1}Export(e,t,i){let r=[];this.ExportContent(e,t,r,()=>{i(r)})}ExportContent(e,t,i,r){}GetExportedMaterialName(e){return this.GetExportedName(e,"Material")}GetExportedMeshName(e){return this.GetExportedName(e,"Mesh")}GetExportedName(e,t){return e.length===0?t:e}};var ln=class extends Me{constructor(){super();this.rhino=null}CanExport(e,t){return e===F.Binary&&t==="3dm"}ExportContent(e,t,i,r){this.rhino===null?he("loaders/rhino3dm.min.js").then(()=>{rhino3dm().then(n=>{this.rhino=n,this.ExportRhinoContent(e,i,r)})}).catch(()=>{r()}):this.ExportRhinoContent(e,i,r)}ExportRhinoContent(e,t,i){function r(h){return{r:h.r,g:h.g,b:h.b,a:255}}let n=new Z("model.3dm");t.push(n);let s=new this.rhino.File3dm;e.EnumerateTransformedMeshes(h=>{let u=qi(h);for(let d=0;d<u.PrimitiveCount();d++){let m=u.GetPrimitive(d),c={data:{attributes:{position:{itemSize:3,type:"Float32Array",array:m.vertices},normal:{itemSize:3,type:"Float32Array",array:m.normals}},index:{type:"Uint16Array",array:m.indices}}},g=e.GetMaterial(m.material),f=new this.rhino.Material;f.name=this.GetExportedMaterialName(g.name),g.type===X.Phong&&(f.ambientColor=r(g.ambient),f.specularColor=r(g.specular)),f.diffuseColor=r(g.color),f.transparency=1-g.opacity;let p=s.materials().count();s.materials().add(f);let x=new this.rhino.Mesh.createFromThreejsJSON(c),C=new this.rhino.ObjectAttributes;C.name=this.GetExportedMeshName(h.GetName()),C.materialSource=this.rhino.ObjectMaterialSource.MaterialFromObject,C.materialIndex=p,s.objects().add(x,C)}});let o=new this.rhino.File3dmWriteOptions;o.version=6;let a=s.toByteArray(o);n.SetBufferContent(a),i()}};var at=class{constructor(e,t){this.arrayBuffer=new ArrayBuffer(e),this.dataView=new DataView(this.arrayBuffer),this.isLittleEndian=t,this.position=0}GetPosition(){return this.position}SetPosition(e){this.position=e}End(){return this.position>=this.arrayBuffer.byteLength}GetBuffer(){return this.arrayBuffer}WriteArrayBuffer(e){let t=new Uint8Array(e);new Uint8Array(this.arrayBuffer).set(t,this.position),this.position+=e.byteLength}WriteBoolean8(e){this.dataView.setInt8(this.position,e?1:0),this.position=this.position+1}WriteCharacter8(e){this.dataView.setInt8(this.position,e),this.position=this.position+1}WriteUnsignedCharacter8(e){this.dataView.setUint8(this.position,e),this.position=this.position+1}WriteInteger16(e){this.dataView.setInt16(this.position,e,this.isLittleEndian),this.position=this.position+2}WriteUnsignedInteger16(e){this.dataView.setUint16(this.position,e,this.isLittleEndian),this.position=this.position+2}WriteInteger32(e){this.dataView.setInt32(this.position,e,this.isLittleEndian),this.position=this.position+4}WriteUnsignedInteger32(e){this.dataView.setUint32(this.position,e,this.isLittleEndian),this.position=this.position+4}WriteFloat32(e){this.dataView.setFloat32(this.position,e,this.isLittleEndian),this.position=this.position+4}WriteDouble64(e){this.dataView.setFloat64(this.position,e,this.isLittleEndian),this.position=this.position+8}};var an=class extends Me{constructor(){super();this.components={index:{type:5125,size:4},number:{type:5126,size:4}}}CanExport(e,t){return e===F.Text&&t==="gltf"||e===F.Binary&&t==="glb"}ExportContent(e,t,i,r){t===F.Text?this.ExportAsciiContent(e,i):t===F.Binary&&this.ExportBinaryContent(e,i),r()}ExportAsciiContent(e,t){let i=new Z("model.gltf"),r=new Z("model.bin");t.push(i),t.push(r);let n=this.GetMeshData(e),s=this.GetMainBuffer(n),o=this.GetMainJson(n);o.buffers.push({uri:r.GetName(),byteLength:s.byteLength});let a=new Map;this.ExportMaterials(e,o,h=>{let u=$(h.name);if(a.has(u))return a.get(u);{let d=new Z(u);d.SetBufferContent(h.buffer),t.push(d);let m=o.textures.length;return a.set(u,m),o.images.push({uri:u}),o.textures.push({source:m}),m}}),i.SetTextContent(JSON.stringify(o,null,4)),r.SetBufferContent(s)}ExportBinaryContent(e,t){function i(T){let S=T%4;return S===0?T:T+(4-S)}function r(T,S,w){for(let b=0;b<w;b++)T.WriteUnsignedCharacter8(S)}let n=new Z("model.glb");t.push(n);let s=this.GetMeshData(e),o=this.GetMainBuffer(s),a=this.GetMainJson(s),h=[],u=o.byteLength,d=new Map;this.ExportMaterials(e,a,T=>{let S=$(T.name),w=Be(T.name);if(d.has(S))return d.get(S);{let b=a.bufferViews.length,D=a.textures.length;d.set(S,D);let y=T.buffer;return h.push(y),a.bufferViews.push({buffer:0,byteOffset:u,byteLength:y.byteLength}),u+=y.byteLength,a.images.push({bufferView:b,mimeType:"image/"+w}),a.textures.push({source:D}),D}});let m=o.byteLength;for(let T=0;T<h.length;T++)m+=h[T].byteLength;let c=i(m);a.buffers.push({byteLength:c});let g=JSON.stringify(a),f=Ci(g),p=f.byteLength,x=i(p),C=12+8+x+8+c,I=new at(C,!0);I.WriteUnsignedInteger32(1179937895),I.WriteUnsignedInteger32(2),I.WriteUnsignedInteger32(C),I.WriteUnsignedInteger32(x),I.WriteUnsignedInteger32(1313821514),I.WriteArrayBuffer(f),r(I,32,x-p),I.WriteUnsignedInteger32(c),I.WriteUnsignedInteger32(5130562),I.WriteArrayBuffer(o);for(let T=0;T<h.length;T++){let S=h[T];I.WriteArrayBuffer(S)}r(I,0,c-m),n.SetBufferContent(I.GetBuffer())}GetMeshData(e){let t=[];return e.EnumerateTransformedMeshes(i=>{let r=qi(i);t.push({name:i.GetName(),buffer:r,offsets:[],sizes:[]})}),t}GetMainBuffer(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r].buffer.GetByteLength(this.components.index.size,this.components.number.size);let i=new at(t,!0);for(let r=0;r<e.length;r++){let n=e[r];for(let s=0;s<n.buffer.PrimitiveCount();s++){let o=n.buffer.GetPrimitive(s),a=i.GetPosition();for(let h=0;h<o.indices.length;h++)i.WriteUnsignedInteger32(o.indices[h]);for(let h=0;h<o.vertices.length;h++)i.WriteFloat32(o.vertices[h]);for(let h=0;h<o.colors.length;h++)i.WriteFloat32(et(o.colors[h]));for(let h=0;h<o.normals.length;h++)i.WriteFloat32(o.normals[h]);for(let h=0;h<o.uvs.length;h++){let u=o.uvs[h];h%2===1&&(u*=-1),i.WriteFloat32(u)}n.offsets.push(a),n.sizes.push(i.GetPosition()-a)}}return i.GetBuffer()}GetMainJson(e){class t{constructor(n,s){this.mainJson=n,this.byteOffset=s}AddBufferView(n){return this.mainJson.bufferViews.push({buffer:0,byteOffset:this.byteOffset,byteLength:n}),this.byteOffset+=n,this.mainJson.bufferViews.length-1}}let i={asset:{generator:"website1/",version:"2.0"},scene:0,scenes:[{nodes:[]}],nodes:[],materials:[],meshes:[],buffers:[],bufferViews:[],accessors:[]};for(let r=0;r<e.length;r++){let n=e[r];i.scenes[0].nodes.push(r),i.nodes.push({mesh:r});let s={name:this.GetExportedMeshName(n.name),primitives:[]},o=n.buffer.primitives;for(let a=0;a<o.length;a++){let h=o[a],u=new t(i,n.offsets[a]),d=u.AddBufferView(h.indices.length*this.components.index.size),m=u.AddBufferView(h.vertices.length*this.components.number.size),c=null;h.colors.length>0&&(c=u.AddBufferView(h.colors.length*this.components.number.size));let g=u.AddBufferView(h.normals.length*this.components.number.size),f=null;h.uvs.length>0&&(f=u.AddBufferView(h.uvs.length*this.components.number.size));let p={attributes:{},mode:4,material:h.material},x=h.GetBounds();i.accessors.push({bufferView:d,byteOffset:0,componentType:this.components.index.type,count:h.indices.length,type:"SCALAR"}),p.indices=i.accessors.length-1,i.accessors.push({bufferView:m,byteOffset:0,componentType:this.components.number.type,count:h.vertices.length/3,min:x.min,max:x.max,type:"VEC3"}),p.attributes.POSITION=i.accessors.length-1,c!==null&&(i.accessors.push({bufferView:c,byteOffset:0,componentType:this.components.number.type,count:h.colors.length/3,type:"VEC3"}),p.attributes.COLOR_0=i.accessors.length-1),i.accessors.push({bufferView:g,byteOffset:0,componentType:this.components.number.type,count:h.normals.length/3,type:"VEC3"}),p.attributes.NORMAL=i.accessors.length-1,f!==null&&(i.accessors.push({bufferView:f,byteOffset:0,componentType:this.components.number.type,count:h.uvs.length/2,type:"VEC2"}),p.attributes.TEXCOORD_0=i.accessors.length-1),s.primitives.push(p)}i.meshes.push(s)}return i}ExportMaterials(e,t,i){function r(n,s,o,a){function h(p,x){return[et(p.r/255),et(p.g/255),et(p.b/255),x]}function u(p){return[et(p.r/255),et(p.g/255),et(p.b/255)]}function d(p,x,C){if(x===null||!x.IsValid())return null;p.images===void 0&&(p.images=[]),p.textures===void 0&&(p.textures=[]);let T={index:C(x)};if(x.HasTransformation()){let S="KHR_texture_transform";p.extensionsUsed===void 0&&(p.extensionsUsed=[]),p.extensionsUsed.indexOf(S)===-1&&p.extensionsUsed.push(S),T.extensions={KHR_texture_transform:{offset:[x.offset.x,-x.offset.y],scale:[x.scale.x,x.scale.y],rotation:-x.rotation}}}return T}let m={name:n.GetExportedMaterialName(o.name),pbrMetallicRoughness:{baseColorFactor:h(o.color,o.opacity)},emissiveFactor:u(o.emissive),doubleSided:!0,alphaMode:"OPAQUE"};o.transparent&&(m.alphaMode="BLEND");let c=d(s,o.diffuseMap,a);if(c!==null&&(o.multiplyDiffuseMap||(m.pbrMetallicRoughness.baseColorFactor=h(new E(255,255,255),o.opacity)),m.pbrMetallicRoughness.baseColorTexture=c),o.type===X.Physical){let p=d(s,o.metalnessMap,a);p!==null?m.pbrMetallicRoughness.metallicRoughnessTexture=p:(m.pbrMetallicRoughness.metallicFactor=o.metalness,m.pbrMetallicRoughness.roughnessFactor=o.roughness)}let g=d(s,o.normalMap,a);g!==null&&(m.normalTexture=g);let f=d(s,o.emissiveMap,a);f!==null&&(m.emissiveTexture=f),s.materials.push(m)}for(let n=0;n<e.MaterialCount();n++){let s=e.GetMaterial(n);r(this,t,s,i)}}};var Xi=class{constructor(e){this.transformation=new q,this.isMeshVisible=t=>!0,Li(e,this)}},ui=class{constructor(e,t){this.model=e,this.settings=t||new Xi}MaterialCount(){return this.model.MaterialCount()}GetMaterial(e){return this.model.GetMaterial(e)}VertexCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.VertexCount()}),e}TriangleCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=t.TriangleCount()}),e}MeshInstanceCount(){let e=0;return this.EnumerateMeshInstances(t=>{e+=1}),e}EnumerateMeshInstances(e){this.model.EnumerateMeshInstances(t=>{this.settings.isMeshVisible(t.GetId())&&e(t)})}EnumerateTransformedMeshes(e){this.EnumerateMeshInstances(t=>{let i=t.GetTransformation();this.settings.transformation.IsIdentity()||i.Append(this.settings.transformation);let n=t.GetMesh().Clone();i.IsIdentity()||it(n,i),e(n)})}EnumerateVerticesAndTriangles(e){let t=[];this.EnumerateTransformedMeshes(r=>{t.push(r)});for(let r of t)r.EnumerateVertices(n=>{e.onVertex(n.x,n.y,n.z)});let i=0;for(let r of t)r.EnumerateTriangleVertexIndices((n,s,o)=>{e.onTriangle(n+i,s+i,o+i)}),i+=r.VertexCount()}EnumerateTrianglesWithNormals(e){this.EnumerateTransformedMeshes(t=>{t.EnumerateTriangleVertices((i,r,n)=>{let s=Xt(i,r,n);e(i,r,n,s)})})}};var Ve=class{constructor(){this.text="",this.indentation=0}GetText(){return this.text}Indent(e){this.indentation+=e}WriteArrayLine(e){this.WriteLine(e.join(" "))}WriteLine(e){this.WriteIndentation(),this.Write(e+`
`)}WriteIndentation(){for(let e=0;e<this.indentation;e++)this.Write("  ")}Write(e){this.text+=e}};var hn=class extends Me{constructor(){super()}CanExport(e,t){return e===F.Text&&t==="obj"}ExportContent(e,t,i,r){function n(g,f,p,x){if(p===null||!p.IsValid())return;let C=$(p.name);if(g.WriteArrayLine([f,C]),x.findIndex(T=>T.GetName()===C)===-1){let T=new Z(C);T.SetBufferContent(p.buffer),x.push(T)}}let s=new Z("model.mtl"),o=new Z("model.obj");i.push(s),i.push(o);let a=new Ve;a.WriteLine(this.GetHeaderText());for(let g=0;g<e.MaterialCount();g++){let f=e.GetMaterial(g);a.WriteArrayLine(["newmtl",this.GetExportedMaterialName(f.name)]),a.WriteArrayLine(["Kd",f.color.r/255,f.color.g/255,f.color.b/255]),a.WriteArrayLine(["d",f.opacity]),f.type===X.Phong&&(a.WriteArrayLine(["Ka",f.ambient.r/255,f.ambient.g/255,f.ambient.b/255]),a.WriteArrayLine(["Ks",f.specular.r/255,f.specular.g/255,f.specular.b/255]),a.WriteArrayLine(["Ns",f.shininess*1e3])),n(a,"map_Kd",f.diffuseMap,i),f.type===X.Phong&&n(a,"map_Ks",f.specularMap,i),n(a,"bump",f.bumpMap,i)}s.SetTextContent(a.GetText());let h=new Ve;h.WriteLine(this.GetHeaderText()),h.WriteArrayLine(["mtllib",s.GetName()]);let u=0,d=0,m=0,c=null;e.EnumerateTransformedMeshes(g=>{h.WriteArrayLine(["g",this.GetExportedMeshName(g.GetName())]);for(let f=0;f<g.VertexCount();f++){let p=g.GetVertex(f);h.WriteArrayLine(["v",p.x,p.y,p.z])}for(let f=0;f<g.NormalCount();f++){let p=g.GetNormal(f);h.WriteArrayLine(["vn",p.x,p.y,p.z])}for(let f=0;f<g.TextureUVCount();f++){let p=g.GetTextureUV(f);h.WriteArrayLine(["vt",p.x,p.y])}for(let f=0;f<g.TriangleCount();f++){let p=g.GetTriangle(f),x=p.v0+u+1,C=p.v1+u+1,I=p.v2+u+1,T=p.n0+d+1,S=p.n1+d+1,w=p.n2+d+1;if(p.mat!==null){let G=e.GetMaterial(p.mat),k=this.GetExportedMaterialName(G.name);k!==c&&(h.WriteArrayLine(["usemtl",k]),c=k)}let b="",D="",y="";p.HasTextureUVs()&&(b=p.u0+m+1,D=p.u1+m+1,y=p.u2+m+1),h.WriteArrayLine(["f",[x,b,T].join("/"),[C,D,S].join("/"),[I,y,w].join("/")])}u+=g.VertexCount(),d+=g.NormalCount(),m+=g.TextureUVCount()}),o.SetTextContent(h.GetText()),r()}GetHeaderText(){return"# exported by website2/"}};var un=class extends Me{constructor(){super()}CanExport(e,t){return e===F.Text&&t==="off"}ExportContent(e,t,i,r){let n=new Z("model.off");i.push(n);let s=new Ve;s.WriteLine("OFF"),s.WriteArrayLine([e.VertexCount(),e.TriangleCount(),0]),e.EnumerateVerticesAndTriangles({onVertex:function(o,a,h){s.WriteArrayLine([o,a,h])},onTriangle:function(o,a,h){s.WriteArrayLine([3,o,a,h])}}),n.SetTextContent(s.GetText()),r()}};var dn=class extends Me{constructor(){super()}CanExport(e,t){return(e===F.Text||e===F.Binary)&&t==="ply"}ExportContent(e,t,i,r){t===F.Text?this.ExportText(e,i):this.ExportBinary(e,i),r()}ExportText(e,t){let i=new Z("model.ply");t.push(i);let r=new Ve,n=e.VertexCount(),s=e.TriangleCount(),o=this.GetHeaderText("ascii",n,s);r.Write(o),e.EnumerateVerticesAndTriangles({onVertex:function(a,h,u){r.WriteArrayLine([a,h,u])},onTriangle:function(a,h,u){r.WriteArrayLine([3,a,h,u])}}),i.SetTextContent(r.GetText())}ExportBinary(e,t){let i=new Z("model.ply");t.push(i);let r=e.VertexCount(),n=e.TriangleCount(),s=this.GetHeaderText("binary_little_endian",r,n),o=s.length+r*3*4+n*(1+3*4),a=new at(o,!0);for(let h=0;h<s.length;h++)a.WriteUnsignedCharacter8(s.charCodeAt(h));e.EnumerateVerticesAndTriangles({onVertex:function(h,u,d){a.WriteFloat32(h),a.WriteFloat32(u),a.WriteFloat32(d)},onTriangle:function(h,u,d){a.WriteUnsignedCharacter8(3),a.WriteInteger32(h),a.WriteInteger32(u),a.WriteInteger32(d)}}),i.SetBufferContent(a.GetBuffer())}GetHeaderText(e,t,i){let r=new Ve;return r.WriteLine("ply"),r.WriteLine("format "+e+" 1.0"),r.WriteLine("element vertex "+t),r.WriteLine("property float x"),r.WriteLine("property float y"),r.WriteLine("property float z"),r.WriteLine("element face "+i),r.WriteLine("property list uchar int vertex_index"),r.WriteLine("end_header"),r.GetText()}};var mn=class extends Me{constructor(){super()}CanExport(e,t){return(e===F.Text||e===F.Binary)&&t==="stl"}ExportContent(e,t,i,r){t===F.Text?this.ExportText(e,i):this.ExportBinary(e,i),r()}ExportText(e,t){let i=new Z("model.stl");t.push(i);let r=new Ve;r.WriteLine("solid Model"),e.EnumerateTrianglesWithNormals((n,s,o,a)=>{r.WriteArrayLine(["facet","normal",a.x,a.y,a.z]),r.Indent(1),r.WriteLine("outer loop"),r.Indent(1),r.WriteArrayLine(["vertex",n.x,n.y,n.z]),r.WriteArrayLine(["vertex",s.x,s.y,s.z]),r.WriteArrayLine(["vertex",o.x,o.y,o.z]),r.Indent(-1),r.WriteLine("endloop"),r.Indent(-1),r.WriteLine("endfacet")}),r.WriteLine("endsolid Model"),i.SetTextContent(r.GetText())}ExportBinary(e,t){let i=new Z("model.stl");t.push(i);let r=e.TriangleCount(),n=80,s=n+4+r*50,o=new at(s,!0);for(let a=0;a<n;a++)o.WriteUnsignedCharacter8(0);o.WriteUnsignedInteger32(r),e.EnumerateTrianglesWithNormals((a,h,u,d)=>{o.WriteFloat32(d.x),o.WriteFloat32(d.y),o.WriteFloat32(d.z),o.WriteFloat32(a.x),o.WriteFloat32(a.y),o.WriteFloat32(a.z),o.WriteFloat32(h.x),o.WriteFloat32(h.y),o.WriteFloat32(h.z),o.WriteFloat32(u.x),o.WriteFloat32(u.y),o.WriteFloat32(u.z),o.WriteUnsignedInteger16(0)}),i.SetBufferContent(o.GetBuffer())}};var fn=class{constructor(){this.exporters=[new hn,new mn,new dn,new un,new an,new ln]}AddExporter(e){this.exporters.push(e)}Export(e,t,i,r,n){let s=null;for(let a=0;a<this.exporters.length;a++){let h=this.exporters[a];if(h.CanExport(i,r)){s=h;break}}if(s===null){n.onError();return}let o=new ui(e,t);s.Export(o,i,a=>{a.length===0?n.onError():n.onSuccess(a)})}};var Yi={Model:0,Image:1},cn=class{constructor(e){this.name=e}GetType(){return null}GetName(){return this.name}GenerateParametersUI(e){}AddSelectItem(e,t,i,r){let n=v(e,"ov_dialog_row");v(n,"ov_dialog_row_name",t);let s=v(n,"ov_dialog_row_value");return rr(s,i,r)}},He=class extends cn{constructor(e,t,i){super(e);this.format=t,this.extension=i,this.visibleOnlySelect=null,this.rotationSelect=null}GetType(){return Yi.Model}GenerateParametersUI(e){this.visibleOnlySelect=this.AddSelectItem(e,"Scope",["Entire Model","Visible Only"],1),this.rotationSelect=this.AddSelectItem(e,"Rotation",["No Rotation","-90 Degrees","90 Degrees"],0)}ExportModel(e,t){let i=new Xi;if(this.visibleOnlySelect.selectedIndex===1&&(i.isMeshVisible=s=>t.isMeshVisible(s)),this.rotationSelect.selectedIndex===1){let s=new U().CreateRotationAxisAngle(new M(1,0,0),-Math.PI/2);i.transformation.SetMatrix(s)}else if(this.rotationSelect.selectedIndex===2){let s=new U().CreateRotationAxisAngle(new M(1,0,0),Math.PI/2);i.transformation.SetMatrix(s)}if(new ui(e,i).MeshInstanceCount()===0){let s=Je("Export Failed","The model doesn't contain any meshes.",null);t.onDialog(s);return}let n=new ti;n.Init("Exporting Model"),n.Show(),pt(()=>{new fn().Export(e,i,this.format,this.extension,{onError:()=>{n.Hide()},onSuccess:o=>{if(o.length===0)n.Hide();else if(o.length===1){n.Hide();let a=o[0];ar(a.GetBufferContent(),a.GetName())}else o.length>1&&he("loaders/fflate.min.js").then(()=>{let a={};for(let d of o)a[d.name]=new Uint8Array(d.content);let u=fflate.zipSync(a).buffer;n.Hide(),ar(u,"model.zip")}).catch(()=>{n.Hide()})}})})}},qs=class extends cn{constructor(e,t){super(e);this.extension=t,this.sizeSelect=null,this.sizes=[{name:"Current size",value:null},{name:"1280 x 720",value:[1280,720]},{name:"1920 x 1080",value:[1920,1080]}]}GetType(){return Yi.Image}GenerateParametersUI(e){let t=this.sizes.map(i=>i.name);this.sizeSelect=this.AddSelectItem(e,"Image size",t,1)}ExportImage(e){let t=this.sizes[this.sizeSelect.selectedIndex],i=null;if(t.value===null){let r=e.GetImageSize();i=e.GetImageAsDataUrl(r.width,r.height)}else i=e.GetImageAsDataUrl(t.value[0],t.value[1]);lr(i,"model."+this.extension)}},pn=class{constructor(e){this.callbacks=e,this.selectedExporter=null,this.parametersDiv=null,this.exporters=[new He("Wavefront (.obj)",F.Text,"obj"),new He("Stereolithography Text (.stl)",F.Text,"stl"),new He("Stereolithography Binary (.stl)",F.Binary,"stl"),new He("Polygon File Format Text (.ply)",F.Text,"ply"),new He("Polygon File Format Binary (.ply)",F.Binary,"ply"),new He("glTF Text (.gltf)",F.Text,"gltf"),new He("glTF Binary (.glb)",F.Binary,"glb"),new He("Object File Format Text (.off)",F.Text,"off"),new He("Rhinoceros 3D (.3dm)",F.Binary,"3dm"),new qs("PNG Image (.png)","png")]}Show(e,t){let i=new Ne,r=i.Init("Export",[{name:"Close",subClass:"outline",onClick(){i.Hide()}},{name:"Export",onClick:()=>{i.Hide(),this.ExportFormat(e,t)}}]);v(r,"ov_dialog_section","Select the format from the list below, and adjust the settings of the selected format.");let s=v(r,"ov_dialog_row");this.parametersDiv=v(r);let o=this.exporters.map(u=>u.GetName()),a=ai("ov_last_export_format","glTF Binary (.glb)"),h=o.indexOf(a);h===-1&&(h=6),rr(s,o,h,u=>{li("ov_last_export_format",o[u]),this.OnFormatSelected(u)}),this.OnFormatSelected(h),i.Show(),this.callbacks.onDialog(i)}OnFormatSelected(e){ue(this.parametersDiv),this.selectedExporter=this.exporters[e],this.selectedExporter.GenerateParametersUI(this.parametersDiv)}ExportFormat(e,t){this.selectedExporter.GetType()===Yi.Model?(this.selectedExporter.ExportModel(e,{isMeshVisible:i=>this.callbacks.isMeshVisible(i),onDialog:i=>{this.callbacks.onDialog(i)}}),le("model_exported",this.selectedExporter.GetName())):this.selectedExporter.GetType()===Yi.Image&&this.selectedExporter.ExportImage(t)}};function Xs(l){let e=new Ne,t=_t("textarea","ov_dialog_textarea"),i=e.Init("Open Model from Url",[{name:"Cancel",subClass:"outline",onClick(){e.Hide()}},{name:"OK",onClick(){let n=[];we(t.value,s=>{n.push(s)}),e.Hide(),l(n)}}]);return v(i,"ov_dialog_section","Here you can load models based on their urls. You can add more lines if your model builds up from multiple files."),i.appendChild(t),e.Show(),t.focus(),e}function Ys(l,e,t){function i(f,p,x,C){let I=v(f,"ov_dialog_row"),T=wn(I,x,p,!0,()=>{C(T.checked)})}function r(f){let p=Ei();p.AddModelUrls(f.files);let x=p.GetParameterList();return window.location.host+"/website/index.html#"+x}function n(f){let p=Ei();p.AddModelUrls(f.files),p.AddCamera(f.camera),p.AddBackgroundColor(f.backgroundColor),p.AddDefaultColor(f.defaultColor),p.AddEdgeSettings(f.edgeSettings);let x=p.GetParameterList(),C="";return C+="<iframe",C+=' width="640" height="480"',C+=' style="border:1px solid #eeeeee;"',C+=' src="'+window.location.host+'/website/index.html#'+x+'">',C+="</iframe>",C}function s(f,p){let x="Copy",C="Copied",I=v(f,"ov_dialog_copyable_input"),T=Q(I,"input","ov_dialog_text");T.readOnly=!0;let S=v(I,"ov_button outline ov_dialog_copyable_input_button",x);return S.addEventListener("click",()=>{Pn(p()),S.innerHTML=C,setTimeout(()=>{S.innerHTML=x},2e3)}),T}function o(f,p){let x=v(f,"ov_dialog_section");v(x,"ov_dialog_inner_title","Sharing Link");let C=s(x,()=>(le("model_shared","sharing_link"),r(p)));C.value=r(p)}function a(f,p,x){let C=v(f,"ov_dialog_section");C.style.marginTop="20px",v(C,"ov_dialog_inner_title","Embedding Code");let I=v(C,"ov_dialog_section"),T=s(C,()=>(le("model_shared","embedding_code"),n(x)));i(I,"Use current camera position","embed_camera",S=>{x.camera=S?t:null,T.value=n(x)}),i(I,"Use overridden background color","embed_background",S=>{x.backgroundColor=S?p.backgroundColor:null,T.value=n(x)}),i(I,"Use overridden default color","embed_color",S=>{x.defaultColor=S?p.defaultColor:null,T.value=n(x)}),i(I,"Use overridden edge display","embed_edge_display",S=>{let w={showEdges:p.edgeSettings,edgeColor:p.edgeColor,edgeThreshold:p.edgeThreshold};x.edgeSettings=S?w:null,T.value=n(x)}),T.value=n(x)}if(!l.IsOnlyUrlSource())return Je("Sharing Failed","Sharing works only if you load files by url. Please upload your model files to a web server, open them by url, and try embedding again.",null);let h=l.GetFiles(),u=[];for(let f=0;f<h.length;f++){let p=h[f];p.source===Y.Url&&u.push(p.fileUrl)}let d={files:u},m={files:u,camera:t,backgroundColor:e.backgroundColor,defaultColor:e.defaultColor,edgeSettings:{showEdges:e.showEdges,edgeColor:e.edgeColor,edgeThreshold:e.edgeThreshold}},c=new Ne,g=c.Init("Share",[{name:"Close",onClick(){c.Hide()}}]);return o(g,d),a(g,e,m),c.Show(),c}var ze={Undefined:0,Intro:1,Model:2,Loading:3},gn=class{constructor(e){this.parameters=e,this.settings=new hi,this.viewer=new $t,this.measureTool=new kr,this.hashHandler=new ei,this.toolbar=new on(this.parameters.toolbarDiv),this.navigator=new Kr(this.parameters.navigatorDiv,this.parameters.navigatorSplitterDiv),this.sidebar=new rn(this.parameters.sidebarDiv,this.parameters.sidebarSplitterDiv,this.settings,this.measureTool),this.modelLoaderUI=new ii,this.themeHandler=new nn,this.highlightColor=new THREE.Color(9357808),this.uiState=ze.Undefined,this.model=null,this.dialog=null}Load(){this.settings.LoadFromCookies(),this.SwitchTheme(this.settings.themeId,!1),le("theme_on_load",this.settings.themeId===ae.Light?"light":"dark"),this.InitViewer(),this.InitMeasureTool(),this.InitToolbar(),this.InitDragAndDrop(),this.InitSidebar(),this.InitNavigator(),this.InitCookieConsent(),this.viewer.SetMouseClickHandler(this.OnModelClicked.bind(this)),this.viewer.SetMouseMoveHandler(this.OnModelMouseMoved.bind(this)),this.viewer.SetContextMenuHandler(this.OnModelContextMenu.bind(this)),this.Resize(),this.SetUIState(ze.Intro),this.hashHandler.SetEventListener(this.OnHashChange.bind(this)),this.OnHashChange(),Rn(()=>{this.OnSmallWidthChanged()}),window.addEventListener("resize",()=>{this.Resize()})}Resize(){let e=window.innerWidth,t=window.innerHeight,i=this.parameters.headerDiv.offsetHeight,r=0,n=0,s=0;Fn()||(r=this.navigator.GetWidth(),n=this.sidebar.GetWidth(),s=1);let o=50,a=e-r-n;a<o&&(this.sidebar.DecreaseWidth(o-a),a=o);let h=t-i;Qe(this.parameters.introDiv,h),this.navigator.Resize(h),this.sidebar.Resize(h),this.viewer.Resize(a-s,h)}OnSmallWidthChanged(){this.uiState===ze.Model&&this.UpdatePanelsVisibility()}HasLoadedModel(){return this.model!==null}SetUIState(e){function t(i){document.querySelector(":root").style.setProperty("--ov_only_on_model_display",i?"inherit":"none")}this.uiState!==e&&(this.uiState=e,this.uiState===ze.Intro?(V(this.parameters.introDiv,!0),V(this.parameters.mainDiv,!1),t(!1)):this.uiState===ze.Model?(V(this.parameters.introDiv,!1),V(this.parameters.mainDiv,!0),t(!0),this.UpdatePanelsVisibility()):this.uiState===ze.Loading&&(V(this.parameters.introDiv,!1),V(this.parameters.mainDiv,!1),t(!1)),this.Resize())}ClearModel(){this.HidePopups(),this.model=null,this.viewer.Clear(),this.parameters.fileNameDiv.innerHTML="",this.navigator.Clear(),this.sidebar.Clear(),this.measureTool.Clear(),this.sidebar.UpdateMeasureTool()}OnModelLoaded(e,t){this.model=e.model,this.parameters.fileNameDiv.innerHTML=e.mainFile,this.viewer.SetMainObject(t),this.viewer.SetUpVector(e.upVector,!1),this.navigator.FillTree(e),this.UpdateSidebar(),this.FitModelToWindow(!0)}OnModelClicked(e,t){if(e!==1)return;if(this.measureTool.IsActive()){this.measureTool.Click(t),this.sidebar.UpdateMeasureTool();return}let i=this.viewer.GetMeshUserDataUnderMouse(t);i===null?this.navigator.SetSelection(null):this.navigator.SetSelection(new St(re.Mesh,i.originalMeshId))}OnModelMouseMoved(e){}OnModelContextMenu(e,t){let i=this.viewer.GetMeshUserDataUnderMouse(t),r=[];if(i===null)r.push({name:"Fit model to window",icon:"fit",onClick:()=>{this.FitModelToWindow(!1)}}),this.navigator.HasHiddenMesh()&&r.push({name:"Show all meshes",icon:"visible",onClick:()=>{this.navigator.ShowAllMeshes(!0)}});else if(r.push({name:"Hide mesh",icon:"hidden",onClick:()=>{this.navigator.ToggleMeshVisibility(i.originalMeshId)}}),r.push({name:"Fit mesh to window",icon:"fit",onClick:()=>{this.navigator.FitMeshToWindow(i.originalMeshId)}}),this.navigator.MeshItemCount()>1){let n=this.navigator.IsMeshIsolated(i.originalMeshId);r.push({name:n?"Remove isolation":"Isolate mesh",icon:n?"deisolate":"isolate",onClick:()=>{n?this.navigator.ShowAllMeshes(!0):this.navigator.IsolateMesh(i.originalMeshId)}})}this.dialog=Ht(r,{calculatePosition:n=>Ps(e,n),onClick:n=>{r[n].onClick()}})}OnHashChange(){if(this.hashHandler.HasHash()){let e=this.hashHandler.GetModelFilesFromHash();if(e===null)return;Ai(e);let t=new kt;t.defaultColor=this.settings.defaultColor;let i=this.hashHandler.GetDefaultColorFromHash();i!==null&&(t.defaultColor=i),le("model_load_started","hash"),this.LoadModelFromUrlList(e,t)}else this.ClearModel(),this.SetUIState(ze.Intro)}HidePopups(){this.dialog!==null&&(this.dialog.Hide(),this.dialog=null)}OpenFileBrowserDialog(){this.parameters.fileInput.click()}FitModelToWindow(e){let t=!e,i=this.viewer.GetBoundingSphere(r=>this.navigator.IsMeshVisible(r.originalMeshId));e&&this.viewer.AdjustClippingPlanesToSphere(i),this.viewer.FitSphereToWindow(i,t)}FitMeshToWindow(e){let t=this.viewer.GetBoundingSphere(i=>i.originalMeshId.IsEqual(e));this.viewer.FitSphereToWindow(t,!0)}FitMeshesToWindow(e){let t=new Set;for(let r of e)t.add(r.GetKey());let i=this.viewer.GetBoundingSphere(r=>t.has(r.originalMeshId.GetKey()));this.viewer.FitSphereToWindow(i,!0)}UpdateSidebar(){let e=ns(this.model);this.sidebar.UpdateSettings(e)}UpdateMeshesVisibility(){this.viewer.SetMeshesVisibility(e=>this.navigator.IsMeshVisible(e.originalMeshId))}UpdateMeshesSelection(){let e=this.navigator.GetSelectedMeshId();this.viewer.SetMeshesHighlight(this.highlightColor,t=>!!(e!==null&&t.originalMeshId.IsEqual(e)))}LoadModelFromUrlList(e,t){this.LoadModel(e,Y.Url,t),this.ClearHashIfNotOnlyUrlList()}LoadModelFromFileList(e){let t=new kt;t.defaultColor=this.settings.defaultColor,this.LoadModel(e,Y.File,t),this.ClearHashIfNotOnlyUrlList()}LoadModel(e,t,i){this.modelLoaderUI.LoadModel(e,t,i,{onStart:()=>{this.SetUIState(ze.Loading),this.ClearModel()},onFinish:(r,n)=>{this.SetUIState(ze.Model),this.OnModelLoaded(r,n);let s=Be(r.mainFile);le("model_loaded",s)},onRender:()=>{this.viewer.Render()},onError:r=>{this.SetUIState(ze.Intro);let n=[],o=this.modelLoaderUI.GetImporter().GetFileList().GetFiles();for(let h=0;h<o.length;h++){let u=o[h].extension;n.push(u)}let a=n.join(",");r.code===De.NoImportableFile?le("no_importable_file",a):r.code===De.FailedToLoadFile?le("failed_to_load_file",a):r.code===De.ImportFailed&&le("import_failed",a,{error_message:r.message})}})}ClearHashIfNotOnlyUrlList(){!this.modelLoaderUI.GetImporter().GetFileList().IsOnlyUrlSource()&&this.hashHandler.HasHash()&&(this.hashHandler.SkipNextEventHandler(),this.hashHandler.ClearHash())}UpdateGridDisplay(){this.settings.SaveToCookies(),this.viewer.SetGridSettings(this.settings.showGrid)}UpdateEdgeDisplay(){this.settings.SaveToCookies(),this.viewer.SetEdgeSettings(this.settings.showEdges,this.settings.edgeColor,this.settings.edgeThreshold)}SwitchTheme(e,t){if(this.settings.themeId=e,this.themeHandler.SwitchTheme(this.settings.themeId),this.settings.SaveToCookies(),t){this.viewer.SetBackgroundColor(this.settings.backgroundColor);let i=this.modelLoaderUI.GetModelLoader();i.GetDefaultMaterial()!==null&&(xr(this.model,this.settings.defaultColor),i.ReplaceDefaultMaterialColor(this.settings.defaultColor))}}InitViewer(){let e=Q(this.parameters.viewerDiv,"canvas");this.viewer.Init(e),this.viewer.SetGridSettings(this.settings.showGrid),this.viewer.SetEdgeSettings(this.settings.showEdges,this.settings.edgeColor,this.settings.edgeThreshold),this.viewer.SetBackgroundColor(this.settings.backgroundColor),this.viewer.SetEnvironmentMap(["assets/envmaps/grayclouds/posx.jpg","assets/envmaps/grayclouds/negx.jpg","assets/envmaps/grayclouds/posy.jpg","assets/envmaps/grayclouds/negy.jpg","assets/envmaps/grayclouds/posz.jpg","assets/envmaps/grayclouds/negz.jpg"])}InitMeasureTool(){this.measureTool.Init(this.viewer,this.highlightColor)}InitToolbar(){function e(n,s,o,a,h){let u=n.AddImageButton(s,o,()=>{h()});for(let d of a)u.AddClass(d);return u}function t(n,s,o,a,h,u){let d=[];for(let c=0;c<s.length;c++){let g=s[c],f=o[c];d.push({image:g,title:f})}let m=n.AddImageRadioButton(d,a,c=>{u(c)});for(let c of h)for(let g of m)g.AddClass(c)}function i(n,s){let o=n.AddSeparator();if(s!==null)for(let a of s)o.classList.add(a)}let r=this.modelLoaderUI.GetImporter();e(this.toolbar,"open","Open model from your device",[],()=>{this.OpenFileBrowserDialog()}),e(this.toolbar,"open_url","Open model from a url",[],()=>{this.dialog=Xs(n=>{n.length>0&&this.hashHandler.SetModelFilesToHash(n)})}),i(this.toolbar,["only_on_model"]),e(this.toolbar,"fit","Fit model to window",["only_on_model"],()=>{this.FitModelToWindow(!1)}),e(this.toolbar,"up_y","Set Y axis as up vector",["only_on_model"],()=>{this.viewer.SetUpVector(_.Y,!0)}),e(this.toolbar,"up_z","Set Z axis as up vector",["only_on_model"],()=>{this.viewer.SetUpVector(_.Z,!0)}),e(this.toolbar,"flip","Flip up vector",["only_on_model"],()=>{this.viewer.FlipUpVector()}),i(this.toolbar,["only_on_model"]),t(this.toolbar,["fix_up_on","fix_up_off"],["Fixed up vector","Free orbit"],0,["only_on_model"],n=>{n===0?this.viewer.SetFixUpVector(!0):n===1&&this.viewer.SetFixUpVector(!1)}),i(this.toolbar,["only_full_width","only_on_model"]),e(this.toolbar,"export","Export model",["only_full_width","only_on_model"],()=>{new pn({isMeshVisible:s=>this.navigator.IsMeshVisible(s),onDialog:s=>{this.dialog=s}}).Show(this.model,this.viewer)}),e(this.toolbar,"share","Share model",["only_full_width","only_on_model"],()=>{this.dialog=Ys(r.GetFileList(),this.settings,this.viewer.GetCamera())}),this.parameters.fileInput.addEventListener("change",n=>{n.target.files.length>0&&(le("model_load_started","open_file"),this.LoadModelFromFileList(n.target.files))})}InitDragAndDrop(){window.addEventListener("dragstart",e=>{e.preventDefault()},!1),window.addEventListener("dragover",e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),window.addEventListener("drop",e=>{e.stopPropagation(),e.preventDefault(),Nn(e.dataTransfer,t=>{t.length>0&&(le("model_load_started","drop"),this.LoadModelFromFileList(t))})},!1)}InitSidebar(){this.sidebar.Init({onBackgroundColorChange:()=>{this.settings.SaveToCookies(),this.viewer.SetBackgroundColor(this.settings.backgroundColor)},onDefaultColorChange:()=>{this.settings.SaveToCookies();let e=this.modelLoaderUI.GetModelLoader();e.GetDefaultMaterial()!==null&&(xr(this.model,this.settings.defaultColor),e.ReplaceDefaultMaterialColor(this.settings.defaultColor)),this.viewer.Render()},onGridDisplayChange:()=>{this.UpdateGridDisplay()},onEdgeDisplayChange:()=>{le("edge_display_changed",this.settings.showEdges?"on":"off"),this.UpdateEdgeDisplay()},onThemeChange:()=>{le("theme_changed",this.settings.themeId===ae.Light?"light":"dark"),this.SwitchTheme(this.settings.themeId,!0)},onMeasureToolActivedChange:e=>{e?(this.navigator.SetSelection(null),this.measureTool.SetActive(!0)):this.measureTool.SetActive(!1),this.sidebar.UpdateMeasureTool()},onResize:()=>{this.Resize()},onShowHidePanels:e=>{bt("ov_show_sidebar",e)}})}InitNavigator(){function e(n,s){let o=null;return n.EnumerateMeshesUserData(a=>{a.originalMeshId.IsEqual(s)&&(o=a)}),o}function t(n,s,o){let a=[];return n.EnumerateMeshesUserData(h=>{if(o===null||h.originalMaterials.indexOf(o)!==-1){let u=s.GetMesh(h.originalMeshId.meshIndex);a.push({meshId:h.originalMeshId,name:u.GetName()})}}),a}function i(n,s){let o=n.GetMaterial(s);return{index:s,name:o.name,color:o.color.Clone()}}function r(n,s,o){let a=[];if(o===null)for(let h=0;h<s.MaterialCount();h++)a.push(i(s,h));else{let h=e(n,o);for(let u=0;u<h.originalMaterials.length;u++){let d=h.originalMaterials[u];a.push(i(s,d))}}return a.sort((h,u)=>h.index-u.index),a}this.navigator.Init({openFileBrowserDialog:()=>{this.OpenFileBrowserDialog()},updateMeshesVisibility:()=>{this.UpdateMeshesVisibility()},updateMeshesSelection:()=>{this.UpdateMeshesSelection()},fitMeshToWindow:n=>{this.FitMeshToWindow(n)},fitMeshesToWindow:n=>{this.FitMeshesToWindow(n)},getMeshesForMaterial:n=>t(this.viewer,this.model,n),getMaterialsForMesh:n=>r(this.viewer,this.model,n),onModelSelected:()=>{this.sidebar.AddObject3DProperties(this.model)},onMeshSelected:n=>{let s=this.model.GetMeshInstance(n);this.sidebar.AddObject3DProperties(s)},onMaterialSelected:n=>{this.sidebar.AddMaterialProperties(this.model.GetMaterial(n))},onResize:()=>{this.Resize()},onShowHidePanels:n=>{bt("ov_show_navigator",n)}})}UpdatePanelsVisibility(){let e=Mt("ov_show_navigator",!0),t=Mt("ov_show_sidebar",!0);this.navigator.ShowPanels(e),this.sidebar.ShowPanels(t)}InitCookieConsent(){if(Mt("ov_cookie_consent",!1))return;
}};function ao(l){Vn(l)}function ho(l){Zi(l),window.addEventListener("load",()=>{new gn({headerDiv:document.getElementById("header"),toolbarDiv:document.getElementById("toolbar"),mainDiv:document.getElementById("main"),introDiv:document.getElementById("intro"),fileNameDiv:document.getElementById("main_file_name"),navigatorDiv:document.getElementById("main_navigator"),navigatorSplitterDiv:document.getElementById("main_navigator_splitter"),sidebarDiv:document.getElementById("main_sidebar"),sidebarSplitterDiv:document.getElementById("main_sidebar_splitter"),viewerDiv:document.getElementById("main_viewer"),fileInput:document.getElementById("open_file")}).Load()})}function uo(l){Zi(l),window.addEventListener("load",()=>{new Ur({viewerDiv:document.getElementById("embed_viewer"),websiteLinkDiv:document.getElementById("website_link")}).Load()})}function mo(l,e,t,i){let r=_t("a");return r.setAttribute("href",i),r.setAttribute("target","_blank"),r.setAttribute("rel","noopener noreferrer"),Ii(r,t),fe(r,e,"header_button"),l.appendChild(r),r}return to(fo);})();